<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="English, Chinese">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />





  <link rel="alternate" href="http://www.freebuf.com" title="Superpb9" type="application/atom+xml" />






<meta name="description" content="Cyber Security Analyst | OSCP">
<meta property="og:type" content="website">
<meta property="og:title" content="Superpb9">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Superpb9">
<meta property="og:description" content="Cyber Security Analyst | OSCP">
<meta property="og:locale" content="English, Chinese">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Superpb9">
<meta name="twitter:description" content="Cyber Security Analyst | OSCP">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/"/>





  <title>Superpb9</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="English, Chinese">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Superpb9</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">A journey of a thousand miles may not be achieved without accumulation of each single step, just as the enormous ocean may not be formed without gathering every brook or stream.</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/12/06/Python-My-SOC-Tool/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Patrick Dong">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Superpb9">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/12/06/Python-My-SOC-Tool/" itemprop="url">[Python] My SOC Tool v2.0 - Powered by Selenium</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-12-06T21:36:00+13:00">
                2018-12-06
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Security-Automation/" itemprop="url" rel="index">
                    <span itemprop="name">Security Automation</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Welcome to SuperPB SOC Tool<br>Author: pippo9 Sep 2018</p>
<p>Usage: python3 superpb9.py [-i IPv4] [-d Domain] [-s ET Signature]<br>    -i   Call IP Reputation Checker.<br>    -d   Call Domain Reputation Checker.<br>    -s   Search ET Signature online. </p>
<h3 id="Program-Entrance-Option-1-‘superpb9-py’"><a href="#Program-Entrance-Option-1-‘superpb9-py’" class="headerlink" title="Program Entrance Option 1: ‘superpb9.py’"></a>Program Entrance Option 1: ‘superpb9.py’</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3.7</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> multiprocessing</span><br><span class="line"><span class="keyword">import</span> os, platform, re</span><br><span class="line"><span class="keyword">import</span> sys, getopt, subprocess</span><br><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Process, freeze_support</span><br><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"></span><br><span class="line"><span class="comment"># Windows 10 Environment</span></span><br><span class="line"><span class="comment"># pythonEXE="/mnt/c/Users/superpb9/AppData/Local/Programs/Python/Python37/python.exe"</span></span><br><span class="line"></span><br><span class="line">PLATFORM = platform.system()</span><br><span class="line">PYTHON_EXEC_FORMAT = <span class="string">""</span></span><br><span class="line"></span><br><span class="line">WIN_PROJECT_PATH = <span class="string">"C:\\Users\\XXXXX\\iCloudDrive\\Documents\\myProject\\mysoc\\"</span></span><br><span class="line">LINUX_PROJECT_PATH = <span class="string">"/user/XXXXX/mysoc/"</span></span><br><span class="line">MAC_PROJECT_PATH = <span class="string">"/Users/XXXXX/mysoc_clone"</span></span><br><span class="line"></span><br><span class="line">ip_regex = <span class="string">"^(?:(?:1\d&#123;2&#125;|2[0-4]\d|25[0-5]|[1-9]\d|[1-9])\.)(?:(?:1\d&#123;2&#125;|2[0-4]\d|25[0-5]|[1-9]\d|\d)\.)&#123;2&#125;(?:1\d&#123;2&#125;|2[0-4]\d|25[0-5]|[1-9]\d|\d)$"</span></span><br><span class="line">domain_regex = <span class="string">"^(?!:\/\/)([a-zA-Z0-9-_]+\.)*[a-zA-Z0-9][a-zA-Z0-9-_]+\.[a-zA-Z]&#123;2,11&#125;?$"</span></span><br><span class="line">sid_regex=<span class="string">"^[0-9]+$"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">banner</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">"#######################################\n"</span></span><br><span class="line">          <span class="string">"----- Welcome to SuperPB SOC Tool -----\n"</span></span><br><span class="line">          <span class="string">"------  Author: pippo9 Sep 2018  ------\n"</span></span><br><span class="line">          <span class="string">"#######################################"</span>)</span><br><span class="line">    print(<span class="string">"[+] INFO: Current Platform is "</span> + PLATFORM)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">usage</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="comment"># cwd = os.getcwd()</span></span><br><span class="line">    <span class="comment"># filePath = os.path.dirname(__file__)</span></span><br><span class="line">    <span class="comment"># filePathName = os.path.abspath(__file__)</span></span><br><span class="line">    fileName = os.path.basename(__file__)</span><br><span class="line">    print(<span class="string">"Usage: "</span> + fileName + <span class="string">" [-i IPv4] [-d Domain] [-s ET Signature]"</span>)</span><br><span class="line">    print(<span class="string">"The script acts as a single entrance for all soc tools, developed by superpb9."</span>)</span><br><span class="line">    print(<span class="string">"    -i   Call IP Reputation Checker."</span>)</span><br><span class="line">    print(<span class="string">"    -d   Call Domain Reputation Checker."</span>)</span><br><span class="line">    print(<span class="string">"    -s   Search ET Signature online."</span>)  <span class="comment"># http://docs.emergingthreats.net/bin/view/Main/2001978</span></span><br><span class="line">    exit()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">myGetOpt</span><span class="params">(myFilePath)</span>:</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># Call banner() function</span></span><br><span class="line">        banner()</span><br><span class="line">        <span class="keyword">if</span> <span class="string">"Windows"</span> <span class="keyword">in</span> PLATFORM:</span><br><span class="line">            PYTHON_EXEC_FORMAT = <span class="string">"python.exe"</span></span><br><span class="line">        <span class="comment"># For "Linux" or "Darwin"</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            PYTHON_EXEC_FORMAT = <span class="string">"python3"</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># Check argument</span></span><br><span class="line">        opts, args = getopt.getopt(sys.argv[<span class="number">1</span>:], <span class="string">'-i:-d:-s:'</span>, [<span class="string">'IPv4='</span>, <span class="string">'Domain='</span>, <span class="string">'Signature='</span>])</span><br><span class="line">        <span class="comment"># If user input an invalid argument, program will exit after calling usage()</span></span><br><span class="line">        <span class="keyword">if</span> len(opts) == <span class="number">0</span>:</span><br><span class="line">            print(<span class="string">"[-] ERROR: An invalid argument detected"</span>)</span><br><span class="line">            usage()</span><br><span class="line">            exit()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> opt_name, opt_value <span class="keyword">in</span> opts:</span><br><span class="line">            <span class="comment">#######################</span></span><br><span class="line">            <span class="comment"># IP Reputation Check #</span></span><br><span class="line">            <span class="comment">#######################</span></span><br><span class="line">            <span class="keyword">if</span> opt_name <span class="keyword">in</span> (<span class="string">'-i'</span>, <span class="string">'--IPv4'</span>):</span><br><span class="line">                <span class="function"><span class="keyword">def</span> <span class="title">run_proc1</span><span class="params">()</span>:</span></span><br><span class="line">                    <span class="comment"># print("[*] Current Child process ---- %s (%s)..." % (name, os.getpid()))</span></span><br><span class="line">                    ip = opt_value</span><br><span class="line">                    re_ip = re.compile(ip_regex)</span><br><span class="line">                    <span class="keyword">if</span> re_ip.match(ip):</span><br><span class="line">                        print(<span class="string">'[+] IP Regex successfully matches! Now checking '</span> + ip)</span><br><span class="line">                        <span class="comment"># Call ipReputation.py from ipReputation</span></span><br><span class="line">                        myFilePath1 = myFilePath + <span class="string">"ipReputation"</span></span><br><span class="line">                        owd = os.getcwd()</span><br><span class="line">                        os.chdir(myFilePath1)</span><br><span class="line">                        subprocess.call([PYTHON_EXEC_FORMAT, <span class="string">'ipReputation.py'</span>, ip])</span><br><span class="line">                        <span class="string">'''</span></span><br><span class="line"><span class="string">                        p = subprocess.Popen(['python.exe', 'ipReputation.py', ip], stdout=subprocess.PIPE)</span></span><br><span class="line"><span class="string">                        for line in iter(p.stdout.readline, b''):</span></span><br><span class="line"><span class="string">                            print (line.strip())</span></span><br><span class="line"><span class="string">                        p.stdout.close()</span></span><br><span class="line"><span class="string">                        p.kill()</span></span><br><span class="line"><span class="string">                        '''</span></span><br><span class="line">                        print(<span class="string">"[+] IP Whois Result"</span>)</span><br><span class="line">                        subprocess.call([PYTHON_EXEC_FORMAT, <span class="string">'ipWhois.py'</span>, ip])</span><br><span class="line">                        <span class="comment"># Change the Path back to SYSTEM Default</span></span><br><span class="line">                        os.chdir(owd)</span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        print(<span class="string">'[-] WARNING: Please type a valid IPv4 address.'</span>)</span><br><span class="line">                        exit()</span><br><span class="line">                <span class="comment"># ************************* #</span></span><br><span class="line">                <span class="comment"># Parent Process Running Block</span></span><br><span class="line">                <span class="comment"># print('[*] Current Parent process ---- %s.' % os.getpid())</span></span><br><span class="line">                <span class="comment"># Call the Child Process Running Block above</span></span><br><span class="line">                p = Process(target=run_proc1)</span><br><span class="line">                <span class="comment">#p = Process(target=run_proc(), args=('test1',))</span></span><br><span class="line">                p.start()</span><br><span class="line">                <span class="comment"># Note: We don't want to wait for Parent Process; Otherwise, please use p.join()</span></span><br><span class="line">                <span class="comment"># p.join()</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">###########################</span></span><br><span class="line">            <span class="comment"># Domain Reputation Check #</span></span><br><span class="line">            <span class="comment">###########################</span></span><br><span class="line">            <span class="keyword">elif</span> opt_name <span class="keyword">in</span> (<span class="string">'-d'</span>, <span class="string">'--Domain'</span>):</span><br><span class="line">                <span class="comment"># ************************* #</span></span><br><span class="line">                <span class="comment"># Child Process Running Block</span></span><br><span class="line">                <span class="comment"># Use Child Process to do Domain Reputation Check</span></span><br><span class="line">                <span class="function"><span class="keyword">def</span> <span class="title">run_proc2</span><span class="params">()</span>:</span></span><br><span class="line">                    <span class="comment"># print("[*] Current Child process ---- %s (%s)..." % (name, os.getpid()))</span></span><br><span class="line">                    domain = opt_value</span><br><span class="line">                    re_domain = re.compile(domain_regex)</span><br><span class="line">                    <span class="keyword">if</span> re_domain.match(domain):</span><br><span class="line">                        print(<span class="string">'[+] Domain Regex successfully matches! Now checking '</span> + domain)</span><br><span class="line">                        <span class="comment"># Call domainReputation.py from domainReputation</span></span><br><span class="line">                        myFilePath2 = myFilePath + <span class="string">"domainReputation"</span></span><br><span class="line">                        owd = os.getcwd()</span><br><span class="line">                        os.chdir(myFilePath2)</span><br><span class="line">                        subprocess.call([PYTHON_EXEC_FORMAT, <span class="string">'domainReputation.py'</span>, domain])</span><br><span class="line">                        <span class="comment"># Change the Path back to SYSTEM Default</span></span><br><span class="line">                        os.chdir(owd)</span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        print(<span class="string">'[-] WARNING: Please type a valid Domain.'</span>)</span><br><span class="line">                        exit()</span><br><span class="line">                <span class="comment"># ************************* #</span></span><br><span class="line">                <span class="comment"># Parent Process Running Block</span></span><br><span class="line">                <span class="comment"># print('[*] Current Parent process ---- %s.' % os.getpid())</span></span><br><span class="line">                <span class="comment"># Call the Child Process Running Block above</span></span><br><span class="line">                freeze_support()</span><br><span class="line">                p = Process(target=run_proc2)</span><br><span class="line">                <span class="comment">#p = Process(target=run_proc, args=('test2',))</span></span><br><span class="line">                p.start()</span><br><span class="line">                <span class="comment"># Note: We don't want to wait for Parent Process; Otherwise, please use p.join()</span></span><br><span class="line">                <span class="comment"># p.join()</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            <span class="comment">#############################</span></span><br><span class="line">            <span class="comment"># ET(Snort) Signature Check #</span></span><br><span class="line">            <span class="comment">#############################</span></span><br><span class="line">            <span class="keyword">elif</span> opt_name <span class="keyword">in</span> (<span class="string">'-s'</span>, <span class="string">'--Signature'</span>):</span><br><span class="line">                <span class="comment"># ************************* #</span></span><br><span class="line">                <span class="comment"># Use Child Process to do ET(Snort) Check</span></span><br><span class="line">                <span class="function"><span class="keyword">def</span> <span class="title">run_proc3</span><span class="params">()</span>:</span></span><br><span class="line">                    <span class="comment"># print("[*] Current Child process ---- %s (%s)..." % (name, os.getpid()))</span></span><br><span class="line">                    signature = opt_value</span><br><span class="line">                    re_signature = re.compile(sid_regex)</span><br><span class="line">                    <span class="keyword">if</span> re_signature.match(signature):</span><br><span class="line">                        print(<span class="string">"[+] Signature Regex successfully matches! Now checking "</span> + signature)</span><br><span class="line">                        <span class="comment"># Call sidSearchET.py from signatureSearch</span></span><br><span class="line">                        myFilePath3 = myFilePath + <span class="string">"signatureSearch"</span></span><br><span class="line">                        owd = os.getcwd()</span><br><span class="line">                        os.chdir(myFilePath3)</span><br><span class="line">                        subprocess.call([PYTHON_EXEC_FORMAT, <span class="string">'sidSearchET.py'</span>, signature])</span><br><span class="line">                        <span class="comment"># Change the Path back to SYSTEM Default</span></span><br><span class="line">                        os.chdir(owd)</span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        print(<span class="string">'[-] WARNING: Please type a valid signature.'</span>)</span><br><span class="line">                        exit()</span><br><span class="line">                <span class="comment"># ************************* #</span></span><br><span class="line">                <span class="comment"># Parent Process Running Block</span></span><br><span class="line">                <span class="comment"># print('[*] Current Parent process ---- %s.' % os.getpid())</span></span><br><span class="line">                <span class="comment"># Call the Child Process Running Block above</span></span><br><span class="line">                p = Process(target=run_proc3)</span><br><span class="line">                <span class="comment">#p = Process(target=run_proc, args=('test3',))</span></span><br><span class="line">                p.start()</span><br><span class="line">                <span class="comment"># Note: We don't want to wait for Parent Process; Otherwise, please use p.join()</span></span><br><span class="line">                <span class="comment"># p.join()</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">except</span> getopt.GetoptError <span class="keyword">as</span> g:</span><br><span class="line">        print(<span class="string">'[-] ERROR: '</span> + str(g) + <span class="string">'\n'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># Get the myFilePath in different OS ...</span></span><br><span class="line">        myFilePath = <span class="string">''</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">"Windows"</span> <span class="keyword">in</span> PLATFORM:</span><br><span class="line">            myFilePath = WIN_PROJECT_PATH</span><br><span class="line">        <span class="keyword">elif</span> <span class="string">"Linux"</span> <span class="keyword">in</span> PLATFORM:</span><br><span class="line">            myFilePath = LINUX_PROJECT_PATH</span><br><span class="line">        <span class="keyword">elif</span> <span class="string">"Mac"</span> <span class="keyword">in</span> PLATFORM:</span><br><span class="line">            myFilePath = MAC_PROJECT_PATH</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Call getopt</span></span><br><span class="line">        myGetOpt(myFilePath)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">except</span> IndexError:</span><br><span class="line">        print(<span class="string">"[-] ERROR: List index out of range"</span>)</span><br></pre></td></tr></table></figure>
<h3 id="Program-Entrance-Option-2-‘superpb9-sh’"><a href="#Program-Entrance-Option-2-‘superpb9-sh’" class="headerlink" title="Program Entrance Option 2: ‘superpb9.sh’"></a>Program Entrance Option 2: ‘superpb9.sh’</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Windows 10 Environment</span></span><br><span class="line"><span class="comment"># pythonEXE="/mnt/c/Users/XXXXX/AppData/Local/Programs/Python/Python37/python.exe"</span></span><br><span class="line">PROJECT_PATH=<span class="string">"/mnt/c/Users/XXXXX/iCloudDrive/Documents/myProject/mysoc/"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Mac OSX Environment</span></span><br><span class="line"><span class="comment"># PROJECT_PATH="/Users/XXXXX/mysoc_clone"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Define a usage() function</span></span><br><span class="line"><span class="function"><span class="title">usage</span></span> ()&#123;</span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"Usage: <span class="variable">$&#123;0&#125;</span> [-i IPv4][-d Domain][-s ET Signature]"</span> &gt;&amp;2</span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"The script acts as a single entrance for all soc tools, developed by superpb9."</span> &gt;&amp;2</span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"    -i   Call IP Reputation Checker."</span> &gt;&amp;2</span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"    -d   Call Domain Reputation Checker."</span> &gt;&amp;2</span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"    -s   Search ET Signature online."</span> &gt;&amp;2  <span class="comment"># http://docs.emergingthreats.net/bin/view/Main/2001978</span></span><br><span class="line">  <span class="built_in">exit</span> 1</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># Allow user to specify the following options. Any other option will cause the script to display a usage statement</span></span><br><span class="line"><span class="keyword">while</span> <span class="built_in">getopts</span> i:d:s: OPTION</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">  <span class="keyword">case</span>  <span class="variable">$&#123;OPTION&#125;</span> <span class="keyword">in</span></span><br><span class="line">    i) IP_REP_CHECK=<span class="string">'true'</span> IP_RECEIVED=<span class="string">"<span class="variable">$&#123;OPTARG&#125;</span>"</span> ;;</span><br><span class="line">    d) DOMAIN_REP_CHECK=<span class="string">'true'</span> DOMAIN_RECEIVED=<span class="string">"<span class="variable">$&#123;OPTARG&#125;</span>"</span> ;;</span><br><span class="line">    s) ET_SIGNATURE_CHECK=<span class="string">'true'</span> ET_RECEIVED=<span class="string">"<span class="variable">$&#123;OPTARG&#125;</span>"</span> ;;</span><br><span class="line">    ?) usage ;;</span><br><span class="line">  <span class="keyword">esac</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Ingore all the optional arguments and remove the options while leaving the remaining arguments.</span></span><br><span class="line"><span class="comment"># OPTIND is set to the index of the first non-option argument, and name is set to ?</span></span><br><span class="line"><span class="comment"># e.g. OPTIND will become '7' after [./superpb9.sh -i 8.8.8.8 -d www.google.com -s 200012]</span></span><br><span class="line"><span class="built_in">shift</span> <span class="string">"<span class="variable">$(( OPTIND - 1 )</span>)"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [[ <span class="string">"<span class="variable">$&#123;IP_REP_CHECK&#125;</span>"</span> = <span class="literal">true</span> ]]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"[+] Now calling 'ipReputation.py' to check <span class="variable">$&#123;IP_RECEIVED&#125;</span> ..."</span></span><br><span class="line">    <span class="comment"># Note: Python will do the IPv4 Validation</span></span><br><span class="line">    CMDLINE_STR=<span class="string">"python3 -u <span class="variable">$&#123;PROJECT_PATH&#125;</span>/ipReputation/ipReputation.py <span class="variable">$&#123;IP_RECEIVED&#125;</span>"</span></span><br><span class="line">    OUTPUT=$(<span class="built_in">eval</span> <span class="string">"<span class="variable">$CMDLINE_STR</span>"</span>)</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"<span class="variable">$&#123;OUTPUT&#125;</span>"</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">""</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [[ <span class="string">"<span class="variable">$&#123;DOMAIN_REP_CHECK&#125;</span>"</span> = <span class="literal">true</span> ]]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"[+] Now calling 'domainReputation.py' to check <span class="variable">$&#123;DOMAIN_RECEIVED&#125;</span>"</span></span><br><span class="line">    <span class="comment"># Note: Python will do the Domain Validation</span></span><br><span class="line">    CMDLINE_STR=<span class="string">"python3 <span class="variable">$&#123;PROJECT_PATH&#125;</span>/domainReputation/domainReputation.py <span class="variable">$&#123;DOMAIN_RECEIVED&#125;</span>"</span></span><br><span class="line">    OUTPUT=$(<span class="built_in">eval</span> <span class="string">"<span class="variable">$CMDLINE_STR</span>"</span>)</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"<span class="variable">$&#123;OUTPUT&#125;</span>"</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">""</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ET Signature Format check using regex</span></span><br><span class="line"><span class="comment"># echo "[+] You've asked to check ET Signature: $&#123;ET_RECEIVED&#125;"</span></span><br><span class="line"><span class="comment"># echo ''</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="Module-domainReputation-py"><a href="#Module-domainReputation-py" class="headerlink" title="Module - domainReputation.py"></a>Module - domainReputation.py</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><span class="line">import platform</span><br><span class="line">import sys,re,os,time</span><br><span class="line">import subprocess</span><br><span class="line">import shlex</span><br><span class="line"></span><br><span class="line">import selenium</span><br><span class="line">from selenium import webdriver</span><br><span class="line">from pyvirtualdisplay import Display</span><br><span class="line">from selenium.common.exceptions import WebDriverException</span><br><span class="line">from selenium.webdriver.common.desired_capabilities import DesiredCapabilities</span><br><span class="line">from selenium.webdriver.remote.command import Command</span><br><span class="line"></span><br><span class="line"><span class="comment"># Domain Validation with Regex</span></span><br><span class="line"><span class="comment">#  ^(?!:\/\/)</span></span><br><span class="line"><span class="comment">#   ([a-zA-Z0-9-_]+\.)*</span></span><br><span class="line"><span class="comment">#   [a-zA-Z0-9][a-zA-Z0-9-_]+\.</span></span><br><span class="line"><span class="comment">#   [a-zA-Z]&#123;2,11&#125;?$</span></span><br><span class="line">from selenium.webdriver.common.keys import Keys</span><br><span class="line"></span><br><span class="line">domain_regex=<span class="string">"^(?!:\/\/)([a-zA-Z0-9-_]+\.)*[a-zA-Z0-9][a-zA-Z0-9-_]+\.[a-zA-Z]&#123;2,11&#125;?$"</span></span><br><span class="line">SYSTEM_PLATFORM = platform.system()</span><br><span class="line"></span><br><span class="line">def browserStatusCheck(myBrowser):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(180):</span><br><span class="line">        try:</span><br><span class="line">            <span class="comment"># It will return 'True' is Web Browser remains opened ..</span></span><br><span class="line">            myBrowser.title</span><br><span class="line">            time.sleep(0.5)</span><br><span class="line">        except WebDriverException as w:</span><br><span class="line">            <span class="built_in">print</span>(w)</span><br><span class="line">            <span class="built_in">break</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def seleniumDomainReputation(domain):</span><br><span class="line"></span><br><span class="line">    try:</span><br><span class="line">        URL1=<span class="string">'https://www.virustotal.com/#/home/search'</span></span><br><span class="line">        URL2=<span class="string">'https://www.talosintelligence.com/reputation_center/lookup?search='</span> + domain</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="string">"Windows"</span> <span class="keyword">in</span> SYSTEM_PLATFORM:</span><br><span class="line">            myBrowser = webdriver.Chrome(<span class="string">'C:\Windows\System32\chromedriver.exe'</span>)</span><br><span class="line">        <span class="keyword">elif</span> <span class="string">"Darwin"</span> <span class="keyword">in</span> SYSTEM_PLATFORM:</span><br><span class="line">            myBrowser = webdriver.Chrome(<span class="string">'/usr/local/bin/chromedriver'</span>)</span><br><span class="line">        <span class="keyword">elif</span> <span class="string">"Linux"</span> <span class="keyword">in</span> SYSTEM_PLATFORM:</span><br><span class="line">            myBrowser = webdriver.Chrome(<span class="string">'/usr//bin/chromedriver'</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment">#  # ******* Tab 1: VirusTotal *******</span></span><br><span class="line">        myBrowser.get(URL1);</span><br><span class="line">        time.sleep(4)</span><br><span class="line">        searchElem = myBrowser.find_element_by_css_selector(<span class="string">'div.iron-selected &gt; vt-omnibar:nth-child(2) &gt; div:nth-child(1) &gt; span:nth-child(1) &gt; input:nth-child(1)'</span>)</span><br><span class="line">        searchElem.send_keys(domain)</span><br><span class="line">        <span class="comment"># searchElem.submit()</span></span><br><span class="line">        time.sleep(3)</span><br><span class="line">        clickElem = myBrowser.find_element_by_css_selector(<span class="string">'div.iron-selected &gt; vt-omnibar:nth-child(2) &gt; div:nth-child(1) &gt; span:nth-child(1) &gt; paper-icon-button:nth-child(3) &gt; iron-icon:nth-child(1)'</span>)</span><br><span class="line">        clickElem.click()</span><br><span class="line"></span><br><span class="line">        <span class="comment"># ******* Tab 2: Cisco Talos *******</span></span><br><span class="line">        myScript = <span class="string">'window.open("'</span> + URL2 + <span class="string">'");'</span></span><br><span class="line">        myBrowser.execute_script(myScript)</span><br><span class="line"></span><br><span class="line">        browserStatusCheck(myBrowser)</span><br><span class="line">        myBrowser.quit()</span><br><span class="line"></span><br><span class="line">    except selenium.common.exceptions.NoSuchElementException:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"[-] ERROR: Unable to locate element. Please re-try..."</span>)</span><br><span class="line">    except selenium.common.exceptions.NoSuchWindowException:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"[-] WARNING: Target window already closed..."</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    try:</span><br><span class="line">        re_domain = re.compile(domain_regex)</span><br><span class="line">        <span class="keyword">if</span> re_domain.match(sys.argv[1]):</span><br><span class="line">            <span class="comment"># ****** Step 1: Call Linux DIG ******</span></span><br><span class="line">            <span class="comment"># For Linux &amp; Mac Platform</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"***************************************\n"</span></span><br><span class="line">                  <span class="string">"***    Domain Reputation Checking   ***\n"</span></span><br><span class="line">                  <span class="string">"****    Powered by DIG|Selenium    ****\n"</span></span><br><span class="line">                  <span class="string">"***************************************"</span>)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> <span class="string">"Windows"</span> not <span class="keyword">in</span> SYSTEM_PLATFORM:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">"[+] Linux DIG Answer Section"</span>)</span><br><span class="line">                <span class="comment"># os.system('dig %s @8.8.8.8 +noall +answer | grep -Ev \'\^\$\' | grep -Ev "^; &lt;&lt;&gt;&gt;" | grep -Ev ";; global"' %(sys.argv[1]))</span></span><br><span class="line">                process = os.popen(<span class="string">'dig %s @8.8.8.8 ANY +noall +answer'</span></span><br><span class="line">                                   <span class="string">'| grep -Ev "^;"'</span></span><br><span class="line">                                   <span class="string">'| grep -Ev ";;"'</span></span><br><span class="line">                                   <span class="string">'| grep -Ev \'</span>^$\<span class="string">''</span></span><br><span class="line">                                   <span class="string">'| sort -k4'</span></span><br><span class="line">                                   % (sys.argv[1]))</span><br><span class="line">                lines = process.readlines()</span><br><span class="line">                <span class="keyword">for</span> line <span class="keyword">in</span> lines:</span><br><span class="line">                    <span class="comment"># Exclusive an empty line using strip()</span></span><br><span class="line">                    line = line.strip()</span><br><span class="line">                    <span class="keyword">if</span> line:</span><br><span class="line">                        <span class="built_in">print</span>(line)</span><br><span class="line">                process.close()</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="comment"># For Windows Platform</span></span><br><span class="line">                <span class="built_in">print</span>(<span class="string">"[+] Windows DIG Answer Section"</span>)</span><br><span class="line">                process = os.popen(<span class="string">'"C:\\Program Files\\dig\\bin\\dig" %s @8.8.8.8 ANY +noall +answer'</span></span><br><span class="line">                                   <span class="string">'| findstr /v "^;"'</span></span><br><span class="line">                                   <span class="string">'| findstr /v ";;"'</span></span><br><span class="line">                                   <span class="string">'| findstr /v \'</span>^$\<span class="string">''</span></span><br><span class="line">                                   <span class="string">'| sort /+4'</span></span><br><span class="line">                                   % (sys.argv[1]))</span><br><span class="line">                lines = process.readlines()</span><br><span class="line">                <span class="keyword">for</span> line <span class="keyword">in</span> lines:</span><br><span class="line">                    <span class="comment"># Exclusive an empty line using strip()</span></span><br><span class="line">                    line = line.strip()</span><br><span class="line">                    <span class="keyword">if</span> line:</span><br><span class="line">                        <span class="built_in">print</span>(line)</span><br><span class="line">                process.close()</span><br><span class="line"></span><br><span class="line">            <span class="comment"># ****** Step 2: Call Selenium ******</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"[+] Please check your web browser\n"</span>)</span><br><span class="line">            seleniumDomainReputation(sys.argv[1])</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">'[-] WARNING: Please type a valid Domain.'</span>)</span><br><span class="line">    except IndexError:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"[-] ERROR: List index out of range"</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="Module-ipReputation-py"><a href="#Module-ipReputation-py" class="headerlink" title="Module - ipReputation.py"></a>Module - ipReputation.py</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys,re,json</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> dns.resolver</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> requests.auth <span class="keyword">import</span> HTTPBasicAuth</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">from</span> pandas <span class="keyword">import</span> Series, DataFrame</span><br><span class="line"></span><br><span class="line"><span class="comment"># IPv4 Validation with Regex</span></span><br><span class="line"><span class="comment">#  ^((1\d&#123;2&#125;|2[0-4]\d|25[0-5]|[1-9]\d|[1-9])\.)</span></span><br><span class="line"><span class="comment">#   ((1\d&#123;2&#125;|2[0-4]\d|25[0-5]|[1-9]\d|\d)\.)&#123;2&#125;</span></span><br><span class="line"><span class="comment">#   (1\d&#123;2&#125;|2[0-4]\d|25[0-5]|[1-9]\d|\d)$</span></span><br><span class="line"><span class="comment"># ip_regex="^((1\d&#123;2&#125;|2[0-4]\d|25[0-5]|[1-9]\d|[1-9])\.)((1\d&#123;2&#125;|2[0-4]\d|25[0-5]|[1-9]\d|\d)\.)&#123;2&#125;(1\d&#123;2&#125;|2[0-4]\d|25[0-5]|[1-9]\d|\d)$"</span></span><br><span class="line">ip_regex=<span class="string">"^(?:(?:1\d&#123;2&#125;|2[0-4]\d|25[0-5]|[1-9]\d|[1-9])\.)(?:(?:1\d&#123;2&#125;|2[0-4]\d|25[0-5]|[1-9]\d|\d)\.)&#123;2&#125;(?:1\d&#123;2&#125;|2[0-4]\d|25[0-5]|[1-9]\d|\d)$"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ipvoidChecker</span><span class="params">(ip)</span>:</span></span><br><span class="line"></span><br><span class="line">    url = <span class="string">"http://www.ipvoid.com/ip-blacklist-check/"</span></span><br><span class="line">    headers = &#123;<span class="string">"Content-Type"</span>: <span class="string">"application/x-www-form-urlencoded"</span>,</span><br><span class="line">               <span class="string">"Referer"</span>:<span class="string">"http://www.ipvoid.com/ip-blacklist-check/"</span>,&#125;</span><br><span class="line">    payload = &#123;<span class="string">'ip'</span>:ip&#125;</span><br><span class="line">    <span class="comment"># Note: Using 'data' instead of 'params'</span></span><br><span class="line">    r = requests.post(url, headers=headers, data=payload)</span><br><span class="line">    returnData = r.content</span><br><span class="line">    soup = BeautifulSoup(returnData, <span class="string">"lxml"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">#mySoup = soup.find('div', &#123;'class': 'responsive'&#125;)</span></span><br><span class="line">    tables = soup.find_all(class_=<span class="string">"table table-striped table-bordered"</span>)</span><br><span class="line"></span><br><span class="line">    column1 = []</span><br><span class="line">    column2 = []</span><br><span class="line">    printResult = <span class="string">''</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> tables !=[]:</span><br><span class="line">        rows = tables[<span class="number">0</span>].findAll(<span class="string">'tr'</span>)</span><br><span class="line">        i = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> tr <span class="keyword">in</span> rows:</span><br><span class="line">            i+=<span class="number">1</span></span><br><span class="line">            cols = tr.findAll(<span class="string">'td'</span>)</span><br><span class="line">            column1.append(cols[<span class="number">0</span>].text)</span><br><span class="line">            column2.append(cols[<span class="number">1</span>].text.</span><br><span class="line">                           replace(<span class="string">" Find Sites | IP Whois"</span>,<span class="string">""</span>).</span><br><span class="line">                           replace(<span class="string">" Google Map"</span>,<span class="string">""</span>))</span><br><span class="line">            <span class="comment">#Get the Blacklist Status</span></span><br><span class="line">            <span class="keyword">if</span> i == <span class="number">3</span>:</span><br><span class="line">                printResult = cols[<span class="number">1</span>].text</span><br><span class="line">    <span class="comment"># Panda Series</span></span><br><span class="line">    column1 = Series(column1)</span><br><span class="line">    column2 = Series(column2)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Concatenate into a DataFrame</span></span><br><span class="line">    legislative_df = pd.concat([column1, column2], axis=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Set up the columns</span></span><br><span class="line">    legislative_df.columns = [<span class="string">'ITEM'</span>, <span class="string">'DATA'</span>]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Show the finished DataFrame</span></span><br><span class="line">    <span class="comment">#print ('[.] IPVoid Result: ')</span></span><br><span class="line">    <span class="comment">#print (legislative_df,'\n\n')</span></span><br><span class="line">    <span class="keyword">return</span> printResult</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sansChecker</span><span class="params">(IPOrDomain)</span>:</span></span><br><span class="line">    <span class="comment"># HTTP Query</span></span><br><span class="line">    url = <span class="string">"https://isc.sans.edu/api/ip/"</span> + IPOrDomain</span><br><span class="line"></span><br><span class="line">    <span class="comment"># If the input value is a domain</span></span><br><span class="line">    re_ip = re.compile(<span class="string">'^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.)&#123;3&#125;(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$'</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> re_ip.match(IPOrDomain):</span><br><span class="line">        <span class="comment">#Try to resolve the domain first</span></span><br><span class="line">        aRecord = []</span><br><span class="line">        my_resolver = dns.resolver.Resolver()</span><br><span class="line">        my_resolver.nameservers = [<span class="string">'8.8.8.8'</span>]</span><br><span class="line">        <span class="keyword">for</span> rdata <span class="keyword">in</span> my_resolver.query(IPOrDomain, <span class="string">"A"</span>):</span><br><span class="line">            aRecord.append(rdata.address)</span><br><span class="line">        <span class="comment"># Only use the 1st A record</span></span><br><span class="line">        url = <span class="string">"https://isc.sans.edu/api/ip/"</span> + aRecord[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Our actual checking begins from here</span></span><br><span class="line">    printResult = []</span><br><span class="line">    myResult = requests.get(url)</span><br><span class="line">    c = myResult.content</span><br><span class="line">    soup = BeautifulSoup(c, <span class="string">"lxml"</span>)</span><br><span class="line">    mySoup = soup.find(<span class="string">'error'</span>)</span><br><span class="line">    <span class="comment"># #print ('[.] SANS Result:')</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># If the input IP has a correct format</span></span><br><span class="line">    <span class="keyword">if</span> mySoup <span class="keyword">is</span> <span class="keyword">None</span>:</span><br><span class="line">        c = myResult.content</span><br><span class="line">        soup = BeautifulSoup(c, <span class="string">"lxml"</span>)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            reportedTimes = soup.find(<span class="string">'count'</span>)</span><br><span class="line">            <span class="keyword">if</span> reportedTimes.text != <span class="string">''</span>:</span><br><span class="line">                <span class="comment">#print ('Report Times ' + reportedTimes.text)</span></span><br><span class="line">                printResult.append(<span class="string">'Report Times '</span> + reportedTimes.text)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="comment">#print ('Report Times 0')</span></span><br><span class="line">                printResult.append(<span class="string">"Report Times 0"</span>)</span><br><span class="line">        <span class="keyword">except</span> Exception:</span><br><span class="line">            <span class="comment">#print ('Report Times 0')</span></span><br><span class="line">            printResult.append(<span class="string">"Report Times 0"</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            targets = soup.find(<span class="string">'attacks'</span>)</span><br><span class="line">            <span class="keyword">if</span> targets.text != <span class="string">''</span>:</span><br><span class="line">                <span class="comment">#print ('Total Targets ' + targets.text)</span></span><br><span class="line">                printResult.append(<span class="string">'Total Targets '</span> + targets.text)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="comment">#print ('Total Targets 0')</span></span><br><span class="line">                printResult.append(<span class="string">'Total Targets 0'</span>)</span><br><span class="line">        <span class="keyword">except</span> Exception:</span><br><span class="line">            <span class="comment">#print ('Total Targets 0')</span></span><br><span class="line">            printResult.append(<span class="string">'Total Targets 0'</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            firstReported = soup.find(<span class="string">'mindate'</span>)</span><br><span class="line">            <span class="keyword">if</span> firstReported.text != <span class="string">''</span>:</span><br><span class="line">                <span class="comment">#print ('First Reported ' + firstReported.text)</span></span><br><span class="line">                printResult.append(<span class="string">'First Reported '</span> + firstReported.text)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="comment">#print ('First Reported 0')</span></span><br><span class="line">                printResult.append(<span class="string">'First Reported 0'</span>)</span><br><span class="line">        <span class="keyword">except</span> Exception:</span><br><span class="line">            <span class="comment">#print ('First Reported 0')</span></span><br><span class="line">            printResult.append(<span class="string">'First Reported 0'</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            latestReported = soup.find(<span class="string">'updated'</span>)</span><br><span class="line">            <span class="keyword">if</span> latestReported.text != <span class="string">''</span>:</span><br><span class="line">                <span class="comment">#print ('Recent Report ' + latestReported.text)</span></span><br><span class="line">                printResult.append(<span class="string">'Recent Report '</span> + latestReported.text)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="comment">#print ('Recent Report 0')</span></span><br><span class="line">                printResult.append(<span class="string">'Recent Report 0'</span>)</span><br><span class="line">        <span class="keyword">except</span> Exception:</span><br><span class="line">            <span class="comment">#print ('Recent Report 0')</span></span><br><span class="line">            printResult.append(<span class="string">'Recent Report 0'</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment">#print ("\n")</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Elif the input IP is wrong</span></span><br><span class="line">    <span class="keyword">elif</span> mySoup.text == <span class="string">'bad IP address'</span>:</span><br><span class="line">        <span class="comment">#print ('We expected a valid IP address.')</span></span><br><span class="line">        exit()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> printResult</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">abuseipdbChecker</span><span class="params">(url)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># e.g. url = "https://www.abuseipdb.com/check/220.191.211.7"</span></span><br><span class="line">    <span class="comment">#      url = "https://www.abuseipdb.com/check/baidu.com"</span></span><br><span class="line">    <span class="comment"># HTTP Query</span></span><br><span class="line">    myResult = requests.get(url)</span><br><span class="line">    printResult = <span class="string">''</span></span><br><span class="line">    <span class="comment">#print ("[.] AbuseIPDB Result:")</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># if the input value is invalid, such as 'baidu.comx', 'x.x.x.x.x', etc.</span></span><br><span class="line">    <span class="comment"># Invalid Input: '422 Unprocessable Entity'</span></span><br><span class="line">    <span class="keyword">if</span> myResult.status_code == <span class="number">422</span>:</span><br><span class="line">        <span class="comment">#print ('Error: 422 Unprocessable Entity (e.g. http://www.com)')</span></span><br><span class="line">        <span class="comment">#print ("We expected a valid IP address or Domain name.")</span></span><br><span class="line">        exit()</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="comment"># If domain resolved to an IP</span></span><br><span class="line">        <span class="keyword">if</span> url != myResult.url:</span><br><span class="line">            <span class="keyword">print</span> (<span class="string">"Your request has been resolved to "</span>) + myResult.url</span><br><span class="line">        c = myResult.content</span><br><span class="line">        soup = BeautifulSoup(c, <span class="string">"lxml"</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Part 1: Locate the reporting times that we want</span></span><br><span class="line">        <span class="comment"># reportTimes = soup.find_all(class_="well")</span></span><br><span class="line">        mySoup = soup.find(<span class="string">'div'</span>, &#123;<span class="string">'class'</span>: <span class="string">'col-md-6'</span>&#125;)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Http Response code is still 200 but we got a message:</span></span><br><span class="line">        <span class="comment">#      'We can't resolve the domain www.comz! Please try your query again.'</span></span><br><span class="line">        <span class="keyword">if</span> mySoup <span class="keyword">is</span> <span class="keyword">None</span>:</span><br><span class="line">            <span class="keyword">print</span> (<span class="string">'We expected a valid IP address or Domain name.'</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># Get the first 'p' tag in &lt;div class="well"&gt;</span></span><br><span class="line">            <span class="comment"># You can only put 'find_all' after 'find'</span></span><br><span class="line">            pTag = mySoup.find(<span class="string">'p'</span>)</span><br><span class="line">            reportTimes = pTag.find(<span class="string">'b'</span>)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># Print reporting times</span></span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="keyword">if</span> reportTimes.string == <span class="string">"Important Note:"</span>:</span><br><span class="line">                    <span class="comment">#print ("Note: You probably input a private IP. Please check again ...")</span></span><br><span class="line">                    exit()</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="comment">#print ("Reported" + reportTimes.string + " times")</span></span><br><span class="line">                    printResult = <span class="string">'Reported '</span> + reportTimes.string + <span class="string">' times'</span></span><br><span class="line">            <span class="comment"># if result equals 'None'</span></span><br><span class="line">            <span class="keyword">except</span> Exception:</span><br><span class="line">                reportTimes = <span class="number">0</span></span><br><span class="line">                <span class="comment">#print ('Reported ' + str(reportTimes) + ' times')</span></span><br><span class="line">                printResult = <span class="string">'Reported '</span> + str(reportTimes) + <span class="string">' times'</span></span><br><span class="line">                <span class="comment">#print ('')</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># Part 2: Locate the table that we want</span></span><br><span class="line">            tables = soup.find_all(class_=<span class="string">"table table-striped responsive-table"</span>)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> tables != []:</span><br><span class="line">                <span class="comment"># Use BeautifulSoup to find the table entries with a For Loop</span></span><br><span class="line">                rawData = []</span><br><span class="line"></span><br><span class="line">                <span class="comment"># Looking for every row in a table</span></span><br><span class="line">                <span class="comment"># table[0] is just the format for BeautifulSoup</span></span><br><span class="line">                rows = tables[<span class="number">0</span>].findAll(<span class="string">'tr'</span>)</span><br><span class="line"></span><br><span class="line">                <span class="keyword">for</span> tr <span class="keyword">in</span> rows:</span><br><span class="line">                    cols = tr.findAll(<span class="string">'td'</span>)</span><br><span class="line">                    <span class="keyword">for</span> td <span class="keyword">in</span> cols:</span><br><span class="line">                        <span class="comment"># data-title = "Reporter"</span></span><br><span class="line">                        text = cols[<span class="number">0</span>].text</span><br><span class="line">                        rawData.append(text)</span><br><span class="line">                        <span class="comment"># data-title = "Date"</span></span><br><span class="line">                        text = cols[<span class="number">1</span>].text</span><br><span class="line">                        rawData.append(text)</span><br><span class="line">                        <span class="string">'''</span></span><br><span class="line"><span class="string">                        # data-title = "Comment" (Ingnored)</span></span><br><span class="line"><span class="string">                        text = cols[2].text</span></span><br><span class="line"><span class="string">                        rawData.append(text)</span></span><br><span class="line"><span class="string">                        '''</span></span><br><span class="line">                        <span class="comment"># data-title = "Categories"</span></span><br><span class="line">                        text = cols[<span class="number">3</span>].text + <span class="string">'\n'</span></span><br><span class="line">                        rawData.append(text)</span><br><span class="line"></span><br><span class="line">                <span class="comment"># Modify rawData</span></span><br><span class="line">                reporter = []</span><br><span class="line">                date = []</span><br><span class="line">                category = []</span><br><span class="line"></span><br><span class="line">                itemNum = len(rawData)</span><br><span class="line">                index = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">                <span class="comment"># For 'reporter'</span></span><br><span class="line">                index1 = <span class="number">0</span></span><br><span class="line">                <span class="comment"># For 'date'</span></span><br><span class="line">                index2 = <span class="number">1</span></span><br><span class="line">                <span class="comment"># For 'category'</span></span><br><span class="line">                index3 = <span class="number">2</span></span><br><span class="line"></span><br><span class="line">                <span class="keyword">for</span> index <span class="keyword">in</span> range(<span class="number">0</span>, itemNum - <span class="number">1</span>):</span><br><span class="line">                    <span class="comment"># Make sure this loop will not exceed the limit</span></span><br><span class="line">                    <span class="keyword">if</span> index1 &lt;= itemNum - <span class="number">3</span>:</span><br><span class="line">                        <span class="comment"># Reporter</span></span><br><span class="line">                        reporter.append(rawData[index1].replace(<span class="string">'\n'</span>, <span class="string">''</span>))</span><br><span class="line">                        index1 += <span class="number">3</span></span><br><span class="line"></span><br><span class="line">                        <span class="comment"># Date</span></span><br><span class="line">                        date.append(rawData[index2].replace(<span class="string">'\n'</span>, <span class="string">''</span>))</span><br><span class="line">                        index2 += <span class="number">3</span></span><br><span class="line"></span><br><span class="line">                        <span class="comment"># Category</span></span><br><span class="line">                        category.append(rawData[index3].replace(<span class="string">'\n\n'</span>, <span class="string">' | '</span>).replace(<span class="string">'\n'</span>, <span class="string">' | '</span>))</span><br><span class="line">                        index3 += <span class="number">3</span></span><br><span class="line"></span><br><span class="line">                        <span class="comment"># Global Index</span></span><br><span class="line">                        index += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">                <span class="comment"># Panda Series</span></span><br><span class="line">                reporter = Series(reporter)</span><br><span class="line">                date = Series(date)</span><br><span class="line">                category = Series(category)</span><br><span class="line"></span><br><span class="line">                <span class="comment"># Concatenate into a DataFrame</span></span><br><span class="line">                pd.set_option(<span class="string">'display.width'</span>, <span class="number">5000</span>)</span><br><span class="line">                legislative_df = pd.concat([date, reporter, category], axis=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">                <span class="comment"># Set up the columns</span></span><br><span class="line">                legislative_df.columns = [<span class="string">'Date'</span>, <span class="string">'Reporter'</span>, <span class="string">'Category'</span>]</span><br><span class="line"></span><br><span class="line">                <span class="comment"># Delete the dups and reset index (and drop the old index)</span></span><br><span class="line">                legislative_df = legislative_df.drop_duplicates().reset_index(drop=<span class="keyword">True</span>)</span><br><span class="line"></span><br><span class="line">                <span class="comment"># Show the finished DataFrame</span></span><br><span class="line">                <span class="comment">#Using IPython instead ($ sudo pip install ipython)</span></span><br><span class="line">                <span class="comment">#print legislative_df,</span></span><br><span class="line">                <span class="comment">#display(legislative_df)</span></span><br><span class="line"></span><br><span class="line">                <span class="comment">#print ('')</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> printResult</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">myXForceChecker</span><span class="params">(url)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># User: XXXXX-XXXXX-XXXXX-XXXXX-XXXXX</span></span><br><span class="line">    <span class="comment"># Password: XXXXX-7238-4ad7-bc09-XXXXXXXXXX</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Auth first</span></span><br><span class="line">    <span class="comment">#print ('')</span></span><br><span class="line">    <span class="comment">#print ('[.] IBM X-Force Result:')</span></span><br><span class="line"></span><br><span class="line">    printResult = []</span><br><span class="line">    <span class="comment"># e.g. url = "https://exchange.xforce.ibmcloud.com/ip//114.200.4.207"</span></span><br><span class="line">    <span class="comment"># IP Report</span></span><br><span class="line">    myResult1 = requests.get(url, auth=HTTPBasicAuth(<span class="string">'XXXXX-XXXXX-XXXXX-XXXXX-XXXXX'</span>,</span><br><span class="line">                                                     <span class="string">'XXXXX-7238-4ad7-bc09-XXXXXXXXXX'</span>))</span><br><span class="line">    c1 = myResult1.content</span><br><span class="line">    myJson1 = json.loads(c1)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;  IP/Domain Report Check &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span></span><br><span class="line">    <span class="comment"># ...........</span></span><br><span class="line">    <span class="string">'''</span></span><br><span class="line"><span class="string">    # indent = 2</span></span><br><span class="line"><span class="string">    # json.dumps() change data to python dictionary</span></span><br><span class="line"><span class="string">    # sortedData = json.dumps(myJson1, sort_keys=True, indent=2)</span></span><br><span class="line"><span class="string">    # print sortedData</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#----------These three keys are for IP checker----------</span></span><br><span class="line">    <span class="comment"># [Print] Geo information</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">"geo"</span> <span class="keyword">in</span> myJson1:</span><br><span class="line">        <span class="keyword">for</span> key, value <span class="keyword">in</span> myJson1[<span class="string">"geo"</span>].items():</span><br><span class="line">            geo = <span class="string">"Country"</span> + <span class="string">": "</span> + str(value)</span><br><span class="line">            <span class="comment">#print (geo)</span></span><br><span class="line">            printResult.append(geo)</span><br><span class="line">            <span class="comment"># Only print country</span></span><br><span class="line">            <span class="comment"># (Ingore country code)</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="comment"># [Print] Overrall Risk Score</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">"score"</span> <span class="keyword">in</span> myJson1:</span><br><span class="line">        <span class="keyword">if</span> myJson1[<span class="string">"score"</span>] == <span class="number">1</span>:</span><br><span class="line">            <span class="comment">#print ("Risk Score: " + str(myJson1["score"]) + " (low)")</span></span><br><span class="line">            printResult.append(<span class="string">"Risk Score: "</span> + str(myJson1[<span class="string">"score"</span>]) + <span class="string">" (low)"</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment">#print ("Risk Score: " + str(myJson1["score"]))</span></span><br><span class="line">            printResult.append(<span class="string">"Risk Score: "</span> + str(myJson1[<span class="string">"score"</span>]))</span><br><span class="line">    <span class="comment"># [Print] Categorization:</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">"cats"</span> <span class="keyword">in</span> myJson1:</span><br><span class="line">        <span class="keyword">if</span> myJson1[<span class="string">"cats"</span>]:</span><br><span class="line">            <span class="keyword">for</span> key, value <span class="keyword">in</span> myJson1[<span class="string">"cats"</span>].items():</span><br><span class="line">                cat = str(key) + <span class="string">" ("</span> + str(value) + <span class="string">"%)"</span></span><br><span class="line">                <span class="comment">#print ("Categorization: " + cat)</span></span><br><span class="line">                printResult.append(<span class="string">"Categorization: "</span> + cat)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment">#print ("Categorization: Unsuspicious")</span></span><br><span class="line">            printResult.append(<span class="string">"Categorization: Unsuspicious"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># ----------These keys are for Domain checker----------</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">"result"</span> <span class="keyword">in</span> myJson1:</span><br><span class="line">        myJsonResult = myJson1[<span class="string">"result"</span>]</span><br><span class="line">        <span class="keyword">if</span> myJsonResult[<span class="string">"score"</span>] == <span class="number">1</span>:</span><br><span class="line">            <span class="comment">#print ("Risk Score: " + str(myJsonResult["score"]) + " (low)")</span></span><br><span class="line">            printResult.append(<span class="string">"Risk Score: "</span> + str(myJsonResult[<span class="string">"score"</span>]) + <span class="string">" (low)"</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment">#print ("Risk Score: " + str(myJsonResult["score"]))</span></span><br><span class="line">            printResult.append(<span class="string">"Risk Score: "</span> + str(myJsonResult[<span class="string">"score"</span>]))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> myJsonResult[<span class="string">"categoryDescriptions"</span>]:</span><br><span class="line">            <span class="keyword">for</span> key, value <span class="keyword">in</span> myJsonResult[<span class="string">"categoryDescriptions"</span>].items():</span><br><span class="line">                cat = <span class="string">"&lt;"</span> + str(key).replace(<span class="string">" / "</span>, <span class="string">"|"</span>) + <span class="string">"&gt;: "</span> + str(value)</span><br><span class="line">                <span class="comment">#print (cat)</span></span><br><span class="line">                printResult.append(cat)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> printResult</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ipReputationChecker</span><span class="params">()</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Call ipvoid.py</span></span><br><span class="line">    myIPvoidPrint1 = ipvoidChecker(sys.argv[<span class="number">1</span>])</span><br><span class="line">    <span class="comment"># Call sans.py</span></span><br><span class="line">    mySansPrint2 = sansChecker(sys.argv[<span class="number">1</span>])</span><br><span class="line">    <span class="comment"># Call abuseipdb.py</span></span><br><span class="line">    myAbuseIPDBPrint3 = abuseipdbChecker(<span class="string">"https://www.abuseipdb.com/check/"</span> + sys.argv[<span class="number">1</span>])</span><br><span class="line">    <span class="comment"># Call xforceIBM.py</span></span><br><span class="line">    myXForcePrint4 = myXForceChecker(<span class="string">"https://api.xforce.ibmcloud.com/ipr/"</span> + sys.argv[<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">    message = <span class="string">"****************************************\n"</span> +\</span><br><span class="line">              <span class="string">"****     IP Reputation Checking     ****\n"</span> +\</span><br><span class="line">              <span class="string">"**** [IPVoid|SANS|AbuseIPDB|xForce] ****\n"</span> +\</span><br><span class="line">              <span class="string">"****************************************\n"</span></span><br><span class="line">    message = message + \</span><br><span class="line">              <span class="string">"[+] IP Reputation Result"</span> + <span class="string">'\n'</span> +\</span><br><span class="line">              <span class="string">"IPVoid Result: "</span> + myIPvoidPrint1 + <span class="string">'\n'</span> +\</span><br><span class="line">              <span class="string">"SANS Result: "</span> + <span class="string">' | '</span>.join(mySansPrint2) + <span class="string">'\n'</span> +\</span><br><span class="line">              <span class="string">"AbuseIPDB Result: "</span> + myAbuseIPDBPrint3 + <span class="string">'\n'</span> +\</span><br><span class="line">              <span class="string">"XForce Result:  "</span> + <span class="string">' | '</span>.join(myXForcePrint4)</span><br><span class="line">    print(message)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        re_ip = re.compile(ip_regex)</span><br><span class="line">        <span class="keyword">if</span> re_ip.match(sys.argv[<span class="number">1</span>]):</span><br><span class="line">            <span class="comment"># print('[+] IP Regex successful matches ...')</span></span><br><span class="line">            ipReputationChecker()</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            print(<span class="string">'[-] WARNING: Please type a valid IPv4 address.'</span>)</span><br><span class="line">    <span class="keyword">except</span> IndexError:</span><br><span class="line">        print(<span class="string">"[-] ERROR: List index out of range"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    main()</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="Module-ipwhois-py"><a href="#Module-ipwhois-py" class="headerlink" title="Module - ipwhois.py"></a>Module - ipwhois.py</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">from</span> ipwhois <span class="keyword">import</span> IPWhois</span><br><span class="line"><span class="keyword">from</span> pprint <span class="keyword">import</span> pprint</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ipWhois</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="comment"># Call backup_myIPwhois.py</span></span><br><span class="line">    <span class="comment"># myIPwhois.IPWhoisChecker("https://www.abuseipdb.com/whois/" + sys.argv[1])</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># IPWhois (pip3 install ipwhois == 0.10.3)</span></span><br><span class="line">    ipwhoisInfo = IPWhois(sys.argv[<span class="number">1</span>])</span><br><span class="line">    ipwhoisResults = ipwhoisInfo.lookup_rws()</span><br><span class="line">    pprint(ipwhoisResults)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    ipWhois()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>
<h3 id="Module-sidSearchET-py"><a href="#Module-sidSearchET-py" class="headerlink" title="Module - sidSearchET.py"></a>Module - sidSearchET.py</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys,re,platform</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> selenium,time</span><br><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.remote.command <span class="keyword">import</span> Command</span><br><span class="line"><span class="keyword">from</span> selenium.common.exceptions <span class="keyword">import</span> WebDriverException</span><br><span class="line"></span><br><span class="line">sid_regex=<span class="string">"^[0-9]+$"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">browserStatusCheck</span><span class="params">(myBrowser)</span>:</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">180</span>):</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="comment"># It will return 'True' is Web Browser remains opened ..</span></span><br><span class="line">            myBrowser.title</span><br><span class="line">            time.sleep(<span class="number">0.5</span>)</span><br><span class="line">        <span class="keyword">except</span> WebDriverException <span class="keyword">as</span> w:</span><br><span class="line">            print(w)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">seleniumSignatureSearch</span><span class="params">()</span>:</span></span><br><span class="line"></span><br><span class="line">    sid = sys.argv[<span class="number">1</span>]</span><br><span class="line">    URL = <span class="string">"http://docs.emergingthreats.net/bin/view/Main/WebSearch?search="</span> + sid + <span class="string">"&amp;scope=all"</span></span><br><span class="line"></span><br><span class="line">    systemPlatform = platform.system()</span><br><span class="line">    <span class="keyword">if</span> <span class="string">"Windows"</span> <span class="keyword">in</span> systemPlatform:</span><br><span class="line">        myBrowser = webdriver.Chrome(<span class="string">'C:\Windows\System32\chromedriver.exe'</span>)</span><br><span class="line">    <span class="keyword">elif</span> <span class="string">"Darwin"</span> <span class="keyword">in</span> systemPlatform:</span><br><span class="line">        myBrowser = webdriver.Chrome(<span class="string">'/usr/local/bin/chromedriver'</span>)</span><br><span class="line">    <span class="keyword">elif</span> <span class="string">"Linux"</span> <span class="keyword">in</span> systemPlatform:</span><br><span class="line">        myBrowser = webdriver.Chrome(<span class="string">'/usr//bin/chromedriver'</span>)</span><br><span class="line"></span><br><span class="line">    myBrowser.get(URL);</span><br><span class="line">    browserStatusCheck(myBrowser)</span><br><span class="line">    myBrowser.quit()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        re_signature = re.compile(sid_regex)</span><br><span class="line">        <span class="keyword">if</span> re_signature.match(sys.argv[<span class="number">1</span>]):</span><br><span class="line">            <span class="comment"># Call ET(Snort) Web Searcher</span></span><br><span class="line">            print(<span class="string">"\n"</span></span><br><span class="line">                  <span class="string">"***************************************\n"</span></span><br><span class="line">                  <span class="string">"**** ET (Snort) Signature Checking ****\n"</span></span><br><span class="line">                  <span class="string">"****       Powered by Selenium     ****\n"</span></span><br><span class="line">                  <span class="string">"***************************************\n"</span></span><br><span class="line">                  <span class="string">"[+] Please check your web browser ...\n"</span>)</span><br><span class="line">            seleniumSignatureSearch()</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            print(<span class="string">'[-] WARNING: Please type a valid Signature.'</span>)</span><br><span class="line">    <span class="keyword">except</span> IndexError:</span><br><span class="line">        print(<span class="string">"[-] ERROR: List index out of range"</span>)</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/11/20/Python-Regex/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Patrick Dong">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Superpb9">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/11/20/Python-Regex/" itemprop="url">[Python] Regex</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-11-20T08:44:00+13:00">
                2018-11-20
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><strong>Tags to use</strong></p>
<table>
<thead>
<tr>
<th style="text-align:left">Element</th>
<th style="text-align:left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">.</td>
<td style="text-align:left">This element matches any character except \n</td>
</tr>
<tr>
<td style="text-align:left">\d</td>
<td style="text-align:left">This matches any digit [0-9]</td>
</tr>
<tr>
<td style="text-align:left">\D</td>
<td style="text-align:left">This matches non-digit characters [^0-9]</td>
</tr>
<tr>
<td style="text-align:left">\s</td>
<td style="text-align:left">This matches whitespace character [ \t\n\r\f\v]</td>
</tr>
<tr>
<td style="text-align:left">\S</td>
<td style="text-align:left">This matches whitespace character [^ \t\n\r\f\v]</td>
</tr>
<tr>
<td style="text-align:left">\w</td>
<td style="text-align:left">This matches alphanumeric character [a-zA-Z0-9]</td>
</tr>
<tr>
<td style="text-align:left">\W</td>
<td style="text-align:left">This matches any non-alphanumeric character [^a-zA-Z0-9]</td>
</tr>
</tbody>
</table>
<p><strong>Quantifiers to use</strong></p>
<table>
<thead>
<tr>
<th style="text-align:left">Quantifier</th>
<th style="text-align:left">Description</th>
<th style="text-align:left">Example</th>
<th style="text-align:left">Sample match</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">+</td>
<td style="text-align:left">one or more</td>
<td style="text-align:left">\w+</td>
<td style="text-align:left">ABCDEF097</td>
</tr>
<tr>
<td style="text-align:left">{2}</td>
<td style="text-align:left">exactly 2 times</td>
<td style="text-align:left">\d{2}</td>
<td style="text-align:left">01</td>
</tr>
<tr>
<td style="text-align:left">{1,}</td>
<td style="text-align:left">one or more times</td>
<td style="text-align:left">\w{1,}</td>
<td style="text-align:left">smiling</td>
</tr>
<tr>
<td style="text-align:left">{2,4}</td>
<td style="text-align:left">2 to 4 times</td>
<td style="text-align:left">\w{2,4}</td>
<td style="text-align:left">1234</td>
</tr>
<tr>
<td style="text-align:left">*</td>
<td style="text-align:left">0 or more times</td>
<td style="text-align:left">A*B</td>
<td style="text-align:left">AAAAB</td>
</tr>
<tr>
<td style="text-align:left">?</td>
<td style="text-align:left">once or none (lazy)</td>
<td style="text-align:left">\d+?</td>
<td style="text-align:left">1 in 12345</td>
</tr>
</tbody>
</table>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/09/09/bash-pdfscraping/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Patrick Dong">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Superpb9">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/09/09/bash-pdfscraping/" itemprop="url">[Bash] PDF Scraping</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-09-09T15:43:00+12:00">
                2018-09-09
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Security-Automation/" itemprop="url" rel="index">
                    <span itemprop="name">Security Automation</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Main-Code-block-‘pdfscraping-sh’"><a href="#Main-Code-block-‘pdfscraping-sh’" class="headerlink" title="Main Code block ‘pdfscraping.sh’"></a>Main Code block ‘pdfscraping.sh’</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># This script is to grep the useful data from PDF</span></span><br><span class="line"><span class="comment"># Pre-requisite: poppler-utils, mutt, ssmtp(/etc/ssmtp/ssmtp.conf), getmail4</span></span><br><span class="line"></span><br><span class="line">CURRENT_DIR=<span class="string">"<span class="variable">$(pwd)</span>"</span></span><br><span class="line">FILE_LIST=<span class="string">"<span class="variable">$(ls -la | grep -E '*[.][pP][dD][fF]$')</span>"</span></span><br><span class="line">BANNER+=<span class="string">"<span class="variable">$(echo -e "#######################################\n--- XXX Vulnerability Report View</span></span></span><br><span class="line"><span class="string"><span class="variable">er ---\n------  Author: pippo9 Sep 2018  ------\n#######################################")</span>"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Define a usage() function</span></span><br><span class="line"><span class="function"><span class="title">usage</span></span> ()&#123;</span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"Usage: <span class="variable">$&#123;0&#125;</span> [-e RECEIVER]"</span> &gt;&amp;2</span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"The script will automatically process any PDF files under the current directory, which</span></span><br><span class="line"><span class="string"> is <span class="variable">$&#123;CURRENT_DIR&#125;</span>."</span> &gt;&amp;2</span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"    -e   Archieve PDF files and send an email."</span> &gt;&amp;2</span><br><span class="line">  <span class="built_in">exit</span> 1</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># Allow user to specify the following options:</span></span><br><span class="line"><span class="comment"># Any other option will cause the script to display a usage statement</span></span><br><span class="line"><span class="keyword">while</span> <span class="built_in">getopts</span> e: OPTION</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">  <span class="keyword">case</span>  <span class="variable">$&#123;OPTION&#125;</span> <span class="keyword">in</span></span><br><span class="line">    e) SEND_EMAIL=<span class="string">'true'</span> RECEIVER=<span class="string">"<span class="variable">$&#123;OPTARG&#125;</span>"</span> ;;</span><br><span class="line">    ?) usage ;;</span><br><span class="line">  <span class="keyword">esac</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Ingore all the optional arguments</span></span><br><span class="line"><span class="comment"># Remove the options while leaving the remaining arguments.</span></span><br><span class="line"><span class="comment"># OPTIND is set to the index of the first non-option argument, and name is set to ?</span></span><br><span class="line"><span class="built_in">shift</span> <span class="string">"<span class="variable">$(( OPTIND - 1 )</span>)"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># If unable to matching any file with extention of ".pdf", ".PDF", etc.</span></span><br><span class="line"><span class="keyword">if</span> [[ <span class="string">"<span class="variable">$&#123;FILE_LIST&#125;</span>"</span> = <span class="string">""</span> ]]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">  usage</span><br><span class="line">  <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Using awk to exclude Columns 1 to Columns 8</span></span><br><span class="line"><span class="comment"># each PDF file name will be saved into the below variable</span></span><br><span class="line">FILE_NAME=<span class="string">"<span class="variable">$(echo "$&#123;FILE_LIST&#125;" | awk '&#123;$1=$2=$3=$4=$5=$6=$7=$8=""; print $0&#125;' | sed 's/^[ \t</span></span></span><br><span class="line"><span class="string"><span class="variable">]*//')</span>"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Display script banner</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"<span class="variable">$&#123;BANNER&#125;</span>"</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">""</span></span><br><span class="line"><span class="comment"># Declare an array ARR_LIST for archiving purposes</span></span><br><span class="line"><span class="comment"># Declare an array EMAIL_CONTENT used for email sending</span></span><br><span class="line"><span class="built_in">declare</span> -a ARR_LIST</span><br><span class="line"><span class="built_in">declare</span> -a EMAIL_CONTENT</span><br><span class="line">EMAIL_CONTENT+=(<span class="string">"<span class="variable">$&#123;BANNER&#125;</span>"</span>)</span><br><span class="line">EMAIL_CONTENT+=(<span class="string">""</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Using WHILE Loop to process all the PDF files</span></span><br><span class="line"><span class="keyword">while</span> <span class="built_in">read</span> line</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">  <span class="comment"># Display the processing file name</span></span><br><span class="line">  NOW_PROCESSING=(<span class="string">"Now processing <span class="variable">$&#123;line&#125;</span> ..."</span>)</span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"<span class="variable">$&#123;NOW_PROCESSING&#125;</span>"</span></span><br><span class="line">  EMAIL_CONTENT+=(<span class="string">"<span class="variable">$&#123;NOW_PROCESSING&#125;</span>"</span>)</span><br><span class="line">  <span class="comment"># Report generating date checking</span></span><br><span class="line">  <span class="comment"># SERVER_NAME_IP=$(pdftotext -f 1 -l 1 "$&#123;line&#125;" - | grep '(')</span></span><br><span class="line">  AUDITED=$(pdftotext <span class="string">"<span class="variable">$&#123;line&#125;</span>"</span> - | grep <span class="string">'Audited on'</span> | awk -F <span class="string">'on '</span> <span class="string">'&#123;print $2&#125;'</span>)</span><br><span class="line">  REPORTED=$(pdftotext <span class="string">"<span class="variable">$&#123;line&#125;</span>"</span> - | grep <span class="string">'Reported on'</span> | awk -F <span class="string">'on '</span> <span class="string">'&#123;print $2&#125;'</span>)</span><br><span class="line">  <span class="comment"># If it's an invaild PDF</span></span><br><span class="line">  <span class="keyword">if</span> [[ <span class="string">"<span class="variable">$&#123;AUDITED&#125;</span>"</span> = <span class="string">""</span> &amp;&amp; <span class="string">"<span class="variable">$&#123;REPORTED&#125;</span>"</span> = <span class="string">""</span> ]]</span><br><span class="line">  <span class="keyword">then</span></span><br><span class="line">    TEMP1=$(<span class="built_in">echo</span> <span class="string">"Whoops, looks like it is not a valid vulnerability report"</span>)</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"<span class="variable">$&#123;TEMP1&#125;</span>"</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">""</span></span><br><span class="line">    EMAIL_CONTENT+=(<span class="string">"<span class="variable">$&#123;TEMP1&#125;</span>"</span>)</span><br><span class="line">    EMAIL_CONTENT+=(<span class="string">"<span class="variable">$(echo "")</span>"</span>)</span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">  <span class="comment"># If 'audited date' equals 'reported date'</span></span><br><span class="line">  <span class="keyword">if</span> [[ <span class="string">"<span class="variable">$&#123;AUDITED&#125;</span>"</span> = *<span class="string">"<span class="variable">$&#123;REPORTED&#125;</span>"</span>* &amp;&amp; <span class="string">"<span class="variable">$&#123;AUDITED&#125;</span>"</span> != <span class="string">""</span> ]]</span><br><span class="line">  <span class="keyword">then</span></span><br><span class="line">    ARR_LIST+=(<span class="string">"<span class="variable">$&#123;line&#125;</span>"</span>)</span><br><span class="line">    TEMP2=$(pdftotext <span class="string">"<span class="variable">$&#123;line&#125;</span>"</span> - | grep -E <span class="string">'vulnerability was discovered|vulnerabilities were</span></span><br><span class="line"><span class="string"> discovered'</span> | cut -b 4-)</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"<span class="variable">$&#123;TEMP2&#125;</span>"</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">""</span></span><br><span class="line">    EMAIL_CONTENT+=(<span class="string">"<span class="variable">$&#123;TEMP2&#125;</span>"</span>)</span><br><span class="line">    EMAIL_CONTENT+=(<span class="string">"<span class="variable">$(echo "")</span>"</span>)</span><br><span class="line">    <span class="built_in">continue</span></span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">  <span class="comment"># If 'audited date' does not equal 'reported date'</span></span><br><span class="line">  <span class="keyword">if</span> [[ <span class="string">"<span class="variable">$&#123;AUDITED&#125;</span>"</span> != <span class="string">"<span class="variable">$&#123;REPORTED&#125;</span>"</span> &amp;&amp; <span class="string">"<span class="variable">$&#123;AUDITED&#125;</span>"</span> != <span class="string">""</span> ]]</span><br><span class="line">  <span class="keyword">then</span></span><br><span class="line">    ARR_LIST+=(<span class="string">"<span class="variable">$&#123;line&#125;</span>"</span>)</span><br><span class="line">    TEMP3_1=$(<span class="built_in">echo</span> <span class="string">"Info: Audited Date does not equal Reported Date."</span>)</span><br><span class="line">    TEMP3_2=$(<span class="built_in">echo</span> <span class="string">"Audited on <span class="variable">$&#123;AUDITED&#125;</span>"</span>)</span><br><span class="line">    TEMP3_3=$(<span class="built_in">echo</span> <span class="string">"Reported on <span class="variable">$&#123;REPORTED&#125;</span>"</span>)</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"<span class="variable">$&#123;TEMP3_1&#125;</span>"</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"<span class="variable">$&#123;TEMP3_2&#125;</span>"</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"<span class="variable">$&#123;TEMP3_3&#125;</span>"</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">""</span></span><br><span class="line">    EMAIL_CONTENT+=(<span class="string">"<span class="variable">$&#123;TEMP3_1&#125;</span>"</span>)</span><br><span class="line">    EMAIL_CONTENT+=(<span class="string">"<span class="variable">$&#123;TEMP3_2&#125;</span>"</span>)</span><br><span class="line">    EMAIL_CONTENT+=(<span class="string">"<span class="variable">$&#123;TEMP3_3&#125;</span>"</span>)</span><br><span class="line">    EMAIL_CONTENT+=(<span class="string">"<span class="variable">$(echo "")</span>"</span>)</span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span> &lt;&lt;&lt; <span class="string">"<span class="variable">$(echo -e "$&#123;FILE_NAME&#125;")</span>"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Archieve and remove the PDFs in which Audited Date equals Reported Date</span></span><br><span class="line"><span class="comment"># FILE Naming Convention: XXX-$(date +%d%m%y).tar.gz</span></span><br><span class="line"><span class="keyword">if</span> [[ <span class="variable">$&#123;SEND_EMAIL&#125;</span> == <span class="string">"true"</span> &amp;&amp; <span class="string">"<span class="variable">$&#123;ARR_LIST&#125;</span>"</span> != <span class="string">""</span> ]]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">  <span class="comment"># Archeving PDF files first</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"The following PDFs have been archieved ..."</span></span><br><span class="line">  <span class="built_in">printf</span> <span class="string">'%s\n'</span> <span class="string">"<span class="variable">$&#123;ARR_LIST[@]&#125;</span>"</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">""</span></span><br><span class="line">  tar -czf XXX-$(date +%d%m%y).tar.gz <span class="string">"<span class="variable">$&#123;ARR_LIST[@]&#125;</span>"</span> --remove-files</span><br><span class="line">  <span class="comment"># tar -czf XXX-$(date +%d%m%y).tar.gz "$&#123;ARR_LIST[@]&#125;"</span></span><br><span class="line">  <span class="comment"># If there's an error when archiving PDF files</span></span><br><span class="line">  <span class="keyword">if</span> [[ <span class="string">"<span class="variable">$&#123;?&#125;</span>"</span> -ne 0 ]]</span><br><span class="line">  <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"Whoops, something wrong with the archieved file ..."</span> &gt;&amp;2</span><br><span class="line">    <span class="built_in">exit</span> 1</span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">  <span class="comment"># Send an email</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"Sending an email to <span class="variable">$&#123;RECEIVER&#125;</span> ..."</span></span><br><span class="line">  <span class="built_in">printf</span> <span class="string">'%s\n'</span> <span class="string">"<span class="variable">$&#123;EMAIL_CONTENT[@]&#125;</span>"</span> | mutt -s <span class="string">"XXX-Report"</span> <span class="string">"<span class="variable">$&#123;RECEIVER&#125;</span>"</span> -a XXX-$(date +%d%m</span><br><span class="line">%y).tar.gz</span><br><span class="line">  <span class="keyword">if</span> [[ <span class="string">"<span class="variable">$&#123;?&#125;</span>"</span> -eq 0 ]]</span><br><span class="line">  <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"Email successfully sent out ..."</span></span><br><span class="line">    <span class="built_in">exit</span> 0</span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">exit</span> 0</span><br></pre></td></tr></table></figure>
<h2 id="A-config-file-for-SSMTP-sendmail-‘-etc-ssmtp-ssmtp-conf’"><a href="#A-config-file-for-SSMTP-sendmail-‘-etc-ssmtp-ssmtp-conf’" class="headerlink" title="A config file for SSMTP sendmail ‘/etc/ssmtp/ssmtp.conf’"></a>A config file for SSMTP sendmail ‘/etc/ssmtp/ssmtp.conf’</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># /etc/ssmtp.conf -- a config file for sSMTP sendmail.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># See the ssmtp.conf(5) man page for a more verbose explanation of the</span></span><br><span class="line"><span class="comment"># available options.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># The person who gets all mail for userids &lt; 1000</span></span><br><span class="line"><span class="comment"># Make this empty to disable rewriting.</span></span><br><span class="line">root=xxxxx@gmail.com</span><br><span class="line"></span><br><span class="line"><span class="comment"># The place where the mail goes. The actual machine name is required</span></span><br><span class="line"><span class="comment"># no MX records are consulted. Commonly mailhosts are named mail.domain.com</span></span><br><span class="line"><span class="comment"># The example will fit if you are in domain.com and your mailhub is so named.</span></span><br><span class="line">mailhub=smtp.gmail.com:465</span><br><span class="line"></span><br><span class="line"><span class="comment"># Example for SMTP port number 2525</span></span><br><span class="line"><span class="comment"># mailhub=mail.your.domain:2525</span></span><br><span class="line"><span class="comment"># Example for SMTP port number 25 (Standard/RFC)</span></span><br><span class="line"><span class="comment"># mailhub=mail.your.domain</span></span><br><span class="line"><span class="comment"># Example for SSL encrypted connection</span></span><br><span class="line"><span class="comment"># mailhub=mail.your.domain:465</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Where will the mail seem to come from?</span></span><br><span class="line"><span class="comment">#RewriteDomain=</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The full hostname</span></span><br><span class="line"><span class="comment">#Hostname=</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Set this to never rewrite the "From:" line (unless not given) and to</span></span><br><span class="line"><span class="comment"># use that address in the "from line" of the envelope.</span></span><br><span class="line">FromLineOverride=YES</span><br><span class="line"></span><br><span class="line"><span class="comment"># Use SSL/TLS to send secure messages to server.</span></span><br><span class="line">UseTLS=YES</span><br><span class="line"><span class="comment">#IMPORTANT: The following line is mandatory for TLS authentication</span></span><br><span class="line">TLS_CA_File=/etc/pki/tls/certs/ca-bundle.crt</span><br><span class="line"></span><br><span class="line"><span class="comment"># Use SSL/TLS certificate to authenticate against smtp host.</span></span><br><span class="line"><span class="comment">#UseTLSCert=YES</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Use this RSA certificate.</span></span><br><span class="line"><span class="comment">#TLSCert=/etc/pki/tls/private/ssmtp.pem</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Get enhanced (*really* enhanced) debugging information in the logs</span></span><br><span class="line"><span class="comment"># If you want to have debugging of the config file parsing, move this option</span></span><br><span class="line"><span class="comment"># to the top of the config file and uncomment</span></span><br><span class="line"><span class="comment"># Debug=YES</span></span><br><span class="line"></span><br><span class="line">AuthUser=xxxxx@gmail.com</span><br><span class="line">AuthPass=xxxxx</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="A-config-file-for-mutt-‘-muttc’"><a href="#A-config-file-for-mutt-‘-muttc’" class="headerlink" title="A config file for mutt ‘~/.muttc’"></a>A config file for mutt ‘~/.muttc’</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">set</span> realname = <span class="string">"PD"</span></span><br><span class="line"><span class="built_in">set</span> from = <span class="string">"xxxxx@gmail.com"</span></span><br><span class="line"><span class="built_in">set</span> use_from = yes</span><br><span class="line"><span class="built_in">set</span> envelope_from = yes</span><br><span class="line"> </span><br><span class="line"><span class="built_in">set</span> smtp_url = <span class="string">"smtp://xxxxx@smtp.gmail.com:587/"</span></span><br><span class="line"><span class="built_in">set</span> smtp_pass = <span class="string">"xxxxx"</span></span><br><span class="line"><span class="built_in">set</span> imap_user = <span class="string">"xxxxx@gmail.com"</span></span><br><span class="line"><span class="built_in">set</span> imap_pass = <span class="string">"xxxxx"</span></span><br><span class="line"><span class="built_in">set</span> folder = <span class="string">"imaps://imap.gmail.com:993"</span></span><br><span class="line"><span class="built_in">set</span> spoolfile = <span class="string">"+INBOX"</span></span><br><span class="line"><span class="built_in">set</span> ssl_force_tls = yes</span><br><span class="line"><span class="built_in">set</span> smtp_authenticators = <span class="string">'gssapi:login'</span><span class="string">'</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">set editor = "vim"</span></span><br><span class="line"><span class="string">set charset = "utf-8"</span></span><br><span class="line"><span class="string">set record = '</span><span class="string">'</span></span><br><span class="line"><span class="string">bind index G imap-fetch-mail</span></span><br><span class="line"><span class="string"></span></span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/06/09/Python-Web-Scraping/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Patrick Dong">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Superpb9">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/06/09/Python-Web-Scraping/" itemprop="url">[Python] Web Scraping v1.0</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-06-09T16:20:00+12:00">
                2018-06-09
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Security-Automation/" itemprop="url" rel="index">
                    <span itemprop="name">Security Automation</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="README"><a href="#README" class="headerlink" title="README"></a>README</h2><p>Webscraping Tool</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Author: Patrick Dong</span><br><span class="line"></span><br><span class="line">Modules Developed: abuseipdb.py, ipvoid.py, myIPWhois.py, sans.py, xforceIBM.py</span><br></pre></td></tr></table></figure>
<p>OS Pre-requisite [Ubuntu]</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Python 2.7 and BeautifulSoup, requests, pandas</span><br><span class="line"></span><br><span class="line">Install Easy Install: $ sudo apt-get install python-setuptools python-dev build-essential.</span><br><span class="line"></span><br><span class="line">Install pip: $ sudo easy_install pip</span><br><span class="line"></span><br><span class="line">Install virtualenv: $ sudo pip install --upgrade virtualenv</span><br></pre></td></tr></table></figure>
<p>Usage Example</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line">[kali-linux]$ python webscraping.py &lt;IP|Domain&gt;</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;&gt;&gt; Welcome to WebScraping Tool &lt;&lt;&lt;&lt;&lt;</span><br><span class="line">Now checking <span class="number">183.63</span><span class="number">.206</span><span class="number">.116</span> ...</span><br><span class="line"></span><br><span class="line">[.] IP Whois Result</span><br><span class="line">% [whois.apnic.net]</span><br><span class="line">% Whois data copyright terms    http://www.apnic.net/db/dbcopyright.html</span><br><span class="line"></span><br><span class="line">% Information related to <span class="string">'183.0.0.0 - 183.63.255.255'</span></span><br><span class="line"></span><br><span class="line">% Abuse contact <span class="keyword">for</span> <span class="string">'183.0.0.0 - 183.63.255.255'</span> <span class="keyword">is</span> <span class="string">'[email protected]'</span></span><br><span class="line"></span><br><span class="line">inetnum:        <span class="number">183.0</span><span class="number">.0</span><span class="number">.0</span> - <span class="number">183.63</span><span class="number">.255</span><span class="number">.255</span></span><br><span class="line">netname:        CHINANET-GD</span><br><span class="line">descr:          CHINANET Guangdong province network</span><br><span class="line">descr:          Data Communication Division</span><br><span class="line">descr:          China Telecom</span><br><span class="line">country:        CN</span><br><span class="line">admin-c:        IC83-AP</span><br><span class="line">tech-c:         IC83-AP</span><br><span class="line">status:         ALLOCATED PORTABLE</span><br><span class="line">remarks:        service provider</span><br><span class="line">remarks:        --------------------------------------------------------</span><br><span class="line">remarks:        To report network abuse, please contact mnt-irt</span><br><span class="line">remarks:        For troubleshooting, please contact tech-c <span class="keyword">and</span> admin-c</span><br><span class="line">remarks:        Report invalid contact via www.apnic.net/invalidcontact</span><br><span class="line">remarks:        --------------------------------------------------------</span><br><span class="line">mnt-by:         APNIC-HM</span><br><span class="line">mnt-lower:      MAINT-CHINANET-GD</span><br><span class="line">last-modified:  <span class="number">2016</span><span class="number">-05</span><span class="number">-04</span>T00:<span class="number">19</span>:<span class="number">59</span>Z</span><br><span class="line">source:         APNIC</span><br><span class="line">mnt-irt:        IRT-CHINANET-CN</span><br><span class="line"></span><br><span class="line">irt:            IRT-CHINANET-CN</span><br><span class="line">address:        No<span class="number">.31</span> ,jingrong street,beijing</span><br><span class="line">address:        <span class="number">100032</span></span><br><span class="line">e-mail:         [email protected]</span><br><span class="line">abuse-mailbox:  [email protected]</span><br><span class="line">admin-c:        CH93-AP</span><br><span class="line">tech-c:         CH93-AP</span><br><span class="line">auth:           <span class="comment"># Filtered</span></span><br><span class="line">mnt-by:         MAINT-CHINANET</span><br><span class="line">last-modified:  <span class="number">2010</span><span class="number">-11</span><span class="number">-15</span>T00:<span class="number">31</span>:<span class="number">55</span>Z</span><br><span class="line">source:         APNIC</span><br><span class="line"></span><br><span class="line">person:         IPMASTER CHINANET-GD</span><br><span class="line">nic-hdl:        IC83-AP</span><br><span class="line">e-mail:         [email protected]</span><br><span class="line">address:        NO<span class="number">.18</span>,RO. ZHONGSHANER,YUEXIU DISTRIC,GUANGZHOU</span><br><span class="line">phone:          +<span class="number">86</span><span class="number">-20</span><span class="number">-87189274</span></span><br><span class="line">fax-no:         +<span class="number">86</span><span class="number">-20</span><span class="number">-87189274</span></span><br><span class="line">country:        CN</span><br><span class="line">mnt-by:         MAINT-CHINANET-GD</span><br><span class="line">remarks:        IPMASTER <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">for</span> spam complaint,please send spam complaint to [email protected]</span><br><span class="line">abuse-mailbox:  [email protected]</span><br><span class="line">last-modified:  <span class="number">2014</span><span class="number">-09</span><span class="number">-22</span>T04:<span class="number">41</span>:<span class="number">26</span>Z</span><br><span class="line">source:         APNIC</span><br><span class="line"></span><br><span class="line">% This query was served by the APNIC Whois Service version <span class="number">1.88</span><span class="number">.15</span><span class="number">-43</span> (WHOIS-US4)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[.] IPVoid Result:</span><br><span class="line">                    ITEM                                              DATA</span><br><span class="line"><span class="number">0</span>          Analysis Date                               <span class="number">2018</span><span class="number">-04</span><span class="number">-01</span> <span class="number">23</span>:<span class="number">23</span>:<span class="number">23</span></span><br><span class="line"><span class="number">1</span>           Elapsed Time                                         <span class="number">1</span> seconds</span><br><span class="line"><span class="number">2</span>       Blacklist Status                                  BLACKLISTED <span class="number">6</span>/<span class="number">96</span></span><br><span class="line"><span class="number">3</span>             IP Address                                    <span class="number">183.63</span><span class="number">.206</span><span class="number">.116</span></span><br><span class="line"><span class="number">4</span>            Reverse DNS                                           Unknown</span><br><span class="line"><span class="number">5</span>                    ASN                                          AS134772</span><br><span class="line"><span class="number">6</span>              ASN Owner  CHINANET Guangdong province Dongguan MAN network</span><br><span class="line"><span class="number">7</span>                    ISP                           China Telecom Guangdong</span><br><span class="line"><span class="number">8</span>              Continent                                              Asia</span><br><span class="line"><span class="number">9</span>           Country Code                                        (CN) China</span><br><span class="line"><span class="number">10</span>  Latitude / Longitude                                  <span class="number">23.1167</span> / <span class="number">113.25</span></span><br><span class="line"><span class="number">11</span>                  City                                         Guangzhou</span><br><span class="line"><span class="number">12</span>                Region                                        Guangdong  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[.] SANS Result</span><br><span class="line">Report Times: <span class="number">119</span></span><br><span class="line">Total Targets: <span class="number">45</span></span><br><span class="line">First Reported: <span class="number">2017</span><span class="number">-11</span><span class="number">-02</span></span><br><span class="line">Recent Report: <span class="number">2018</span><span class="number">-03</span><span class="number">-30</span> <span class="number">14</span>:<span class="number">14</span>:<span class="number">27</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[.] AbuseIPDB Result</span><br><span class="line">Reported <span class="number">8</span> times</span><br><span class="line">             Date            Reporter                            Category</span><br><span class="line"><span class="number">0</span>   <span class="number">1</span> minute ago        greensnow.co                       | Port Scan | </span><br><span class="line"><span class="number">1</span>    <span class="number">29</span> Mar <span class="number">2018</span>        greensnow.co                       | Port Scan | </span><br><span class="line"><span class="number">2</span>    <span class="number">18</span> Mar <span class="number">2018</span>        greensnow.co                       | Port Scan | </span><br><span class="line"><span class="number">3</span>    <span class="number">24</span> Feb <span class="number">2018</span>        greensnow.co                       | Port Scan | </span><br><span class="line"><span class="number">4</span>    <span class="number">05</span> Nov <span class="number">2017</span>            Anonymous                      | Port Scan | </span><br><span class="line"><span class="number">5</span>    <span class="number">18</span> Oct <span class="number">2017</span>    danielmellum.com                       | Port Scan | </span><br><span class="line"><span class="number">6</span>    <span class="number">21</span> Nov <span class="number">2016</span>            Anonymous   | DDoS Attack | Exploited Host | </span><br><span class="line"><span class="number">7</span>    <span class="number">22</span> Nov <span class="number">2015</span>        greensnow.co                         | Hacking |  </span><br><span class="line"></span><br><span class="line">[.] IBM X-Force Result</span><br><span class="line">Country: China</span><br><span class="line">Risk Score: <span class="number">1</span> (low)</span><br><span class="line">Categorization: Unsuspicious</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="Main-‘webscraping-py’"><a href="#Main-‘webscraping-py’" class="headerlink" title="Main ‘webscraping.py’"></a>Main ‘webscraping.py’</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> print_function</span><br><span class="line"><span class="keyword">import</span> sys,re, smtplib</span><br><span class="line"><span class="keyword">import</span> abuseipdb, ipvoid, sans, myIPwhois, xforceIBM</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">webscraping</span><span class="params">()</span>:</span></span><br><span class="line">    myIPvoidPrint1 = <span class="string">''</span></span><br><span class="line">    mySansPrint2 = <span class="string">''</span></span><br><span class="line">    myAbuseIPDBPrint3 = <span class="string">''</span></span><br><span class="line">    myXForcePrint4 = <span class="string">''</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> len(sys.argv) != <span class="number">2</span>:</span><br><span class="line">        print(<span class="string">'&gt;&gt;&gt;&gt;&gt; Welcome to my WebScraping Tool &lt;&lt;&lt;&lt;&lt;'</span>)</span><br><span class="line">        print(<span class="string">'     Usage: python webscraping.py [x.x.x.x | domain]'</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(<span class="string">'&gt;&gt;&gt;&gt;&gt; Welcome to WebScraping Tool &lt;&lt;&lt;&lt;&lt;'</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># regular expression for IP</span></span><br><span class="line">        re_ip = re.compile(<span class="string">'^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.)&#123;3&#125;(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$'</span>)</span><br><span class="line"></span><br><span class="line">        print(<span class="string">"Now checking "</span> + sys.argv[<span class="number">1</span>] + <span class="string">" ..."</span>)</span><br><span class="line">        print(<span class="string">""</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># If the IP format is valid:</span></span><br><span class="line">        <span class="keyword">if</span> re_ip.match(sys.argv[<span class="number">1</span>]):</span><br><span class="line">            <span class="comment"># Call myIPwhois.py</span></span><br><span class="line">            myIPwhois.IPWhoisChecker(<span class="string">"https://www.abuseipdb.com/whois/"</span> + sys.argv[<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">            <span class="comment"># Call ipvoid.py</span></span><br><span class="line">            myIPvoidPrint1 = ipvoid.ipvoidChecker(sys.argv[<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">            <span class="comment"># Call sans.py</span></span><br><span class="line">            mySansPrint2 = sans.sansChecker(sys.argv[<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">            <span class="comment"># Call abuseipdb.py</span></span><br><span class="line">            myAbuseIPDBPrint3 = abuseipdb.abuseipdbChecker(<span class="string">"https://www.abuseipdb.com/check/"</span> + sys.argv[<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">            <span class="comment"># Call xforceIBM.py</span></span><br><span class="line">            myXForcePrint4 = xforceIBM.myXForceChecker(<span class="string">"https://api.xforce.ibmcloud.com/ipr/"</span> + sys.argv[<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment"># If the input is a domain or other strings, let the website validate then ...</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment">#Call myIPwhois.py</span></span><br><span class="line">            myIPwhois.IPWhoisChecker(<span class="string">"https://www.abuseipdb.com/whois/"</span> + sys.argv[<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">            <span class="comment"># Call sans.py</span></span><br><span class="line">            <span class="comment"># sans.sansChecker("https://isc.sans.edu/api/ip/" + sys.argv[1])</span></span><br><span class="line">            sans.sansChecker(sys.argv[<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">            <span class="comment"># Call abuseipdb.py</span></span><br><span class="line">            abuseipdb.abuseipdbChecker(<span class="string">"https://www.abuseipdb.com/check/"</span> + sys.argv[<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">            <span class="comment"># Call xforceIBM.py</span></span><br><span class="line">            <span class="comment"># Check the domain</span></span><br><span class="line">            xforceIBM.myXForceChecker(<span class="string">"https://api.xforce.ibmcloud.com/url/"</span> + sys.argv[<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">print</span> (<span class="string">""</span>)</span><br><span class="line">    message = <span class="string">"[.] IPVoid Result: "</span> + myIPvoidPrint1 + <span class="string">'\n'</span> +\</span><br><span class="line">              <span class="string">"[.] SANS Result: "</span> + <span class="string">' | '</span>.join(mySansPrint2) + <span class="string">'\n'</span> +\</span><br><span class="line">              <span class="string">"[.] AbuseIPDB Result: "</span> + myAbuseIPDBPrint3 + <span class="string">'\n'</span> +\</span><br><span class="line">              <span class="string">"[.] XForce Result:  "</span> + <span class="string">' | '</span>.join(myXForcePrint4)</span><br><span class="line">    <span class="keyword">print</span> (message)</span><br><span class="line"></span><br><span class="line">    <span class="string">'''</span></span><br><span class="line"><span class="string">    sendemail(from_addr='xxxx@gmail.com',</span></span><br><span class="line"><span class="string">              to_addr_list=['xxx@xx.co.nz'],</span></span><br><span class="line"><span class="string">              cc_addr_list=['xxx@xx.co.nz'],</span></span><br><span class="line"><span class="string">              subject='Some Testing Shxxt',</span></span><br><span class="line"><span class="string">              message= message,</span></span><br><span class="line"><span class="string">              login='xxxx',</span></span><br><span class="line"><span class="string">              password='xxx!')</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sendemail</span><span class="params">(from_addr, to_addr_list, cc_addr_list,</span></span></span><br><span class="line"><span class="function"><span class="params">              subject, message,</span></span></span><br><span class="line"><span class="function"><span class="params">              login, password,</span></span></span><br><span class="line"><span class="function"><span class="params">              smtpserver=<span class="string">'smtp.gmail.com:587'</span>)</span>:</span></span><br><span class="line">    header = <span class="string">'From: %s\n'</span> % from_addr</span><br><span class="line">    header += <span class="string">'To: %s\n'</span> % <span class="string">','</span>.join(to_addr_list)</span><br><span class="line">    header += <span class="string">'Cc: %s\n'</span> % <span class="string">','</span>.join(cc_addr_list)</span><br><span class="line">    header += <span class="string">'Subject: %s\n\n'</span> % subject</span><br><span class="line">    message = header + message</span><br><span class="line"></span><br><span class="line">    server = smtplib.SMTP(smtpserver)</span><br><span class="line">    server.starttls()</span><br><span class="line">    server.login(login, password)</span><br><span class="line">    problems = server.sendmail(from_addr, to_addr_list, message)</span><br><span class="line">    server.quit()</span><br><span class="line">    <span class="keyword">return</span> problems</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    webscraping()</span><br><span class="line">    </span><br></pre></td></tr></table></figure>
<h2 id="Module-‘abuseipdb-py’"><a href="#Module-‘abuseipdb-py’" class="headerlink" title="Module ‘abuseipdb.py’"></a>Module ‘abuseipdb.py’</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">from</span> pandas <span class="keyword">import</span> Series, DataFrame</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">abuseipdbChecker</span><span class="params">(url)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># e.g. url = "https://www.abuseipdb.com/check/220.191.211.7"</span></span><br><span class="line">    <span class="comment">#      url = "https://www.abuseipdb.com/check/baidu.com"</span></span><br><span class="line">    <span class="comment"># HTTP Query</span></span><br><span class="line">    myResult = requests.get(url)</span><br><span class="line">    printResult = <span class="string">''</span></span><br><span class="line">    <span class="keyword">print</span> <span class="string">'[.] AbuseIPDB Result:'</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># if the input value is invalid, such as 'baidu.comx', 'x.x.x.x.x', etc.</span></span><br><span class="line">    <span class="comment"># Invalid Input: '422 Unprocessable Entity'</span></span><br><span class="line">    <span class="keyword">if</span> myResult.status_code == <span class="number">422</span>:</span><br><span class="line">        <span class="keyword">print</span> <span class="string">'Error: 422 Unprocessable Entity (e.g. http://www.com)'</span></span><br><span class="line">        <span class="keyword">print</span> <span class="string">'We expected a valid IP address or Domain name.'</span></span><br><span class="line">        exit()</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="comment"># If domain resolved to an IP</span></span><br><span class="line">        <span class="keyword">if</span> url != myResult.url:</span><br><span class="line">            <span class="keyword">print</span> <span class="string">'Your request has been resolved to '</span> + myResult.url</span><br><span class="line">        c = myResult.content</span><br><span class="line">        soup = BeautifulSoup(c, <span class="string">"lxml"</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Part 1: Locate the reporting times that we want</span></span><br><span class="line">        <span class="comment"># reportTimes = soup.find_all(class_="well")</span></span><br><span class="line">        mySoup = soup.find(<span class="string">'div'</span>, &#123;<span class="string">'class'</span>: <span class="string">'col-md-6'</span>&#125;)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Http Response code is still 200 but we got a message:</span></span><br><span class="line">        <span class="comment">#      'We can't resolve the domain www.comz! Please try your query again.'</span></span><br><span class="line">        <span class="keyword">if</span> mySoup <span class="keyword">is</span> <span class="keyword">None</span>:</span><br><span class="line">            <span class="keyword">print</span> (<span class="string">'We expected a valid IP address or Domain name.'</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># Get the first 'p' tag in &lt;div class="well"&gt;</span></span><br><span class="line">            <span class="comment"># You can only put 'find_all' after 'find'</span></span><br><span class="line">            pTag = mySoup.find(<span class="string">'p'</span>)</span><br><span class="line">            reportTimes = pTag.find(<span class="string">'b'</span>)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># Print reporting times</span></span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="keyword">if</span> reportTimes.string == <span class="string">"Important Note:"</span>:</span><br><span class="line">                    <span class="keyword">print</span> <span class="string">'Note: You probably input a private IP. Please check again ...'</span></span><br><span class="line">                    exit()</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="keyword">print</span> <span class="string">'Reported '</span> + reportTimes.string + <span class="string">' times'</span></span><br><span class="line">                    printResult = <span class="string">'Reported '</span> + reportTimes.string + <span class="string">' times'</span></span><br><span class="line">            <span class="comment"># if result equals 'None'</span></span><br><span class="line">            <span class="keyword">except</span> Exception:</span><br><span class="line">                reportTimes = <span class="number">0</span></span><br><span class="line">                <span class="keyword">print</span> <span class="string">'Reported '</span> + str(reportTimes) + <span class="string">' times'</span></span><br><span class="line">                printResult = <span class="string">'Reported '</span> + str(reportTimes) + <span class="string">' times'</span></span><br><span class="line">                <span class="keyword">print</span> <span class="string">''</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># Part 2: Locate the table that we want</span></span><br><span class="line">            tables = soup.find_all(class_=<span class="string">"table table-striped responsive-table"</span>)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> tables != []:</span><br><span class="line">                <span class="comment"># Use BeautifulSoup to find the table entries with a For Loop</span></span><br><span class="line">                rawData = []</span><br><span class="line"></span><br><span class="line">                <span class="comment"># Looking for every row in a table</span></span><br><span class="line">                <span class="comment"># table[0] is just the format for BeautifulSoup</span></span><br><span class="line">                rows = tables[<span class="number">0</span>].findAll(<span class="string">'tr'</span>)</span><br><span class="line"></span><br><span class="line">                <span class="keyword">for</span> tr <span class="keyword">in</span> rows:</span><br><span class="line">                    cols = tr.findAll(<span class="string">'td'</span>)</span><br><span class="line">                    <span class="keyword">for</span> td <span class="keyword">in</span> cols:</span><br><span class="line">                        <span class="comment"># data-title = "Reporter"</span></span><br><span class="line">                        text = cols[<span class="number">0</span>].text</span><br><span class="line">                        rawData.append(text)</span><br><span class="line">                        <span class="comment"># data-title = "Date"</span></span><br><span class="line">                        text = cols[<span class="number">1</span>].text</span><br><span class="line">                        rawData.append(text)</span><br><span class="line">                        <span class="string">'''</span></span><br><span class="line"><span class="string">                        # data-title = "Comment" (Ingnored)</span></span><br><span class="line"><span class="string">                        text = cols[2].text</span></span><br><span class="line"><span class="string">                        rawData.append(text)</span></span><br><span class="line"><span class="string">                        '''</span></span><br><span class="line">                        <span class="comment"># data-title = "Categories"</span></span><br><span class="line">                        text = cols[<span class="number">3</span>].text + <span class="string">'\n'</span></span><br><span class="line">                        rawData.append(text)</span><br><span class="line"></span><br><span class="line">                <span class="comment"># Modify rawData</span></span><br><span class="line">                reporter = []</span><br><span class="line">                date = []</span><br><span class="line">                category = []</span><br><span class="line"></span><br><span class="line">                itemNum = len(rawData)</span><br><span class="line">                index = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">                <span class="comment"># For 'reporter'</span></span><br><span class="line">                index1 = <span class="number">0</span></span><br><span class="line">                <span class="comment"># For 'date'</span></span><br><span class="line">                index2 = <span class="number">1</span></span><br><span class="line">                <span class="comment"># For 'category'</span></span><br><span class="line">                index3 = <span class="number">2</span></span><br><span class="line"></span><br><span class="line">                <span class="keyword">for</span> index <span class="keyword">in</span> range(<span class="number">0</span>, itemNum - <span class="number">1</span>):</span><br><span class="line">                    <span class="comment"># Make sure this loop will not exceed the limit</span></span><br><span class="line">                    <span class="keyword">if</span> index1 &lt;= itemNum - <span class="number">3</span>:</span><br><span class="line">                        <span class="comment"># Reporter</span></span><br><span class="line">                        reporter.append(rawData[index1].replace(<span class="string">'\n'</span>, <span class="string">''</span>))</span><br><span class="line">                        index1 += <span class="number">3</span></span><br><span class="line"></span><br><span class="line">                        <span class="comment"># Date</span></span><br><span class="line">                        date.append(rawData[index2].replace(<span class="string">'\n'</span>, <span class="string">''</span>))</span><br><span class="line">                        index2 += <span class="number">3</span></span><br><span class="line"></span><br><span class="line">                        <span class="comment"># Category</span></span><br><span class="line">                        category.append(rawData[index3].replace(<span class="string">'\n\n'</span>, <span class="string">' | '</span>).replace(<span class="string">'\n'</span>, <span class="string">' | '</span>))</span><br><span class="line">                        index3 += <span class="number">3</span></span><br><span class="line"></span><br><span class="line">                        <span class="comment"># Global Index</span></span><br><span class="line">                        index += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">                <span class="comment"># Panda Series</span></span><br><span class="line">                reporter = Series(reporter)</span><br><span class="line">                date = Series(date)</span><br><span class="line">                category = Series(category)</span><br><span class="line"></span><br><span class="line">                <span class="comment"># Concatenate into a DataFrame</span></span><br><span class="line">                legislative_df = pd.concat([date, reporter, category], axis=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">                <span class="comment"># Set up the columns</span></span><br><span class="line">                legislative_df.columns = [<span class="string">'Date'</span>, <span class="string">'Reporter'</span>, <span class="string">'Category'</span>]</span><br><span class="line"></span><br><span class="line">                <span class="comment"># Delete the dups and reset index (and drop the old index)</span></span><br><span class="line">                legislative_df = legislative_df.drop_duplicates().reset_index(drop=<span class="keyword">True</span>)</span><br><span class="line"></span><br><span class="line">                <span class="comment"># Show the finished DataFrame</span></span><br><span class="line">                <span class="keyword">print</span> legislative_df,</span><br><span class="line">                <span class="keyword">print</span> <span class="string">''</span></span><br><span class="line">    <span class="keyword">return</span> printResult</span><br></pre></td></tr></table></figure>
<h2 id="Module-‘ipvoid-py’"><a href="#Module-‘ipvoid-py’" class="headerlink" title="Module ‘ipvoid.py’"></a>Module ‘ipvoid.py’</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">from</span> pandas <span class="keyword">import</span> Series, DataFrame</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ipvoidChecker</span><span class="params">(ip)</span>:</span></span><br><span class="line"></span><br><span class="line">    url = <span class="string">"http://www.ipvoid.com/ip-blacklist-check/"</span></span><br><span class="line">    headers = &#123;<span class="string">"Content-Type"</span>: <span class="string">"application/x-www-form-urlencoded"</span>,</span><br><span class="line">               <span class="string">"Referer"</span>:<span class="string">"http://www.ipvoid.com/ip-blacklist-check/"</span>,&#125;</span><br><span class="line">    payload = &#123;<span class="string">'ip'</span>:ip&#125;</span><br><span class="line">    <span class="comment"># Note: Using 'data' instead of 'params'</span></span><br><span class="line">    r = requests.post(url, headers=headers, data=payload)</span><br><span class="line">    returnData = r.content</span><br><span class="line">    soup = BeautifulSoup(returnData, <span class="string">"lxml"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">#mySoup = soup.find('div', &#123;'class': 'responsive'&#125;)</span></span><br><span class="line">    tables = soup.find_all(class_=<span class="string">"table table-striped table-bordered"</span>)</span><br><span class="line"></span><br><span class="line">    column1 = []</span><br><span class="line">    column2 = []</span><br><span class="line">    printResult = <span class="string">''</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> tables !=[]:</span><br><span class="line">        rows = tables[<span class="number">0</span>].findAll(<span class="string">'tr'</span>)</span><br><span class="line">        i = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> tr <span class="keyword">in</span> rows:</span><br><span class="line">            i+=<span class="number">1</span></span><br><span class="line">            cols = tr.findAll(<span class="string">'td'</span>)</span><br><span class="line">            column1.append(cols[<span class="number">0</span>].text)</span><br><span class="line">            column2.append(cols[<span class="number">1</span>].text.</span><br><span class="line">                           replace(<span class="string">" Find Sites | IP Whois"</span>,<span class="string">""</span>).</span><br><span class="line">                           replace(<span class="string">" Google Map"</span>,<span class="string">""</span>))</span><br><span class="line">            <span class="comment">#Get the Blacklist Status</span></span><br><span class="line">            <span class="keyword">if</span> i == <span class="number">3</span>:</span><br><span class="line">                printResult = cols[<span class="number">1</span>].text</span><br><span class="line">    <span class="comment"># Panda Series</span></span><br><span class="line">    column1 = Series(column1)</span><br><span class="line">    column2 = Series(column2)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Concatenate into a DataFrame</span></span><br><span class="line">    legislative_df = pd.concat([column1, column2], axis=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Set up the columns</span></span><br><span class="line">    legislative_df.columns = [<span class="string">'ITEM'</span>, <span class="string">'DATA'</span>]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Show the finished DataFrame</span></span><br><span class="line">    <span class="keyword">print</span> <span class="string">'[.] IPVoid Result: '</span></span><br><span class="line">    <span class="keyword">print</span> legislative_df,<span class="string">'\n\n'</span></span><br><span class="line">    <span class="keyword">return</span> printResult</span><br></pre></td></tr></table></figure>
<h2 id="Module-‘myIPwhois-py’"><a href="#Module-‘myIPwhois-py’" class="headerlink" title="Module ‘myIPwhois.py’"></a>Module ‘myIPwhois.py’</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">IPWhoisChecker</span><span class="params">(url)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># e.g. url = "https://www.abuseipdb.com/whois/114.200.4.207"</span></span><br><span class="line">    myResult = requests.get(url)</span><br><span class="line">    <span class="keyword">print</span> <span class="string">'[.] IP Whois Result:'</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># if the input value is invalid, such as 'baidu.comx', 'x.x.x.x.x', etc.</span></span><br><span class="line">    <span class="comment"># Invalid Input: '422 Unprocessable Entity'</span></span><br><span class="line">    <span class="keyword">if</span> myResult.status_code == <span class="number">422</span>:</span><br><span class="line">        <span class="keyword">print</span> <span class="string">'Error: 422 Unprocessable Entity (e.g. http://www.com)'</span></span><br><span class="line">        <span class="keyword">print</span> <span class="string">'We expected a valid IP address or Domain name.'</span></span><br><span class="line">        <span class="keyword">print</span> <span class="string">'Program will exit ...'</span></span><br><span class="line">        exit()</span><br><span class="line">    <span class="keyword">elif</span> myResult.status_code == <span class="number">404</span>:</span><br><span class="line">        <span class="keyword">print</span> <span class="string">'Response Error: 404 We expected a valid IP address or Domain name.'</span></span><br><span class="line">        <span class="keyword">print</span> <span class="string">'Program will exit ...'</span></span><br><span class="line">        exit()</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="comment"># If domain resolved to an IP</span></span><br><span class="line">        <span class="keyword">if</span> url != myResult.url:</span><br><span class="line">            <span class="keyword">print</span> <span class="string">'Your request has been resolved to '</span> + myResult.url</span><br><span class="line">        c = myResult.content</span><br><span class="line">        soup = BeautifulSoup(c, <span class="string">"lxml"</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Parse https://www.abuseipdb.com/whois/x.x.x.x</span></span><br><span class="line">        mySoup = soup.find(<span class="string">'section'</span>, &#123;<span class="string">'id'</span>: <span class="string">'report-wrapper'</span>&#125;)</span><br><span class="line">        preTag = mySoup.find(<span class="string">'pre'</span>)</span><br><span class="line">        ipWhoisInfo = preTag.text</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> ipWhoisInfo:</span><br><span class="line">            <span class="keyword">print</span> <span class="string">"None"</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">print</span> ipWhoisInfo</span><br></pre></td></tr></table></figure>
<h2 id="Module-‘sans-py’"><a href="#Module-‘sans-py’" class="headerlink" title="Module ‘sans.py’"></a>Module ‘sans.py’</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"><span class="keyword">import</span> requests, dns.resolver</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sansChecker</span><span class="params">(IPOrDomain)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># HTTP Query</span></span><br><span class="line">    url = <span class="string">"https://isc.sans.edu/api/ip/"</span> + IPOrDomain</span><br><span class="line"></span><br><span class="line">    <span class="comment"># If the input value is a domain</span></span><br><span class="line">    re_ip = re.compile(<span class="string">'^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.)&#123;3&#125;(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$'</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> re_ip.match(IPOrDomain):</span><br><span class="line">        <span class="comment">#Try to resolve the domain first</span></span><br><span class="line">        aRecord = []</span><br><span class="line">        my_resolver = dns.resolver.Resolver()</span><br><span class="line">        my_resolver.nameservers = [<span class="string">'8.8.8.8'</span>]</span><br><span class="line">        <span class="keyword">for</span> rdata <span class="keyword">in</span> my_resolver.query(IPOrDomain, <span class="string">"A"</span>):</span><br><span class="line">            aRecord.append(rdata.address)</span><br><span class="line">        <span class="comment"># Only use the 1st A record</span></span><br><span class="line">        url = <span class="string">"https://isc.sans.edu/api/ip/"</span> + aRecord[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Our actual checking begins from here</span></span><br><span class="line">    printResult = []</span><br><span class="line">    myResult = requests.get(url)</span><br><span class="line">    c = myResult.content</span><br><span class="line">    soup = BeautifulSoup(c, <span class="string">"lxml"</span>)</span><br><span class="line">    mySoup = soup.find(<span class="string">'error'</span>)</span><br><span class="line">    <span class="keyword">print</span> <span class="string">'[.] SANS Result:'</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># If the input IP has a correct format</span></span><br><span class="line">    <span class="keyword">if</span> mySoup <span class="keyword">is</span> <span class="keyword">None</span>:</span><br><span class="line">        c = myResult.content</span><br><span class="line">        soup = BeautifulSoup(c, <span class="string">"lxml"</span>)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            reportedTimes = soup.find(<span class="string">'count'</span>)</span><br><span class="line">            <span class="keyword">if</span> reportedTimes.text != <span class="string">''</span>:</span><br><span class="line">                <span class="keyword">print</span> <span class="string">'Report Times '</span> + reportedTimes.text</span><br><span class="line">                printResult.append(<span class="string">'Report Times '</span> + reportedTimes.text)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">print</span> <span class="string">'Report Times 0'</span></span><br><span class="line">                printResult.append(<span class="string">"Report Times 0"</span>)</span><br><span class="line">        <span class="keyword">except</span> Exception:</span><br><span class="line">            <span class="keyword">print</span> <span class="string">'Report Times 0'</span></span><br><span class="line">            printResult.append(<span class="string">"Report Times 0"</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            targets = soup.find(<span class="string">'attacks'</span>)</span><br><span class="line">            <span class="keyword">if</span> targets.text != <span class="string">''</span>:</span><br><span class="line">                <span class="keyword">print</span> <span class="string">'Total Targets '</span> + targets.text</span><br><span class="line">                printResult.append(<span class="string">'Total Targets '</span> + targets.text)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">print</span> <span class="string">'Total Targets 0'</span></span><br><span class="line">                printResult.append(<span class="string">'Total Targets 0'</span>)</span><br><span class="line">        <span class="keyword">except</span> Exception:</span><br><span class="line">            <span class="keyword">print</span> <span class="string">'Total Targets 0'</span></span><br><span class="line">            printResult.append(<span class="string">'Total Targets 0'</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            firstReported = soup.find(<span class="string">'mindate'</span>)</span><br><span class="line">            <span class="keyword">if</span> firstReported.text != <span class="string">''</span>:</span><br><span class="line">                <span class="keyword">print</span> <span class="string">'First Reported '</span> + firstReported.text</span><br><span class="line">                printResult.append(<span class="string">'First Reported '</span> + firstReported.text)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">print</span> <span class="string">'First Reported 0'</span></span><br><span class="line">                printResult.append(<span class="string">'First Reported 0'</span>)</span><br><span class="line">        <span class="keyword">except</span> Exception:</span><br><span class="line">            <span class="keyword">print</span> <span class="string">'First Reported 0'</span></span><br><span class="line">            printResult.append(<span class="string">'First Reported 0'</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            latestReported = soup.find(<span class="string">'updated'</span>)</span><br><span class="line">            <span class="keyword">if</span> latestReported.text != <span class="string">''</span>:</span><br><span class="line">                <span class="keyword">print</span> <span class="string">'Recent Report '</span> + latestReported.text</span><br><span class="line">                printResult.append(<span class="string">'Recent Report '</span> + latestReported.text)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">print</span> <span class="string">'Recent Report 0'</span></span><br><span class="line">                printResult.append(<span class="string">'Recent Report 0'</span>)</span><br><span class="line">        <span class="keyword">except</span> Exception:</span><br><span class="line">            <span class="keyword">print</span> <span class="string">'Recent Report 0'</span></span><br><span class="line">            printResult.append(<span class="string">'Recent Report 0'</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">print</span> <span class="string">"\n"</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Elif the input IP is wrong</span></span><br><span class="line">    <span class="keyword">elif</span> mySoup.text == <span class="string">'bad IP address'</span>:</span><br><span class="line">        <span class="keyword">print</span> <span class="string">'We expected a valid IP address.'</span></span><br><span class="line">        exit()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> printResult</span><br></pre></td></tr></table></figure>
<h2 id="Module-‘xforceIBM-py’"><a href="#Module-‘xforceIBM-py’" class="headerlink" title="Module - ‘xforceIBM.py’"></a>Module - ‘xforceIBM.py’</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> requests.auth <span class="keyword">import</span> HTTPBasicAuth</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">myXForceChecker</span><span class="params">(url)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># User: 473284ee-2c45-4719-a201-5e6c81c0253a</span></span><br><span class="line">    <span class="comment"># Password: 8acd0774-7238-4ad7-bc09-a2003ca6e80f</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Auth first</span></span><br><span class="line">    <span class="keyword">print</span> <span class="string">''</span></span><br><span class="line">    <span class="keyword">print</span> <span class="string">'[.] IBM X-Force Result:'</span></span><br><span class="line"></span><br><span class="line">    printResult = []</span><br><span class="line">    <span class="comment"># e.g. url = "https://exchange.xforce.ibmcloud.com/ip//114.200.4.207"</span></span><br><span class="line">    <span class="comment"># IP Report</span></span><br><span class="line">    myResult1 = requests.get(url, auth=HTTPBasicAuth(<span class="string">'473284ee-2c45-4719-a201-5e6c81c0253a'</span>,</span><br><span class="line">                                                     <span class="string">'8acd0774-7238-4ad7-bc09-a2003ca6e80f'</span>))</span><br><span class="line">    c1 = myResult1.content</span><br><span class="line">    myJson1 = json.loads(c1)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;  IP/Domain Report Check &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span></span><br><span class="line">    <span class="comment"># ...........</span></span><br><span class="line">    <span class="string">'''</span></span><br><span class="line"><span class="string">    # indent = 2</span></span><br><span class="line"><span class="string">    # json.dumps() change data to python dictionary</span></span><br><span class="line"><span class="string">    # sortedData = json.dumps(myJson1, sort_keys=True, indent=2)</span></span><br><span class="line"><span class="string">    # print sortedData</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#----------These three keys are for IP checker----------</span></span><br><span class="line">    <span class="comment"># [Print] Geo information</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">"geo"</span> <span class="keyword">in</span> myJson1:</span><br><span class="line">        <span class="keyword">for</span> key, value <span class="keyword">in</span> myJson1[<span class="string">"geo"</span>].items():</span><br><span class="line">            geo = <span class="string">"Country"</span> + <span class="string">": "</span> + str(value)</span><br><span class="line">            <span class="keyword">print</span> geo</span><br><span class="line">            printResult.append(geo)</span><br><span class="line">            <span class="comment"># Only print country</span></span><br><span class="line">            <span class="comment"># (Ingore country code)</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="comment"># [Print] Overrall Risk Score</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">"score"</span> <span class="keyword">in</span> myJson1:</span><br><span class="line">        <span class="keyword">if</span> myJson1[<span class="string">"score"</span>] == <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">print</span> <span class="string">"Risk Score: "</span> + str(myJson1[<span class="string">"score"</span>]) + <span class="string">" (low)"</span></span><br><span class="line">            printResult.append(<span class="string">"Risk Score: "</span> + str(myJson1[<span class="string">"score"</span>]) + <span class="string">" (low)"</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">print</span> <span class="string">"Risk Score: "</span> + str(myJson1[<span class="string">"score"</span>])</span><br><span class="line">            printResult.append(<span class="string">"Risk Score: "</span> + str(myJson1[<span class="string">"score"</span>]))</span><br><span class="line">    <span class="comment"># [Print] Categorization:</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">"cats"</span> <span class="keyword">in</span> myJson1:</span><br><span class="line">        <span class="keyword">if</span> myJson1[<span class="string">"cats"</span>]:</span><br><span class="line">            <span class="keyword">for</span> key, value <span class="keyword">in</span> myJson1[<span class="string">"cats"</span>].items():</span><br><span class="line">                cat = str(key) + <span class="string">" ("</span> + str(value) + <span class="string">"%)"</span></span><br><span class="line">                <span class="keyword">print</span> <span class="string">"Categorization: "</span> + cat</span><br><span class="line">                printResult.append(<span class="string">"Categorization: "</span> + cat)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">print</span> <span class="string">"Categorization: Unsuspicious"</span></span><br><span class="line">            printResult.append(<span class="string">"Categorization: Unsuspicious"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># ----------These keys are for Domain checker----------</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">"result"</span> <span class="keyword">in</span> myJson1:</span><br><span class="line">        myJsonResult = myJson1[<span class="string">"result"</span>]</span><br><span class="line">        <span class="keyword">if</span> myJsonResult[<span class="string">"score"</span>] == <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">print</span> <span class="string">"Risk Score: "</span> + str(myJsonResult[<span class="string">"score"</span>]) + <span class="string">" (low)"</span></span><br><span class="line">            printResult.append(<span class="string">"Risk Score: "</span> + str(myJsonResult[<span class="string">"score"</span>]) + <span class="string">" (low)"</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">print</span> <span class="string">"Risk Score: "</span> + str(myJsonResult[<span class="string">"score"</span>])</span><br><span class="line">            printResult.append(<span class="string">"Risk Score: "</span> + str(myJsonResult[<span class="string">"score"</span>]))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> myJsonResult[<span class="string">"categoryDescriptions"</span>]:</span><br><span class="line">            <span class="keyword">for</span> key, value <span class="keyword">in</span> myJsonResult[<span class="string">"categoryDescriptions"</span>].items():</span><br><span class="line">                cat = <span class="string">"&lt;"</span> + str(key).replace(<span class="string">" / "</span>, <span class="string">"|"</span>) + <span class="string">"&gt;: "</span> + str(value)</span><br><span class="line">                <span class="keyword">print</span> cat</span><br><span class="line">                printResult.append(cat)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> printResult</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/05/16/DNS/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Patrick Dong">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Superpb9">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/05/16/DNS/" itemprop="url">DNS</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-05-16T22:53:36+12:00">
                2018-05-16
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Security-Incident-Response/" itemprop="url" rel="index">
                    <span itemprop="name">Security Incident Response</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="CNAME"><a href="#CNAME" class="headerlink" title="CNAME"></a>CNAME</h3><ul>
<li><p>CNAME records must always be pointed to another domain name, never to an IP address. MX and NS records must never point to a CNAME alias</p>
</li>
<li><p>For example, when an A record lookup for <a href="http://www.baidu.com" target="_blank" rel="noopener">www.baidu.com</a> is carried out, the resolver will see a CNAME record and restart the checking at <a href="http://www.a.shifen.com" target="_blank" rel="noopener">www.a.shifen.com</a> and then <a href="http://www.wshifen.com" target="_blank" rel="noopener">www.wshifen.com</a>. Finially, it will then return 192.0.2.23.</p>
</li>
<li><p>We can see that “<a href="http://www.baidu.com&quot;" target="_blank" rel="noopener">www.baidu.com&quot;</a> has a CNAME of “<a href="http://www.a.shifen.com&quot;" target="_blank" rel="noopener">www.a.shifen.com&quot;</a></p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ dig @114.114.114.114 www.baidu.com +noall +answer</span><br><span class="line"></span><br><span class="line">; &lt;&lt;&gt;&gt; DiG 9.10.3-P4-Raspbian &lt;&lt;&gt;&gt; @114.114.114.114 www.baidu.com +noall +answer</span><br><span class="line">; (1 server found)</span><br><span class="line">;; global options: +cmd</span><br><span class="line">www.baidu.com.        1000    IN    CNAME    www.a.shifen.com.</span><br><span class="line">www.a.shifen.com.    238    IN    CNAME    www.wshifen.com.</span><br><span class="line">www.wshifen.com.    239    IN    A    104.193.88.123</span><br><span class="line">www.wshifen.com.    239    IN    A    104.193.88.77</span><br></pre></td></tr></table></figure>
</li>
<li><p>However, a root domain (e.g. baidu.com) normally can not be associated with a <strong>CNAME</strong></p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ dig @114.114.114.114 baidu.com +noall +answer</span><br><span class="line"></span><br><span class="line">; &lt;&lt;&gt;&gt; DiG 9.10.3-P4-Raspbian &lt;&lt;&gt;&gt; @114.114.114.114 baidu.com +noall +answer</span><br><span class="line">; (1 server found)</span><br><span class="line">;; global options: +cmd</span><br><span class="line">baidu.com.        564    IN    A    123.125.115.110</span><br><span class="line">baidu.com.        564    IN    A    220.181.57.216</span><br></pre></td></tr></table></figure>
</li>
<li><p>Domain Takeover Case</p>
<blockquote><p>挖洞经验 | 看我如何在前期踩点过程中发现价值$4500的漏洞</p>
<footer><strong>Freebuf</strong><cite><a href="http://www.freebuf.com/articles/network/171219.html" target="_blank" rel="noopener">Uber Sub Domain Takeover</a></cite></footer></blockquote>
</li>
</ul>
<h3 id="DNS-Request-Types-Cheat-Sheet"><a href="#DNS-Request-Types-Cheat-Sheet" class="headerlink" title="DNS Request Types Cheat Sheet"></a>DNS Request Types Cheat Sheet</h3><table>
<thead>
<tr>
<th style="text-align:left">DNS Lookup Type</th>
<th style="text-align:left">Function</th>
<th style="text-align:left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">A</td>
<td style="text-align:left">IPv4 Address Record</td>
<td style="text-align:left">The <em>A</em> stands for IPv4 Address</td>
</tr>
<tr>
<td style="text-align:left">AAAA</td>
<td style="text-align:left">IPv6 Address Record</td>
<td style="text-align:left">The <em>A</em> stands for IPv6 Address</td>
</tr>
<tr>
<td style="text-align:left">NS</td>
<td style="text-align:left">Name Server Record</td>
<td style="text-align:left">An authoritative name server that is used to delegate a subdomain to a set of name servers</td>
</tr>
<tr>
<td style="text-align:left">CNAME</td>
<td style="text-align:left">Canonical Name Record</td>
<td style="text-align:left">CNAME can be used to alias one name to another</td>
</tr>
<tr>
<td style="text-align:left">MX</td>
<td style="text-align:left">Mail Exchange Record</td>
<td style="text-align:left">MX Records tell email delivery agents where they should deliver your email. You can have many MX records for a domain for redundancy</td>
</tr>
<tr>
<td style="text-align:left">PTR</td>
<td style="text-align:left">Point Records (Reserver DNS)</td>
<td style="text-align:left">Map a network IP address to a host name.</td>
</tr>
<tr>
<td style="text-align:left">SOA</td>
<td style="text-align:left">Start of Authority Record</td>
<td style="text-align:left">Specify authoritative information about a DNS zone, including the primary name server, administrator, domain serial number, and several timers relating to refreshing the zone</td>
</tr>
<tr>
<td style="text-align:left">SRV</td>
<td style="text-align:left">Server Locator</td>
<td style="text-align:left">Used to help with server discovery (e.g. defining where a SIP service may be found in Internet Telephony)</td>
</tr>
<tr>
<td style="text-align:left">TXT</td>
<td style="text-align:left">Text Record</td>
<td style="text-align:left">Carries extra data, sometimes human-readable, most of the time machine-readable such as opportunistic encryption, DomainKeys, etc.</td>
</tr>
<tr>
<td style="text-align:left">ANY</td>
<td style="text-align:left">All cached Records</td>
<td style="text-align:left">ANY retrives all the available types for a given name</td>
</tr>
</tbody>
</table>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/05/08/RaspberryPi3-NSM-Design/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Patrick Dong">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Superpb9">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/05/08/RaspberryPi3-NSM-Design/" itemprop="url">[HomeLab] RaspberryPi3 NSM Design</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-05-08T14:47:36+12:00">
                2018-05-08
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Security-Incident-Response/" itemprop="url" rel="index">
                    <span itemprop="name">Security Incident Response</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="System-Requirement"><a href="#System-Requirement" class="headerlink" title="System Requirement"></a>System Requirement</h3><ul>
<li>TP-LINK TL-SG105E 5-Port Smart Switch</li>
<li>RaspberryPi 3</li>
</ul>
<p>Switch <strong>Port 3</strong> used as Mirroring Port, connected to RaspberryPi’s <strong>eth0</strong>.<br>There’s no need to assign any IP on <strong>eth0</strong>.<br>The other interface <strong>wlan0</strong> will therefore be used as Management Port.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sudo nano /etc/network/interfaces</span><br><span class="line">iface eth0 inet static</span><br><span class="line">static ip_address=0.0.0.0</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo ifconfig eth0 down &amp;&amp; sudo ifconfig eth0 up</span><br></pre></td></tr></table></figure>
<h3 id="BRO-IDS-on-RaspberryPi-3"><a href="#BRO-IDS-on-RaspberryPi-3" class="headerlink" title="BRO IDS on RaspberryPi 3"></a>BRO IDS on RaspberryPi 3</h3><h4 id="BRO-IDS-Basic-Installation-and-Configuration"><a href="#BRO-IDS-Basic-Installation-and-Configuration" class="headerlink" title="BRO IDS Basic Installation and Configuration"></a>BRO IDS Basic Installation and Configuration</h4><h5 id="Install-OpenSSL-v1-0-headers"><a href="#Install-OpenSSL-v1-0-headers" class="headerlink" title="Install OpenSSL v1.0 headers:"></a>Install OpenSSL v1.0 headers:</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt install libssl1.0-dev</span><br></pre></td></tr></table></figure>
<h5 id="Verify-the-headers-have-been-properly-replaced-We-should-see-libssl1-0-dev-instaed-of-libssl-dev"><a href="#Verify-the-headers-have-been-properly-replaced-We-should-see-libssl1-0-dev-instaed-of-libssl-dev" class="headerlink" title="Verify the headers have been properly replaced. We should see libssl1.0-dev instaed of libssl-dev:"></a>Verify the headers have been properly replaced. We should see <strong>libssl1.0-dev</strong> instaed of <strong>libssl-dev</strong>:</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ apt list --installed | grep libssl</span><br><span class="line">WARNING: apt does not have a stable CLI interface. Use with caution in scripts.</span><br><span class="line">libssl1.0-dev/stable,now 1.0.2l-2+deb9u3 armhf [installed]</span><br><span class="line">libssl1.0.2/stable,now 1.0.2l-2+deb9u3 armhf [installed]</span><br><span class="line">libssl1.1/now 1.1.0f-3+deb9u1 armhf [installed,upgradable to: 1.1.0f-3+deb9u2]</span><br></pre></td></tr></table></figure>
<h5 id="Install-other-required-dependencies"><a href="#Install-other-required-dependencies" class="headerlink" title="Install other required dependencies:"></a>Install other required dependencies:</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get install cmake make gcc g++ flex bison libpcap-dev libssl-dev python-dev swig zlib1g-dev</span><br></pre></td></tr></table></figure>
<h5 id="Download-Bro-using-git-clone-or-wget"><a href="#Download-Bro-using-git-clone-or-wget" class="headerlink" title="Download Bro using git clone or wget:"></a>Download Bro using <strong>git clone</strong> or <strong>wget</strong>:</h5><p>Method 1</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo git clone --recursive git://git.bro.org/bro</span><br></pre></td></tr></table></figure>
<p>Method 2</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo wget https://www.bro.org/downloads/bro-2.5.3.tar.gz</span><br><span class="line">$ sudo tar xvzf bro-2.5.3.tar.gz</span><br></pre></td></tr></table></figure>
<h5 id="Install-BRO-using-make-amp-make-install"><a href="#Install-BRO-using-make-amp-make-install" class="headerlink" title="Install BRO using make &amp; make install:"></a>Install BRO using <strong>make</strong> &amp; <strong>make install</strong>:</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ cd bro</span><br><span class="line">$ ./configure --prefix=/nsm/bro</span><br><span class="line">$ sudo make</span><br><span class="line">$ sudo make install</span><br></pre></td></tr></table></figure>
<h5 id="Select-which-NIC-and-which-subnet-will-be-used-for-monitoring"><a href="#Select-which-NIC-and-which-subnet-will-be-used-for-monitoring" class="headerlink" title="Select which NIC and which subnet will be used for monitoring:"></a>Select which <strong>NIC</strong> and which subnet will be used for monitoring:</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ nano /nsm/bro/etc/node.cfg</span><br><span class="line">$ nano /nsm/bro/etc/networks.cfg</span><br></pre></td></tr></table></figure>
<h5 id="Command-to-start-BRO-IDS"><a href="#Command-to-start-BRO-IDS" class="headerlink" title="Command to start BRO IDS:"></a>Command to start BRO IDS:</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/nsm/bro/bin/broctl</span><br><span class="line">install</span><br><span class="line">exit</span><br></pre></td></tr></table></figure>
<h5 id="Add-the-following-into-rc-local-for-auto-start"><a href="#Add-the-following-into-rc-local-for-auto-start" class="headerlink" title="Add the following into rc.local for auto-start:"></a>Add the following into <strong>rc.local</strong> for auto-start:</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/nsm/bro/bin/broctl start</span><br></pre></td></tr></table></figure>
<h5 id="Optimization-using-Cron"><a href="#Optimization-using-Cron" class="headerlink" title="Optimization using Cron"></a>Optimization using Cron</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">#### Clean /nsm/bro/logs at 23:59 everyday</span><br><span class="line">$ sudo crontab -e</span><br><span class="line">59 23 * * * rm -rf /nsm/bro/logs/20??-*-*</span><br><span class="line"></span><br><span class="line">#### Restart cron service</span><br><span class="line">$ sudo /etc/init.d/cron restart</span><br><span class="line"></span><br><span class="line">#### Check the cron runnning status in Debian</span><br><span class="line">$ sudo /etc/init.d/cron status</span><br><span class="line">● cron.service - Regular background program processing daemon</span><br><span class="line">   Loaded: loaded (/lib/systemd/system/cron.service; enabled; vendor preset: enabled)</span><br><span class="line">   Active: active (running) since Mon 2018-05-14 21:41:54 NZST; 5min ago</span><br><span class="line">     Docs: man:cron(8)</span><br><span class="line"> Main PID: 12368 (cron)</span><br><span class="line">   CGroup: /system.slice/cron.service</span><br><span class="line">           └─12368 /usr/sbin/cron -f</span><br></pre></td></tr></table></figure>
<h5 id="Start-Bro-and-ensure-that-files-needed-by-BroControl-amp-Bro-are-brought-up-to-date-based-on-the-current-configurations"><a href="#Start-Bro-and-ensure-that-files-needed-by-BroControl-amp-Bro-are-brought-up-to-date-based-on-the-current-configurations" class="headerlink" title="Start Bro and ensure that files needed by BroControl &amp; Bro are brought up-to-date based on the current configurations"></a>Start Bro and ensure that files needed by BroControl &amp; Bro are brought up-to-date based on the current configurations</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo broctl deploy</span><br></pre></td></tr></table></figure>
<h4 id="BRO-IDS-sending-emails"><a href="#BRO-IDS-sending-emails" class="headerlink" title="BRO IDS sending emails"></a>BRO IDS sending emails</h4><p>Configure <span style="color:darkblue"><strong>/etc/ssmtp/ssmtp.conf</strong></span></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Debug=YES</span><br><span class="line">root=xxxx@gmail.com</span><br><span class="line">mailhub=smtp.gmail.com:465</span><br><span class="line">rewriteDomain=gmail.com</span><br><span class="line">hostname=raspberrypi3</span><br><span class="line">FromLineOverride=YES</span><br><span class="line">UseTLS=Yes</span><br><span class="line">UseSTARTTLS=No</span><br><span class="line">AuthUser=username</span><br><span class="line">AuthPass=password</span><br></pre></td></tr></table></figure>
<p>Configure <span style="color:darkblue"><strong>/etc/bro/broctl.cfg</strong></span>. This file has something to do with email sendings regarding system health report.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># Recipient address for all emails sent out by Bro and BroControl.</span><br><span class="line">MailTo = root@localhost</span><br><span class="line"></span><br><span class="line"># This will auto-send an email of &quot;Connection Summary&quot; every 1 hour</span><br><span class="line">LogRotationInterval = 3600</span><br></pre></td></tr></table></figure>
<p>Test email sending function using <span style="color:darkblue"><strong>mail</strong></span>. </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ mail -s &quot;This is a Test Email&quot;  user@gmail.com &lt; /dev/null</span><br><span class="line">... ...</span><br><span class="line">mail: Null message body; hope that&apos;s ok</span><br></pre></td></tr></table></figure>
<p>[Reference: 5 Ways to Send Email From Linux Command Line - <a href="https://tecadmin.net/ways-to-send-email-from-linux-command-line/]" target="_blank" rel="noopener">https://tecadmin.net/ways-to-send-email-from-linux-command-line/]</a></p>
<h4 id="BRO-IDS-Command-Lines"><a href="#BRO-IDS-Command-Lines" class="headerlink" title="BRO IDS Command Lines"></a>BRO IDS Command Lines</h4><p>Use <span style="color:darkblue"><strong>bro-cut</strong></span> to parse the logs</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ cat http.log | bro-cut -d ts uid id.orig_h id.orig_p id.resp_h id.resp_p method host uri user_agent status_code status_msg username password</span><br></pre></td></tr></table></figure>
<p>Reference for HTTP.log: <a href="https://www.bro.org/sphinx/scripts/base/protocols/http/main.bro.html" target="_blank" rel="noopener">https://www.bro.org/sphinx/scripts/base/protocols/http/main.bro.html</a></p>
<p>Use <span style="color:darkblue"><strong>query</strong></span> to check top dns queries</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ bro-cut query &lt; dns.log | sort | uniq -c | sort -rn | head -n 10</span><br></pre></td></tr></table></figure>
<p>Exercise - Understanding and Examining Bro Logs</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://www.bro.org/current/solutions/logs/index.html</span><br></pre></td></tr></table></figure>
<p>Convert pcap to bro log format (e.g. Below, there’re 4 different xx.log generated)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ sudo bro -r http.pcap</span><br><span class="line">total 3988</span><br><span class="line">-rw-r--r-- 1 root root   13403 May 23 21:03 conn.log</span><br><span class="line">-rw-r--r-- 1 root root   27396 May 23 21:03 files.log</span><br><span class="line">-rw-r--r-- 1 root root   71154 May 23 21:03 http.log</span><br><span class="line">-rw-r--r-- 1 root root 3956760 Nov  7  2013 http.pcap</span><br><span class="line">-rw-r--r-- 1 root root     253 May 23 21:03 packet_filter.log</span><br></pre></td></tr></table></figure>
<p>What are the 5 most commonly visited webs sites?</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ bro-cut host &lt; http.log | sort | uniq -c | sort -n | tail -n 5</span><br><span class="line">$ zcat http.xxxx.log.gz | bro-cut host | sort | uniq -c | sort -n | tail -n 5</span><br></pre></td></tr></table></figure>
<p>Top 10 GeoIP in conn.log</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ bro-cut resp_cc &lt; conn.log | sort | uniq -c | sort -rn | head -n 10</span><br></pre></td></tr></table></figure>
<h3 id="Critical-Stack-on-RaspberryPi-3"><a href="#Critical-Stack-on-RaspberryPi-3" class="headerlink" title="Critical Stack on RaspberryPi 3"></a>Critical Stack on RaspberryPi 3</h3><h4 id="Add-“Collecter”-“Sensor”-and-“Feed”-from"><a href="#Add-“Collecter”-“Sensor”-and-“Feed”-from" class="headerlink" title="Add “Collecter”, “Sensor” and “Feed” from"></a>Add “Collecter”, “Sensor” and “Feed” from</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://intel.criticalstack.com</span><br></pre></td></tr></table></figure>
<h4 id="Config-Critical-Stack-with-Bro"><a href="#Config-Critical-Stack-with-Bro" class="headerlink" title="Config Critical Stack with Bro"></a>Config Critical Stack with Bro</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ sudo -u critical-stack critical-stack-intel config --set bro.path=/nsm/bro</span><br><span class="line">$ sudo -u critical-stack critical-stack-intel config --set bro.include.path=/usr/share/bro/site/local.bro</span><br><span class="line">$ sudo -u critical-stack critical-stack-intel config --set bro.broctl.path=/usr/bin/broctl</span><br><span class="line">$ sudo -u critical-stack critical-stack-intel api xxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxx</span><br></pre></td></tr></table></figure>
<h4 id="Check-Critical-Stack-IOCs"><a href="#Check-Critical-Stack-IOCs" class="headerlink" title="Check Critical Stack IOCs"></a>Check Critical Stack IOCs</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo -u critical-stack critical-stack-intel list</span><br></pre></td></tr></table></figure>
<h4 id="Fetch-from-the-Intel-Market-using-API-key"><a href="#Fetch-from-the-Intel-Market-using-API-key" class="headerlink" title="Fetch from the Intel Market using API key"></a>Fetch from the Intel Market using API key</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$ sudo -u critical-stack critical-stack-intel pull</span><br><span class="line"></span><br><span class="line">critical-stack 19:11:13 [INFO] Downloading feed information. Run with the `--debug` flag for more information.</span><br><span class="line">7 / 7 [====] 100.00 % 9s</span><br><span class="line">critical-stack 19:11:22 [INFO] Creating master file: master-public.bro.dat. Please wait.</span><br><span class="line">critical-stack 19:11:22 [INFO] Master file created successfully.</span><br><span class="line">critical-stack 19:11:22 [INFO] Checking bro configuration files.</span><br><span class="line">critical-stack 19:11:22 [INFO] Intel include exists in: /usr/share/bro/site/local.bro</span><br><span class="line">critical-stack 19:11:22 [WARN] --- RESTART NOTICE ---</span><br><span class="line">critical-stack 19:11:22 [WARN] You need to restart bro for changes to take effect.</span><br><span class="line">critical-stack 19:11:22 [INFO]     * sudo broctl check</span><br><span class="line">critical-stack 19:11:22 [INFO]     * sudo broctl install</span><br><span class="line">critical-stack 19:11:22 [INFO]     * sudo broctl restart</span><br><span class="line">critical-stack 19:11:22 [INFO] For automatic restarts run: `critical-stack-intel config --set bro.restart=true`</span><br><span class="line">critical-stack 19:11:22 [INFO] Intel files located at: /opt/critical-stack/frameworks/intel</span><br><span class="line">critical-stack 19:11:22 [INFO] API Requests Remaining: 999 of 1000/minute</span><br></pre></td></tr></table></figure>
<h4 id="Restart-Bro-for-changes-to-take-effect"><a href="#Restart-Bro-for-changes-to-take-effect" class="headerlink" title="Restart Bro for changes to take effect"></a>Restart Bro for changes to take effect</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ broctl check</span><br><span class="line">$ broctl install</span><br><span class="line">$ broctl restart</span><br></pre></td></tr></table></figure>
<h4 id="Set-automatic-restarts"><a href="#Set-automatic-restarts" class="headerlink" title="Set automatic restarts"></a>Set automatic restarts</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo -u critical-stack critical-stack-intel config --set bro.restart=true</span><br></pre></td></tr></table></figure>
<h4 id="Test-if-our-TI-is-working-properly"><a href="#Test-if-our-TI-is-working-properly" class="headerlink" title="Test if our TI is working properly"></a>Test if our TI is working properly</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># IP 185.170.42.14 is on ET known Compromised Host List</span><br><span class="line"># We do a SSH attempt on a testing machine then we can succesfully find this event in intel.log</span><br><span class="line"></span><br><span class="line">[Testing] $ ssh 185.170.42.14</span><br><span class="line"></span><br><span class="line">[Bro Log] $ cd /nsm/bro/logs/current </span><br><span class="line"></span><br><span class="line">[Bro Log] $ cat intel.log </span><br><span class="line">1526984588.191862 CrOHZ311FHM0wYnonf    115.xxx.xxx.74 53092 185.170.42.14 22 185.170.42.14 Intel::ADDR Conn::IN_RESP bro Intel::ADDR    from http://rules.emergingthreats.net/open/suricata/rules/compromised.rules via intel.criticalstack.com    -    -    -</span><br><span class="line"></span><br><span class="line">[Bro Log] $ cat intel.log | bro-cut -d ts id.orig_h id.orig_p id.resp_h id.resp_p proto query</span><br><span class="line">2018-05-22T22:23:08+1200 115.xxx.xxx.74 53092 185.170.42.14 22</span><br></pre></td></tr></table></figure>
<h3 id="Suricata-IDS-on-Ubuntu"><a href="#Suricata-IDS-on-Ubuntu" class="headerlink" title="Suricata IDS on Ubuntu"></a>Suricata IDS on Ubuntu</h3><h4 id="Install-Dependencies"><a href="#Install-Dependencies" class="headerlink" title="Install Dependencies"></a>Install Dependencies</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get -y install libpcre3 libpcre3-dbg libpcre3-dev \</span><br><span class="line">build-essential autoconf automake libtool libpcap-dev libnet1-dev \</span><br><span class="line">libyaml-0-2 libyaml-dev zlib1g zlib1g-dev libmagic-dev libcap-ng-dev \</span><br><span class="line">libjansson-dev pkg-config</span><br></pre></td></tr></table></figure>
<h4 id="Install-libhtp-via-OISF"><a href="#Install-libhtp-via-OISF" class="headerlink" title="Install libhtp via OISF"></a>Install <span style="color:darkblue"><strong>libhtp</strong></span> via OISF</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ git clone  https://github.com/OISF/libhtp.git</span><br><span class="line">$ cd libhtp/</span><br><span class="line">$./autogen.sh</span><br><span class="line">$./configure</span><br><span class="line">$ make &amp;&amp; sudo make install</span><br></pre></td></tr></table></figure>
<h4 id="Download-suricata-and-unzip"><a href="#Download-suricata-and-unzip" class="headerlink" title="Download suricata and unzip"></a>Download suricata and unzip</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ wget https://www.openinfosecfoundation.org/download/suricata-4.0.4.tar.gz</span><br><span class="line">$ tar -xvf suricata-4.0.4.tar.gz</span><br></pre></td></tr></table></figure>
<h4 id="Complie-suricata"><a href="#Complie-suricata" class="headerlink" title="Complie suricata"></a>Complie suricata</h4><p>By default, suricate runs on IDS mode</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ cd suricata-4.0.4</span><br><span class="line">$ ./configure --prefix=/usr --sysconfdir=/etc --localstatedir=/var</span><br></pre></td></tr></table></figure>
<p>Alternatively, suricate can runs on IDS &amp; IPS mode</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get -y install libnetfilter-queue-dev libnetfilter-queue1 libnfnetlink-dev libnfnetlink0  </span><br><span class="line">$ ./configure --enable-nfqueue --prefix=/usr --sysconfdir=/etc --localstatedir=/var</span><br></pre></td></tr></table></figure>
<h4 id="Install-suricata-with-default-configuration"><a href="#Install-suricata-with-default-configuration" class="headerlink" title="Install suricata with default configuration"></a>Install suricata with default configuration</h4><p>Below is default configuration</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ make &amp;&amp; sudo make install</span><br><span class="line">$ sudo make install-conf # Using Default Configuration</span><br><span class="line">$ sudo make install-rules # Install Default Rules  </span><br><span class="line">$ sudo ldconfig # Enable shared system dynamic lib</span><br></pre></td></tr></table></figure>
<p>If we don’t use default configuration, we can also</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ sudo mkdir /var/log/suricata</span><br><span class="line">$ sudo mkdir /etc/suricata</span><br><span class="line"></span><br><span class="line">$ cd /etc/suricata</span><br><span class="line">$ wget http://rules.emergingthreats.net/open/suricata/emerging.rules.tar.gz</span><br><span class="line">$ tar zxvf emerging.rules.tar.gz</span><br><span class="line">$ sudo cp -R rules/ /etc/suricata/</span><br><span class="line"></span><br><span class="line">$ cd suricata-4.0.4</span><br><span class="line">$ sudo cp suricata.yaml classification.config reference.config /etc/suricata/</span><br></pre></td></tr></table></figure>
<h4 id="Edit-etc-suricata-suricata-yaml"><a href="#Edit-etc-suricata-suricata-yaml" class="headerlink" title="Edit /etc/suricata/suricata.yaml"></a>Edit /etc/suricata/suricata.yaml</h4><p>Key configuration fileds</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># Network Configuration</span><br><span class="line">HOME_NET: &quot;[192.168.0.0/16,10.0.0.0/8,172.16.0.0/12]&quot;</span><br><span class="line">EXTERNAL_NET: &quot;!$HOME_NET&quot;</span><br><span class="line"></span><br><span class="line"># Log file path</span><br><span class="line">default-log-dir: /var/log/suricata/</span><br><span class="line"></span><br><span class="line"># Number of packets preallocated per thread. Default 1024</span><br><span class="line">max-pending-packets: 1024 </span><br><span class="line"></span><br><span class="line"># Preallocated size for packet. Default 1514</span><br><span class="line">default-packet-size</span><br></pre></td></tr></table></figure>
<p>Suricata Security Rules</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://redmine.openinfosecfoundation.org/projects/suricata/wiki/Suricata_Rules</span><br></pre></td></tr></table></figure>
<h4 id="Create-our-own-rules-for-testing-purposes"><a href="#Create-our-own-rules-for-testing-purposes" class="headerlink" title="Create our own rules for testing purposes"></a>Create our own rules for testing purposes</h4><p>Edit <span style="color:darkblue"><strong>/etc/suricata/suricata.yaml</strong></span></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">default-rule-path: /etc/suricata/rules</span><br><span class="line">rule-files:</span><br><span class="line"> - my.rules</span><br></pre></td></tr></table></figure>
<p>Go to <span style="color:darkblue"><strong>my.rules</strong></span></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alert icmp $HOME_NET any -&gt; $EXTERNAL_NET any (msg:&quot;TEST :ICMP PING&quot;; itype:8; sid:20000; rev:3;)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alert tcp any any -&gt; any 80 (msg:&quot;http test&quot;;)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alert http any any -&gt; any any (msg:&quot;Filemagic jgp(1)&quot;; flow:established; filemagic:&quot;JPEG image data&quot;; filestore; sid:10; rev:1;)</span><br></pre></td></tr></table></figure>
<h4 id="Suricata-Running-Mode"><a href="#Suricata-Running-Mode" class="headerlink" title="Suricata Running Mode"></a>Suricata Running Mode</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">$ sudo suricata --list-runmodes</span><br><span class="line"></span><br><span class="line">------------------------------------- Runmodes ------------------------------------------</span><br><span class="line">| RunMode Type      | Custom Mode       | Description</span><br><span class="line">|----------------------------------------------------------------------------------------</span><br><span class="line">| PCAP_DEV          | single            | Single threaded pcap live mode</span><br><span class="line">|                   ---------------------------------------------------------------------</span><br><span class="line">|                   | autofp            | Multi threaded pcap live mode.  Packets from each flow are assigned to a single detect thread, unlike &quot;pcap_live_auto&quot; where packets from the same flow can be processed by any detect thread</span><br><span class="line">|                   ---------------------------------------------------------------------</span><br><span class="line">|                   | workers           | Workers pcap live mode, each thread does all tasks from acquisition to logging</span><br><span class="line">|----------------------------------------------------------------------------------------</span><br><span class="line">| PCAP_FILE         | single            | Single threaded pcap file mode</span><br><span class="line">|                   ---------------------------------------------------------------------</span><br><span class="line">|                   | autofp            | Multi threaded pcap file mode.  Packets from each flow are assigned to a single detect thread, unlike &quot;pcap-file-auto&quot; where packets from the same flow can be processed by any detect thread</span><br><span class="line">|----------------------------------------------------------------------------------------</span><br><span class="line">| PFRING(DISABLED)  | autofp            | Multi threaded pfring mode.  Packets from each flow are assigned to a single detect thread, unlike &quot;pfring_auto&quot; where packets from the same flow can be processed by any detect thread</span><br><span class="line">|                   ---------------------------------------------------------------------</span><br><span class="line">|                   | single            | Single threaded pfring mode</span><br><span class="line">|                   ---------------------------------------------------------------------</span><br><span class="line">|                   | workers           | Workers pfring mode, each thread does all tasks from acquisition to logging</span><br><span class="line">|----------------------------------------------------------------------------------------</span><br><span class="line">| NFQ               | autofp            | Multi threaded NFQ IPS mode with respect to flow</span><br><span class="line">|                   ---------------------------------------------------------------------</span><br><span class="line">|                   | workers           | Multi queue NFQ IPS mode with one thread per queue</span><br><span class="line">|----------------------------------------------------------------------------------------</span><br><span class="line">| NFLOG             | autofp            | Multi threaded nflog mode</span><br><span class="line">|                   ---------------------------------------------------------------------</span><br><span class="line">|                   | single            | Single threaded nflog mode</span><br><span class="line">|                   ---------------------------------------------------------------------</span><br><span class="line">|                   | workers           | Workers nflog mode</span><br><span class="line">|----------------------------------------------------------------------------------------</span><br><span class="line">| IPFW              | autofp            | Multi threaded IPFW IPS mode with respect to flow</span><br><span class="line">|                   ---------------------------------------------------------------------</span><br><span class="line">|                   | workers           | Multi queue IPFW IPS mode with one thread per queue</span><br><span class="line">|----------------------------------------------------------------------------------------</span><br><span class="line">| ERF_FILE          | single            | Single threaded ERF file mode</span><br><span class="line">|                   ---------------------------------------------------------------------</span><br><span class="line">|                   | autofp            | Multi threaded ERF file mode.  Packets from each flow are assigned to a single detect thread</span><br><span class="line">|----------------------------------------------------------------------------------------</span><br><span class="line">| ERF_DAG           | autofp            | Multi threaded DAG mode.  Packets from each flow are assigned to a single detect thread, unlike &quot;dag_auto&quot; where packets from the same flow can be processed by any detect thread</span><br><span class="line">|                   ---------------------------------------------------------------------</span><br><span class="line">|                   | single            | Singled threaded DAG mode</span><br><span class="line">|                   ---------------------------------------------------------------------</span><br><span class="line">|                   | workers           | Workers DAG mode, each thread does all  tasks from acquisition to logging</span><br><span class="line">|----------------------------------------------------------------------------------------</span><br><span class="line">| AF_PACKET_DEV     | single            | Single threaded af-packet mode</span><br><span class="line">|                   ---------------------------------------------------------------------</span><br><span class="line">|                   | workers           | Workers af-packet mode, each thread does all tasks from acquisition to logging</span><br><span class="line">|                   ---------------------------------------------------------------------</span><br><span class="line">|                   | autofp            | Multi socket AF_PACKET mode.  Packets from each flow are assigned to a single detect thread.</span><br><span class="line">|----------------------------------------------------------------------------------------</span><br><span class="line">| NETMAP(DISABLED)  | single            | Single threaded netmap mode</span><br><span class="line">|                   ---------------------------------------------------------------------</span><br><span class="line">|                   | workers           | Workers netmap mode, each thread does all tasks from acquisition to logging</span><br><span class="line">|                   ---------------------------------------------------------------------</span><br><span class="line">|                   | autofp            | Multi threaded netmap mode.  Packets from each flow are assigned to a single detect thread.</span><br><span class="line">|----------------------------------------------------------------------------------------</span><br><span class="line">| UNIX_SOCKET       | single            | Unix socket mode</span><br><span class="line">|                   ---------------------------------------------------------------------</span><br><span class="line">|                   | autofp            | Unix socket mode</span><br></pre></td></tr></table></figure>
<h4 id="Disable-NIC-LRO-GRO"><a href="#Disable-NIC-LRO-GRO" class="headerlink" title="Disable NIC LRO/GRO"></a>Disable NIC LRO/GRO</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sudo ethtool -k ensxx # check if LRO/GRO is open</span><br><span class="line">$ sudo ethtool -K ensxx lro off # disable LRO</span><br><span class="line">$ sudo ethtool -K ensxx gro off # disable GRO</span><br></pre></td></tr></table></figure>
<h4 id="Run-suricata"><a href="#Run-suricata" class="headerlink" title="Run suricata"></a>Run suricata</h4><p>Event will be logged in <span style="color:darkblue"><strong>fast.log</strong></span> uder <span style="color:darkblue"><strong>/var/log/suricata/</strong></span></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ sudo suricata -c /etc/suricata/suricata.yaml -i ens33</span><br><span class="line"></span><br><span class="line">29/5/2018 -- 13:47:43 - &lt;Notice&gt; - This is Suricata version 4.0.4 RELEASE</span><br><span class="line">29/5/2018 -- 13:47:52 - &lt;Notice&gt; - all 1 packet processing threads, 4 management threads initialized, engine started.</span><br></pre></td></tr></table></figure>
<h3 id="Scirius-CE-Portal-on-Ubuntu"><a href="#Scirius-CE-Portal-on-Ubuntu" class="headerlink" title="Scirius CE (Portal) on Ubuntu"></a>Scirius CE (Portal) on Ubuntu</h3><p>Scirius Community Edition is a web interface dedicated to Suricata ruleset management. It handles the rules file and update associated files.</p>
<h4 id="Installation-Steps"><a href="#Installation-Steps" class="headerlink" title="Installation Steps"></a>Installation Steps</h4><p>Install pip on Debian</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get install aptitude</span><br><span class="line">$ sudo aptitude install python-pip python-dev</span><br></pre></td></tr></table></figure>
<p>If you have these packages installed you need to remove them so that Scirius would work with the latest python dependencies.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get remove django-tables python-django python-django-south python-git</span><br></pre></td></tr></table></figure>
<p>Install django and the dependencies</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ pip install django django-tables2 South GitPython pyinotify daemon</span><br><span class="line">$ pip install -r requirements.txt</span><br><span class="line">$ pip install pyinotify</span><br><span class="line">$ pip install gitpython==0.3.1-beta2</span><br><span class="line">$ pip install gitdb</span><br></pre></td></tr></table></figure>
<p>We need a stable version of npm and webpack version 3.11</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get install npm</span><br><span class="line">$ sudo npm install -g npm@latest webpack@3.11</span><br><span class="line">root@hostname:/opt/scirius# npm install</span><br><span class="line"></span><br><span class="line">$ npm install --save-dev webpack</span><br></pre></td></tr></table></figure>
<p>[Optional] If errors occur</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ sudo npm install eslint-loader --save-dev</span><br><span class="line">$ sudo npm install eslint --save-dev</span><br><span class="line">$ sudo npm install babel-eslint --save-dev</span><br><span class="line"></span><br><span class="line">$ sudo npm install webpack</span><br><span class="line">$ sudo npm install babel-loader</span><br><span class="line">$ sudo npm install &quot;babel-loader@^8.0.0-beta&quot; @babel/core @babel/preset-env webpack</span><br><span class="line">$ sudo npm i extract-text-webpack-plugin</span><br><span class="line"></span><br><span class="line">$ sudo npm install style-loader css-loader --save</span><br><span class="line">$ sudo npm install sass-loader -D</span><br><span class="line">$ sudo npm install node-sass -D</span><br></pre></td></tr></table></figure>
<p>Clone the latest version</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ cd /opt</span><br><span class="line">$ sudo git clone https://github.com/StamusNetworks/scirius.git</span><br><span class="line">$ cd scirius</span><br></pre></td></tr></table></figure>
<h4 id="Configure-Scirius-CE"><a href="#Configure-Scirius-CE" class="headerlink" title="Configure Scirius CE"></a>Configure Scirius CE</h4><p>Initiate Django database from inside the source directory.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ cd /opt/scirius</span><br><span class="line">$ sudo python manage.py migrate</span><br></pre></td></tr></table></figure>
<p>Authentication is by default in scirius so you will need to create a superuser account</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo python manage.py createsuperuser</span><br></pre></td></tr></table></figure>
<p>Before starting the application you need to construct the bundles by running webpack</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo webpack</span><br></pre></td></tr></table></figure>
<h4 id="Permanent-way-of-making-ES-Replicas-0"><a href="#Permanent-way-of-making-ES-Replicas-0" class="headerlink" title="Permanent way of making ES Replicas = 0"></a>Permanent way of making ES Replicas = 0</h4><p><a href="https://discuss.elastic.co/t/permanent-way-of-making-es-replicas-0/58206" target="_blank" rel="noopener">https://discuss.elastic.co/t/permanent-way-of-making-es-replicas-0/58206</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ curl -XPUT &apos;localhost:9200/_template/priority1&apos; -d &apos;</span><br><span class="line">&#123;</span><br><span class="line">&quot;template&quot; : &quot;*&quot;,</span><br><span class="line">&quot;settings&quot; : &#123;&quot;number_of_replicas&quot; : 0 &#125;</span><br><span class="line">&#125; &apos;</span><br></pre></td></tr></table></figure>
<h4 id="Run-Scirius-CE"><a href="#Run-Scirius-CE" class="headerlink" title="Run Scirius CE"></a>Run Scirius CE</h4><p>One of the easiest way to try Scirius CE is to run the Django test server. You can then connect to <span style="color:darkblue"><strong><a href="http://localhost:8000" target="_blank" rel="noopener">http://localhost:8000</a></strong></span></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ sudo python manage.py runserver</span><br><span class="line"></span><br><span class="line">Django version 1.11.13, using settings &apos;scirius.settings&apos;</span><br><span class="line">Starting development server at http://127.0.0.1:8000/</span><br><span class="line">Quit the server with CONTROL-C.</span><br></pre></td></tr></table></figure>
<p>If you need the application to listen to a reachable address, you can run something like</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo python manage.py runserver 192.168.1.220:8000</span><br></pre></td></tr></table></figure>
<p>Also, don’t forget tp add the HOST IP that you want to actually access, to ALLOWED_HOSTS under <span style="color:darkblue"><strong>scirius/scirius/settings.py</strong></span></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALLOWED_HOSTS = [&apos;192.168.1.220&apos;]</span><br></pre></td></tr></table></figure>
<h4 id="Initialize-Scirius-CE"><a href="#Initialize-Scirius-CE" class="headerlink" title="Initialize Scirius CE"></a>Initialize Scirius CE</h4><p>To interact with Scirius CE, you need to detect when <span style="color:darkblue"><strong>/etc/suricata/rules/scirius.reload</strong></span>  file are created, initiate a reload or restart of Suricata when it is the case and delete the reload file once this is done.</p>
<p>Run below command in one Terminal [scirius]</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ cd /opt/scirius/suricata/scripts</span><br><span class="line">$ sudo ./suri_reloader -p /etc/suricata/rules/ -l /var/log/suri-reload.log -r</span><br></pre></td></tr></table></figure>
<p>Start Suricata in another Terminal [suricata]</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo suricata -c /etc/suricata/suricata.yaml -i ens33</span><br></pre></td></tr></table></figure>
<p>Create a new source on scirius web portal</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Source -&gt; Emerging Threats Open Ruleset</span><br></pre></td></tr></table></figure>
<p><img src="/uploadimage/scirius_add_source_1.png" alt="Image"></p>
<p><img src="/uploadimage/scirius_add_source_2.png" alt="Image"></p>
<p>Create a new Ruleset on scirius web portal</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Rulesets -&gt; myScirius </span><br><span class="line">[Using &quot;Emerging Threats Open Ruleset&quot; as a source]</span><br></pre></td></tr></table></figure>
<p><img src="/uploadimage/scirius_add_ruleset_1.png" alt="Image"></p>
<p><img src="/uploadimage/scirius_add_ruleset_2.png" alt="Image"></p>
<p>Edit Suricata on scirius web portal</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Name: suricata</span><br><span class="line">Descr: suricata</span><br><span class="line">Rules directory: /etc/suricata/rules/</span><br><span class="line">Suricata configuration file: /etc/suricata/suricata.yaml</span><br><span class="line">Ruleset: myScirius</span><br></pre></td></tr></table></figure>
<p>Tick Suricata Ruleset Actions on scirius web portal</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Actions: Update | Build | Push</span><br></pre></td></tr></table></figure>
<p>Then, IDS rules will be auto-generated under</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">xxx@hostname:/etc/suricata/rules$ ls -l</span><br><span class="line">total 13800</span><br><span class="line">-rw-rw-r-- 1 root root     1673 May 30 21:53 BSD-License.txt</span><br><span class="line">-rw-rw-r-- 1 root root     2638 May 30 21:53 classification.config</span><br><span class="line">-rw-rw-r-- 1 root root     9013 May 30 21:53 compromised-ips.txt</span><br><span class="line">-rw-rw-r-- 1 root root     3349 May 30 21:53 emerging.conf</span><br><span class="line">-rw-rw-r-- 1 root root    18273 May 30 21:53 gen-msg.map</span><br><span class="line">-rw-rw-r-- 1 root root    18092 May 30 21:53 gpl-2.0.txt</span><br><span class="line">-rw-rw-r-- 1 root root     2243 May 30 21:53 LICENSE</span><br><span class="line">-rw-rw-r-- 1 root root     1377 May 30 21:53 reference.config</span><br><span class="line">-rw-r--r-- 1 root root       32 May 30 22:06 scirius.reload</span><br><span class="line">-rw-r--r-- 1 root root 10307949 May 30 22:06 scirius.rules</span><br><span class="line">-rw-rw-r-- 1 root root  3570798 May 30 21:53 sid-msg.map</span><br><span class="line">-rw-rw-r-- 1 root root    32438 May 30 21:53 suricata-1.2-prior-open.yaml</span><br><span class="line">-rw-rw-r-- 1 root root    37450 May 30 21:53 suricata-1.3-etpro-etnamed.yaml</span><br><span class="line">-rw-rw-r-- 1 root root    37589 May 30 21:53 suricata-1.3-open.yaml</span><br><span class="line">-rw-rw-r-- 1 root root        0 May 30 21:53 suricata-4.0-enhanced-open.txt</span><br><span class="line">-rw-r--r-- 1 root root        0 May 30 22:06 threshold.config</span><br><span class="line">-rw-rw-r-- 1 root root    53841 May 30 21:53 unicode.map</span><br></pre></td></tr></table></figure>
<h4 id="Install-Elasticsearch"><a href="#Install-Elasticsearch" class="headerlink" title="Install Elasticsearch"></a>Install Elasticsearch</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get install openjdk-8-jre</span><br><span class="line">$ curl -L -O https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-6.2.4.deb</span><br><span class="line">$ sudo dpkg -i elasticsearch-6.2.4.deb</span><br><span class="line">$ sudo /etc/init.d/elasticsearch start</span><br></pre></td></tr></table></figure>
<h4 id="Install-Logstash"><a href="#Install-Logstash" class="headerlink" title="Install Logstash"></a>Install Logstash</h4><p>An important advantage to this approach is that you can use Logstash to modify the data captured by Beats in any way you like. You can also use Logstash’s many output plugins to integrate with other systems.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get install openjdk-8-jre</span><br><span class="line">$ curl -L -O https://artifacts.elastic.co/downloads/logstash/logstash-6.2.4.deb</span><br><span class="line">$ sudo dpkg -i logstash-6.2.4.deb</span><br></pre></td></tr></table></figure>
<p>Logstash set up</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://www.elastic.co/guide/en/beats/libbeat/current/logstash-installation.html</span><br></pre></td></tr></table></figure>
<p>Run Logstash</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo /etc/init.d/logstash start</span><br></pre></td></tr></table></figure>
<h4 id="Link-with-Elasticsearch"><a href="#Link-with-Elasticsearch" class="headerlink" title="Link with Elasticsearch"></a>Link with Elasticsearch</h4><p>To setup Elasticsearch connection, you can edit <strong>settings.py</strong> or create a <strong>local_settings.py</strong> file under scirius directory to setup the feature. </p>
<p>Elasticsearch is activated if a variable names <strong>USE_ELASTICSEARCH</strong> is set to True in /opt/scirius/scirius/settings.py.</p>
<p>The address of the Elasticsearch is stored in the <strong>ELASTICSEARCH_ADDRESS</strong> variable and uses the format <strong>IP:Port</strong>.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ sudo nano /opt/scirius/scirius/settings.py</span><br><span class="line">USE_ELASTICSEARCH = True</span><br><span class="line">ELASTICSEARCH_ADDRESS = &quot;192.168.1.210:9200&quot;</span><br><span class="line">ELASTICSEARCH_VERSION = 2 # In 1, 2, 5 set depending on ES major version</span><br></pre></td></tr></table></figure>
<p><img src="/uploadimage/RaspberryPi3-NSM-Design_Link_Scirius_Elasticsearch_1.png" alt="Image"></p>
<p><img src="/uploadimage/RaspberryPi3-NSM-Design_Link_Scirius_Elasticsearch_2.png" alt="Image"></p>
<h3 id="SELKS-Suricata-Scirius-Kibana-Logstash-Evebox"><a href="#SELKS-Suricata-Scirius-Kibana-Logstash-Evebox" class="headerlink" title="SELKS (Suricata + Scirius + Kibana + Logstash + Evebox)"></a>SELKS (Suricata + Scirius + Kibana + Logstash + Evebox)</h3><p>SELKS 4.0 Stamus Networks</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://www.stamus-networks.com/2017/08/22/selks-4-0/</span><br></pre></td></tr></table></figure>
<p>The SELKS Wiki - User Documentation</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://github.com/StamusNetworks/SELKS/wiki</span><br></pre></td></tr></table></figure>
<h3 id="Moloch-with-Elasticsearch-on-Ubuntu"><a href="#Moloch-with-Elasticsearch-on-Ubuntu" class="headerlink" title="Moloch (with Elasticsearch) on Ubuntu"></a>Moloch (with Elasticsearch) on Ubuntu</h3><h4 id="Modify-Hostname"><a href="#Modify-Hostname" class="headerlink" title="Modify Hostname"></a>Modify Hostname</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sudo nano /etc/hostname</span><br><span class="line">$ sudo nano /etc/hosts</span><br><span class="line">$ sudo reboot</span><br></pre></td></tr></table></figure>
<h4 id="Install-dpendencies-including-JRE-JDK"><a href="#Install-dpendencies-including-JRE-JDK" class="headerlink" title="Install dpendencies including JRE/JDK"></a>Install dpendencies including JRE/JDK</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get install libjson-perl</span><br><span class="line">$ sudo apt-get install default-jre</span><br></pre></td></tr></table></figure>
<h4 id="Modify-max-file-descriptors"><a href="#Modify-max-file-descriptors" class="headerlink" title="Modify max file descriptors"></a>Modify max file descriptors</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sudo nano /etc/security/limits.conf</span><br><span class="line">*        -      nofile          128000</span><br><span class="line">*        -      memlock         unlimited</span><br></pre></td></tr></table></figure>
<h4 id="Optional-Disable-device-and-files-paging-and-swapping-to-increase-efficiency"><a href="#Optional-Disable-device-and-files-paging-and-swapping-to-increase-efficiency" class="headerlink" title="[Optional] Disable device and files paging and swapping to increase efficiency"></a>[Optional] Disable device and files paging and swapping to increase efficiency</h4><p>Method 1</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo swapoff -a (swapon -a)</span><br></pre></td></tr></table></figure>
<p>Method 2</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo nano /etc/fstab</span><br><span class="line"># UUID=xxxxxxx-xxxx-xxxx-xxxx-xxxxxxxx none  swap   sw   0  0</span><br></pre></td></tr></table></figure>
<h4 id="Download-Moloch-v0-17-for-Ubuntu-16-04"><a href="#Download-Moloch-v0-17-for-Ubuntu-16-04" class="headerlink" title="Download Moloch v0.17 for Ubuntu 16.04"></a>Download <strong>Moloch v0.17</strong> for <strong>Ubuntu 16.04</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ wget http://files.molo.ch/builds/ubuntu-16.04/moloch_0.17.0-1_amd64.deb</span><br></pre></td></tr></table></figure>
<h4 id="Install-Moloch"><a href="#Install-Moloch" class="headerlink" title="Install Moloch"></a>Install Moloch</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo dpkg -i moloch_0.17.0-1_amd64.deb</span><br></pre></td></tr></table></figure>
<h4 id="Install-Dependencies-if-the-previous-step-halts-due-to-errors"><a href="#Install-Dependencies-if-the-previous-step-halts-due-to-errors" class="headerlink" title="Install Dependencies (if the previous step halts due to errors)"></a>Install Dependencies (if the previous step halts due to errors)</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get install -f</span><br></pre></td></tr></table></figure>
<h4 id="Configure-Moloch"><a href="#Configure-Moloch" class="headerlink" title="Configure Moloch"></a>Configure Moloch</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ sudo /data/moloch/bin/Configure</span><br><span class="line"></span><br><span class="line">Found interfaces: ens33,lo</span><br><span class="line">Interface to monitor [eth1] ens33</span><br><span class="line">Install Elasticsearch server locally for demo, must have at least 3G of memory, NOT recommended for production use (yes or no) [no] yes</span><br><span class="line">... ...</span><br><span class="line">... ...</span><br><span class="line">Moloch - Configured - Now continue with step 4 in /data/moloch/README.txt</span><br></pre></td></tr></table></figure>
<h4 id="Configure-elasticsearch-yml-in-data-moloch-elasticsearch-config"><a href="#Configure-elasticsearch-yml-in-data-moloch-elasticsearch-config" class="headerlink" title="Configure elasticsearch.yml in /data/moloch/elasticsearch/config"></a>Configure <strong>elasticsearch.yml</strong> in <strong>/data/moloch/elasticsearch/config</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"># ======================== Elasticsearch Configuration =========================</span><br><span class="line">#</span><br><span class="line"># NOTE: Elasticsearch comes with reasonable defaults for most settings.</span><br><span class="line">#       Before you set out to tweak and tune the configuration, make sure you</span><br><span class="line">#       understand what are you trying to accomplish and the consequences.</span><br><span class="line">#</span><br><span class="line"># The primary way of configuring a node is via this file. This template lists</span><br><span class="line"># the most important settings you may want to configure for a production cluster.</span><br><span class="line">#</span><br><span class="line"># Please see the documentation for further information on configuration options:</span><br><span class="line"># &lt;http://www.elastic.co/guide/en/elasticsearch/reference/current/setup-configuration.html&gt;</span><br><span class="line">#</span><br><span class="line"># ---------------------------------- Cluster -----------------------------------</span><br><span class="line">#</span><br><span class="line"># Use a descriptive name for your cluster:</span><br><span class="line">#</span><br><span class="line">cluster.name: moloch</span><br><span class="line">#</span><br><span class="line"># ------------------------------------ Node ------------------------------------</span><br><span class="line">#</span><br><span class="line"># Use a descriptive name for the node:</span><br><span class="line">#</span><br><span class="line">node.name: node1</span><br><span class="line">#</span><br><span class="line"># Add custom attributes to the node:</span><br><span class="line"># node.rack: r1</span><br><span class="line"># ----------------------------------- Paths ------------------------------------</span><br><span class="line">#</span><br><span class="line"># Path to directory where to store the data (separate multiple locations by comma):</span><br><span class="line">#</span><br><span class="line"># path.data: /path/to/data</span><br><span class="line"># Path to log files:</span><br><span class="line">#path.logs: /path/to/logs</span><br><span class="line">#path.logs: /data/moloch/elasticsearch/logs</span><br><span class="line">#</span><br><span class="line"># ----------------------------------- Memory -----------------------------------</span><br><span class="line">#</span><br><span class="line"># Lock the memory on startup:</span><br><span class="line"># bootstrap.memory_lock: true</span><br><span class="line">#</span><br><span class="line"># Make sure that the `ES_HEAP_SIZE` environment variable is set to about half the memory</span><br><span class="line"># available on the system and that the owner of the process is allowed to use this limit.</span><br><span class="line">#</span><br><span class="line"># Elasticsearch performs poorly when the system is swapping the memory.</span><br><span class="line">#</span><br><span class="line"># ---------------------------------- Network -----------------------------------</span><br><span class="line">#</span><br><span class="line"># Set the bind address to a specific IP (IPv4 or IPv6):</span><br><span class="line">#</span><br><span class="line"># network.host: 192.168.0.1</span><br><span class="line">#</span><br><span class="line"># Set a custom port for HTTP:</span><br><span class="line">#</span><br><span class="line"># http.port: 9200</span><br><span class="line">#</span><br><span class="line"># For more information, see the documentation at:</span><br><span class="line"># &lt;http://www.elastic.co/guide/en/elasticsearch/reference/current/modules-network.html&gt;</span><br><span class="line">#</span><br><span class="line"># --------------------------------- Discovery ----------------------------------</span><br><span class="line">#</span><br><span class="line"># Pass an initial list of hosts to perform discovery when new node is started:</span><br><span class="line"># The default list of hosts is [&quot;127.0.0.1&quot;, &quot;[::1]&quot;]</span><br><span class="line">#</span><br><span class="line"># discovery.zen.ping.unicast.hosts: [&quot;host1&quot;, &quot;host2&quot;]</span><br><span class="line">#</span><br><span class="line"># Prevent the &quot;split brain&quot; by configuring the majority of nodes (total number of nodes / 2 + 1):</span><br><span class="line">#</span><br><span class="line">discovery.zen.minimum_master_nodes: 1</span><br><span class="line"></span><br><span class="line">#</span><br><span class="line"># For more information, see the documentation at:</span><br><span class="line"># &lt;http://www.elastic.co/guide/en/elasticsearch/reference/current/modules-discovery.html&gt;</span><br><span class="line">#</span><br><span class="line"># ---------------------------------- Gateway -----------------------------------</span><br><span class="line">#</span><br><span class="line"># Block initial recovery after a full cluster restart until N nodes are started:</span><br><span class="line">#</span><br><span class="line"># gateway.recover_after_nodes: 3</span><br><span class="line">#</span><br><span class="line"># For more information, see the documentation at:</span><br><span class="line"># &lt;http://www.elastic.co/guide/en/elasticsearch/reference/current/modules-gateway.html&gt;</span><br><span class="line">#</span><br><span class="line"># ---------------------------------- Various -----------------------------------</span><br><span class="line">#</span><br><span class="line"># Disable starting multiple nodes on a single system:</span><br><span class="line">#</span><br><span class="line"># node.max_local_storage_nodes: 1</span><br><span class="line">#</span><br><span class="line"># Require explicit names when deleting indices:</span><br><span class="line">#</span><br><span class="line"># action.destructive_requires_name: true</span><br></pre></td></tr></table></figure>
<h4 id="Run-elasticsearch"><a href="#Run-elasticsearch" class="headerlink" title="Run elasticsearch"></a>Run <strong>elasticsearch</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ cd /data/moloch/elasticsearch/bin</span><br><span class="line">$ ./elasticsearch</span><br></pre></td></tr></table></figure>
<h4 id="Initialise-Elasticsearch-Database-on-port-9200-and-add-a-new-user"><a href="#Initialise-Elasticsearch-Database-on-port-9200-and-add-a-new-user" class="headerlink" title="Initialise Elasticsearch Database on port 9200 and add a new user"></a>Initialise Elasticsearch Database on port 9200 and add a new user</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ /data/moloch/db/db.pl http://localhost:9200 init</span><br><span class="line">$ /data/moloch/bin/moloch_add_user.sh admin admin PASSWORDGOESHERE --admin</span><br></pre></td></tr></table></figure>
<h4 id="Install-Capture-on-ubuntu-in-order-to-capture-data"><a href="#Install-Capture-on-ubuntu-in-order-to-capture-data" class="headerlink" title="Install Capture on ubuntu, in order to capture data"></a>Install Capture on ubuntu, in order to capture data</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get install wget curl libpcre3-dev uuid-dev libmagic-dev pkg-config g++ flex bison zlib1g-dev libffi-dev gettext libgeoip-dev make libjson-perl libbz2-dev libwww-perl libpng-dev xz-utils libffi-dev</span><br><span class="line"></span><br><span class="line"># This bash file can be downloaded from Git</span><br><span class="line">$ sudo ./easybutton-build.sh</span><br><span class="line"></span><br><span class="line"># Specify the thirdparty software location (/data/moloch/thirdparty)</span><br><span class="line">$ sudo ./Configure --prefix=/data/moloch --with-libpcap=/data/moloch/thirdparty/libpcap-1.8.1 --with-yara=thirdparty/yara/yara-3.7.1 --with-maxminddb=thirdparty/libmaxminddb-1.3.2 --with-glib2=thirdparty/glib-2.54.3 --with-curl=thirdparty/curl-7.59.0 --with-lua=thirdparty/lua-5.3.4</span><br></pre></td></tr></table></figure>
<h4 id="Start-molochcapture-service-and-molochviewer-service"><a href="#Start-molochcapture-service-and-molochviewer-service" class="headerlink" title="Start molochcapture.service and molochviewer.service"></a>Start <strong>molochcapture.service</strong> and <strong>molochviewer.service</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ systemctl start molochcapture.service molochviewer.service</span><br></pre></td></tr></table></figure>
<h4 id="Access-Moloch"><a href="#Access-Moloch" class="headerlink" title="Access Moloch"></a>Access Moloch</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://#.#.#.#:8005</span><br></pre></td></tr></table></figure>
<h4 id="Optional–xxx-Try-to-Auto-Restart-Moloch-and-Elasticsearch-at-system-boot"><a href="#Optional–xxx-Try-to-Auto-Restart-Moloch-and-Elasticsearch-at-system-boot" class="headerlink" title="[Optional–xxx???] Try to Auto Restart Moloch and Elasticsearch at system-boot"></a>[Optional–xxx???] Try to Auto Restart Moloch and Elasticsearch at system-boot</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ sudo systemctl enable elasticsearch.service</span><br><span class="line">Created symlink from /etc/systemd/system/multi-user.target.wants/elasticsearch.service to /etc/systemd/system/elasticsearch.service.</span><br><span class="line"></span><br><span class="line">$ sudo systemctl enable molochcapture.service</span><br><span class="line">Created symlink from /etc/systemd/system/multi-user.target.wants/molochcapture.service to /etc/systemd/system/molochcapture.service.</span><br><span class="line"></span><br><span class="line">$ sudo systemctl enable molochviewer.service</span><br><span class="line">Created symlink from /etc/systemd/system/multi-user.target.wants/molochviewer.service to /etc/systemd/system/molochviewer.service.</span><br></pre></td></tr></table></figure>
<h4 id="Optional-Delete-all-Elasticsearch-indexes"><a href="#Optional-Delete-all-Elasticsearch-indexes" class="headerlink" title="[Optional] Delete all Elasticsearch indexes"></a>[Optional] Delete all Elasticsearch indexes</h4><p>Note: You need to initialise Moloch database after using this command</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ systemctl stop molochcapture.service molochviewer.service</span><br><span class="line">$ curl -X DELETE &apos;http://localhost:9200/_all&apos;</span><br></pre></td></tr></table></figure>
<h4 id="Optional-Moloch-Raw-Data-Storage-Location"><a href="#Optional-Moloch-Raw-Data-Storage-Location" class="headerlink" title="[Optional] Moloch Raw Data Storage Location"></a>[Optional] Moloch Raw Data Storage Location</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:/data/moloch/raw# ls -l</span><br><span class="line">total 2816</span><br><span class="line">-rw-r----- 1 nobody daemon  262144 Jun  5 19:24 ubuntu-180605-00000007.pcap</span><br><span class="line">-rw-r----- 1 nobody daemon       0 Jun  5 19:22 ubuntu-180605-00000008.pcap</span><br><span class="line">-rw-r----- 1 nobody daemon 1048576 Jun  5 19:47 ubuntu-180605-00000010.pcap</span><br><span class="line">-rw-r----- 1 nobody daemon 1572864 Jun  5 19:50 ubuntu-180605-00000011.pcap</span><br></pre></td></tr></table></figure>
<h4 id="Optional-Moloch-optimization"><a href="#Optional-Moloch-optimization" class="headerlink" title="[Optional] Moloch optimization"></a>[Optional] Moloch optimization</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># Set ring buf size, see max with ethool -g eth0</span><br><span class="line">$ sudo ethtool -G eth0 rx 4096 tx 4096</span><br><span class="line"></span><br><span class="line"># Turn off feature, see available features with ethtool -k eth0</span><br><span class="line">$ sudo ethtool -K eth0 rx off tx off gs off tso off gso off</span><br></pre></td></tr></table></figure>
<h4 id="Optional-Moloch-upgrade"><a href="#Optional-Moloch-upgrade" class="headerlink" title="[Optional] Moloch upgrade"></a>[Optional] Moloch upgrade</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$ wget https://files.molo.ch/builds/ubuntu-16.04/moloch_0.18.2-1_amd64.deb</span><br><span class="line"></span><br><span class="line">$ sudo dpkg -i moloch_0.18.2-1_amd64.deb </span><br><span class="line">(Reading database ... 345537 files and directories currently installed.)</span><br><span class="line">Preparing to unpack moloch_0.18.2-1_amd64.deb ...</span><br><span class="line">Unpacking moloch (0.18.2-1) over (0.17.0-1) ...</span><br><span class="line">Setting up moloch (0.18.2-1) ...</span><br><span class="line">READ /data/moloch/README.txt and RUN /data/moloch/bin/Configure</span><br><span class="line"></span><br><span class="line">$ systemctl stop molochcapture.service</span><br><span class="line">$ systemctl stop molochviewer.service</span><br><span class="line"></span><br><span class="line">$ /data/moloch/db/db.pl http://localhost:9200 upgrade</span><br><span class="line"></span><br><span class="line">$ systemctl start molochcapture.service</span><br><span class="line">$ systemctl start molochviewer.service</span><br></pre></td></tr></table></figure>
<h4 id="Optional-Configure-Rsyslog-Receiver-on-Moloch-Instance"><a href="#Optional-Configure-Rsyslog-Receiver-on-Moloch-Instance" class="headerlink" title="[Optional] Configure Rsyslog Receiver on Moloch Instance"></a>[Optional] Configure Rsyslog Receiver on Moloch Instance</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ sudo nano /etc/rsyslog.conf</span><br><span class="line"></span><br><span class="line"># To enable these modules and servers, uncomment the lines so the file now contains:</span><br><span class="line"></span><br><span class="line"># provides UDP syslog reception</span><br><span class="line">module(load=&quot;imudp&quot;)</span><br><span class="line">input(type=&quot;imudp&quot; port=&quot;514&quot;)</span><br><span class="line"></span><br><span class="line"># provides TCP syslog reception</span><br><span class="line">module(load=&quot;imtcp&quot;)</span><br><span class="line">input(type=&quot;imtcp&quot; port=&quot;514&quot;)</span><br></pre></td></tr></table></figure>
<h4 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Ubuntu Server v16.04+ + Moloch v0.17</span><br><span class="line">http://moloch.3ilson.com/2017/01/moloch-installubuntu-16moloch-v017.html</span><br><span class="line"></span><br><span class="line">moloch 网络流量回溯分析系统</span><br><span class="line">https://paper.seebug.org/427/</span><br></pre></td></tr></table></figure>
<h3 id="Splunk-Receiver-on-Ubuntu"><a href="#Splunk-Receiver-on-Ubuntu" class="headerlink" title="Splunk (Receiver) on Ubuntu"></a>Splunk (Receiver) on Ubuntu</h3><h4 id="Install-Splunk-on-Linux-Machine"><a href="#Install-Splunk-on-Linux-Machine" class="headerlink" title="Install Splunk on Linux Machine"></a>Install Splunk on Linux Machine</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ dpkg -i splunk-7.1.0-2e75b3406c5b-linux-2.6-amd64.deb</span><br></pre></td></tr></table></figure>
<h4 id="Configure-and-run-Splunk"><a href="#Configure-and-run-Splunk" class="headerlink" title="Configure and run Splunk"></a>Configure and run Splunk</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo cp /opt/splunk/etc/system/default/web.conf /opt/splunk/etc/system/local/</span><br><span class="line">$ sudo /opt/splunk/bin/splunk start</span><br></pre></td></tr></table></figure>
<h4 id="Remove-Indexed-Spunk-Eventdata"><a href="#Remove-Indexed-Spunk-Eventdata" class="headerlink" title="Remove Indexed Spunk Eventdata"></a>Remove Indexed Spunk Eventdata</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo /opt/splunk/bin/splunk help clean</span><br><span class="line">$ sudo /opt/splunk/bin/splunk clean eventdata</span><br></pre></td></tr></table></figure>
<h4 id="Access-Splunk-Web-Interface"><a href="#Access-Splunk-Web-Interface" class="headerlink" title="Access Splunk Web Interface"></a>Access Splunk Web Interface</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost:8000</span><br></pre></td></tr></table></figure>
<h3 id="Splunk-Universal-Forwarder-Client-on-RaspberryPi3"><a href="#Splunk-Universal-Forwarder-Client-on-RaspberryPi3" class="headerlink" title="Splunk Universal Forwarder (Client) on RaspberryPi3"></a>Splunk Universal Forwarder (Client) on RaspberryPi3</h3><h4 id="Download-Splunk-Universal-Forwarder"><a href="#Download-Splunk-Universal-Forwarder" class="headerlink" title="Download Splunk Universal Forwarder"></a>Download Splunk Universal Forwarder</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://www.splunk.com/en_us/download/universal-forwarder.html</span><br></pre></td></tr></table></figure>
<h4 id="Configure-a-Client-Name-Set-the-clientName-attribute"><a href="#Configure-a-Client-Name-Set-the-clientName-attribute" class="headerlink" title="Configure a Client Name. Set the clientName attribute"></a>Configure a Client Name. Set the clientName attribute</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ sudo nano  ~/splunkforwarder/etc/system/local/deploymentclient.conf</span><br><span class="line">[target-broker:deploymentServer]</span><br><span class="line">targetUri = 192.168.1.210:8089</span><br><span class="line">clientName = pi3</span><br></pre></td></tr></table></figure>
<h4 id="Open-TCP-Port-9997-in-Splunk-Receiver-No-Need-to-‘Add-Splunk-Forwarder’"><a href="#Open-TCP-Port-9997-in-Splunk-Receiver-No-Need-to-‘Add-Splunk-Forwarder’" class="headerlink" title="Open TCP Port 9997 in Splunk Receiver (No Need to ‘Add Splunk Forwarder’)"></a>Open TCP Port 9997 in Splunk Receiver (No Need to ‘Add Splunk Forwarder’)</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Splunk -&gt; Receive Data -&gt; Forwarding and Receiving -&gt; New Receiving Port</span><br></pre></td></tr></table></figure>
<h4 id="Configure-and-Start-Splunk-Universal-Forwarder"><a href="#Configure-and-Start-Splunk-Universal-Forwarder" class="headerlink" title="Configure and Start Splunk Universal Forwarder"></a>Configure and Start Splunk Universal Forwarder</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">## Splunk Forwarder Auto-Restart</span><br><span class="line"></span><br><span class="line">$ sudo splunkforwarder/bin/splunk enable boot-start</span><br><span class="line"></span><br><span class="line">### This is for the local mamg port 8089</span><br><span class="line">$ sudo splunkforwarder/bin/splunk set deploy-poll 192.168.1.210:8089</span><br><span class="line"></span><br><span class="line">## Specify which system log folder to be monitored.</span><br><span class="line">## For example /var/log</span><br><span class="line"></span><br><span class="line">$ sudo splunkforwarder/bin/splunk add monitor /var/spool/bro/bro/</span><br><span class="line">$ sudo splunkforwarder/bin/splunk add forward-server x.x.x.x:9997</span><br><span class="line"></span><br><span class="line">## Check inputs.conf</span><br><span class="line">[default]</span><br><span class="line">host = raspberrypi3</span><br><span class="line">index = soc</span><br><span class="line">source = /var/spool/bro/bro/</span><br><span class="line"></span><br><span class="line">## Check props.conf</span><br><span class="line">[source::/var/log/suricata/fast.log]</span><br><span class="line">sourcetype = suricata</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## Check deploymentserver.conf</span><br><span class="line">[target-broker:deploymentServer]</span><br><span class="line">targetUri = 192.168.1.210:8089</span><br><span class="line"></span><br><span class="line">## Start Splunk Forwarder</span><br><span class="line">$ sudo splunkforwarder/bin/splunk start</span><br><span class="line"></span><br><span class="line">Splunk&gt; 4TW</span><br><span class="line"></span><br><span class="line">Checking prerequisites...</span><br><span class="line">    Checking mgmt port [8089]: open</span><br><span class="line">        Creating: /home/pi/splunkforwarder/var/lib/splunk</span><br><span class="line">        Creating: /home/pi/splunkforwarder/var/run/splunk/appserver/i18n</span><br><span class="line">        Creating: /home/pi/splunkforwarder/var/run/splunk/appserver/modules/static/css</span><br><span class="line">        Creating: /home/pi/splunkforwarder/var/run/splunk/upload</span><br><span class="line">        Creating: /home/pi/splunkforwarder/var/spool/splunk</span><br><span class="line">        Creating: /home/pi/splunkforwarder/var/spool/dirmoncache</span><br><span class="line">        Creating: /home/pi/splunkforwarder/var/lib/splunk/authDb</span><br><span class="line">        Creating: /home/pi/splunkforwarder/var/lib/splunk/hashDb</span><br><span class="line">New certs have been generated in &apos;/home/pi/splunkforwarder/etc/auth&apos;.</span><br><span class="line">    Checking conf files for problems...</span><br><span class="line">    Done</span><br><span class="line">    Checking default conf files for edits...</span><br><span class="line">    Validating installed files against hashes from &apos;/home/pi/splunkforwarder/splunkforwarder-7.1.1-8f0ead9ec3db-Linux-arm-manifest&apos;</span><br><span class="line">    All installed files intact.</span><br><span class="line">    Done</span><br><span class="line">All preliminary checks passed.</span><br><span class="line"></span><br><span class="line">Starting splunk server daemon (splunkd)...</span><br><span class="line">Done</span><br></pre></td></tr></table></figure>
<h3 id="Access-the-Whole-System-from-Internet"><a href="#Access-the-Whole-System-from-Internet" class="headerlink" title="Access the Whole System from Internet"></a>Access the Whole System from Internet</h3><h4 id="Raspberry-Pi3"><a href="#Raspberry-Pi3" class="headerlink" title="Raspberry Pi3"></a>Raspberry Pi3</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ssh px@xx.xxx.com -p 22000</span><br></pre></td></tr></table></figure>
<h4 id="SELKS"><a href="#SELKS" class="headerlink" title="SELKS"></a>SELKS</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ssh pxxx@xx.xxx.com -p 22020</span><br></pre></td></tr></table></figure>
<p>Enable the remote web access</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ssh -L 4443:localhost:443 pippo@xx.xxx.com -p 22020</span><br></pre></td></tr></table></figure>
<p>Restart services</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ systemctl restart elasticsearch logstash kibana</span><br></pre></td></tr></table></figure>
<h4 id="Mini-Ubuntu-VM-Machine-acting-as-Internal-Client"><a href="#Mini-Ubuntu-VM-Machine-acting-as-Internal-Client" class="headerlink" title="Mini-Ubuntu (VM Machine acting as Internal Client)"></a>Mini-Ubuntu (VM Machine acting as Internal Client)</h4><ul>
<li>IP: 10.0.0.200</li>
<li>Network: 10.0.0.0/24</li>
<li>Gateway: 10.0.0.1</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ssh pxxx@xx.xxx.com -p 22030</span><br></pre></td></tr></table></figure>
<p>Prerequisite on other machines</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">1) Enable the DNAT on Home Router</span><br><span class="line">-- Allow incoming traffic towards port 22030</span><br><span class="line"></span><br><span class="line">2) Enable the DNAT on 192.168.1.220:22030</span><br><span class="line">pxxx@selks:~$ sudo iptables -t nat -A PREROUTING -d 192.168.1.220 -p tcp --dport 22030 -j DNAT --to 10.0.0.200:22</span><br><span class="line"></span><br><span class="line">3) Enable the DNAT on 192.168.1.220:5901</span><br><span class="line">pxxx@selks:~$ sudo iptables -t nat -A PREROUTING -d 192.168.1.220 -p tcp --dport 5901 -j DNAT --to 10.0.0.200:5901</span><br></pre></td></tr></table></figure>
<p>[Optional] VNC Tunnel for encryption purposes</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ssh -L 5901:127.0.0.1:5901 -N -f -l username server_ip_address</span><br></pre></td></tr></table></figure>
<h4 id="Moloch"><a href="#Moloch" class="headerlink" title="Moloch"></a>Moloch</h4><h4 id="Splunk"><a href="#Splunk" class="headerlink" title="Splunk"></a>Splunk</h4>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/05/08/Linux/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Patrick Dong">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Superpb9">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/05/08/Linux/" itemprop="url">All About Linux</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-05-08T14:45:00+12:00">
                2018-05-08
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Security-Incident-Response/" itemprop="url" rel="index">
                    <span itemprop="name">Security Incident Response</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="Network-Configuration"><a href="#Network-Configuration" class="headerlink" title="Network Configuration"></a>Network Configuration</h3><h4 id="Set-static-IP-address"><a href="#Set-static-IP-address" class="headerlink" title="Set static IP address"></a>Set static IP address</h4><p>The primary network interface </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ sudo nano /etc/network/interfaces </span><br><span class="line">auto eth0 </span><br><span class="line">iface eth0 inet static  </span><br><span class="line">address 192.168.1.X</span><br><span class="line">netmask 255.255.255.0</span><br><span class="line">gateway 192.168.1.X</span><br><span class="line">dns-nameservers X.X.X.X</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo ifdown eth0 &amp;&amp; sudo ifup eth0</span><br></pre></td></tr></table></figure>
<h4 id="DNS-nameserver-configuration-Ubuntu-18-04"><a href="#DNS-nameserver-configuration-Ubuntu-18-04" class="headerlink" title="DNS nameserver configuration (Ubuntu 18.04)"></a>DNS nameserver configuration (Ubuntu 18.04)</h4><p><strong>Solution 1</strong></p>
<p>Keep it mind that Ubuntu appends a tail file to the <span style="color:darkblue"><strong>resolv.conf</strong></span> file that it generates. Editing the tail file instead of the actual resolv.conf file will prevent your change from being lost upon a system reboot.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo nano /etc/resolvconf/resolv.conf.d/tail</span><br><span class="line">$ nameserver 8.8.8.8</span><br></pre></td></tr></table></figure>
<p>You will need to activate the change via</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo resolvconf -u</span><br></pre></td></tr></table></figure>
<p><strong>Solution 2</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ sudo nano /etc/resolv.conf</span><br><span class="line"># Generated by resolvconf</span><br><span class="line">nameserver 8.8.8.8</span><br><span class="line">nameserver 8.8.4.4</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo nano /etc/resolv.conf</span><br></pre></td></tr></table></figure>
<h4 id="Dual-NIC-configuration-via-NAT"><a href="#Dual-NIC-configuration-via-NAT" class="headerlink" title="Dual NIC configuration via NAT"></a>Dual NIC configuration via NAT</h4><h5 id="Set-static-IP-address-1"><a href="#Set-static-IP-address-1" class="headerlink" title="Set static IP address"></a>Set static IP address</h5><p>This subnet 192.168.1.0/24 will act as a Internet Facing interface<br>auto ens33</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ sudo nano /etc/network/interfaces</span><br><span class="line">iface ens33 inet static</span><br><span class="line">    address 192.168.1.220</span><br><span class="line">    netmask 255.255.255.0</span><br><span class="line">    network 192.168.1.0</span><br><span class="line">    broadcast 192.168.1.255</span><br><span class="line">    gateway 192.168.1.1</span><br><span class="line">    dns-nameservers 8.8.8.8</span><br></pre></td></tr></table></figure>
<p>This subnet 10.0.0.0/24 will act as a gateway of LAN PCs</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ sudo nano /etc/network/interfaces</span><br><span class="line">auto ens38</span><br><span class="line">iface ens38 inet static</span><br><span class="line">    address 10.0.0.1</span><br><span class="line">    netmask 255.255.255.0</span><br><span class="line">    network 10.0.0.0</span><br><span class="line">    broadcast 10.0.0.255</span><br><span class="line">    dns-nameservers 8.8.8.8</span><br></pre></td></tr></table></figure>
<p>Restart the networking function </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ sudo /etc/init.d/networking restart</span><br><span class="line">``` </span><br><span class="line">Alternatively, you can</span><br><span class="line">``` </span><br><span class="line">$ sudo ifup eth0</span><br><span class="line">$ sudo ifdown eth0</span><br></pre></td></tr></table></figure>
<h5 id="Enable-IP-Forwarding"><a href="#Enable-IP-Forwarding" class="headerlink" title="Enable IP Forwarding"></a>Enable IP Forwarding</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo nano /etc/sysctl.conf</span><br><span class="line">net.ipv4.ip_forward=1</span><br></pre></td></tr></table></figure>
<p>Alternatively, you can<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo echo 1 &gt; /proc/sys/net/ipv4/ip_forward</span><br></pre></td></tr></table></figure></p>
<h5 id="Set-iptable-Rules"><a href="#Set-iptable-Rules" class="headerlink" title="Set iptable Rules"></a>Set iptable Rules</h5><p>Step 1: There’re four rule sets availabe and we will use the first two</p>
<ul>
<li>FILTER (Default)</li>
<li>NAT</li>
<li>MANGLE</li>
<li>RAW</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ sudo iptables -X</span><br><span class="line">$ sudo iptables -F</span><br><span class="line">$ sudo iptables -t nat -X</span><br><span class="line">$ sudo iptables -t nat -F</span><br></pre></td></tr></table></figure>
<p>Step 2: Set accepted destination of forwarding chain</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo iptables -I INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT</span><br><span class="line">$ sudo iptables -I FORWARD -m state --state RELATED,ESTABLISHED -j ACCEPT</span><br></pre></td></tr></table></figure>
<p>Step 3: Enable IP Masquerade</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo iptables -t nat -I POSTROUTING -o ens33 -j MASQUERADE</span><br></pre></td></tr></table></figure>
<p>Alternative Method</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ sudo iptables -F</span><br><span class="line">$ sudo iptables -t nat -F</span><br><span class="line">$ sudo iptables -t mangle -F</span><br><span class="line">$ sudo iptables -P INPUT ACCEPT</span><br><span class="line">$ sudo iptables -P FORWARD ACCEPT</span><br><span class="line">$ sudo iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE</span><br></pre></td></tr></table></figure>
<h4 id="Enable-DNAT"><a href="#Enable-DNAT" class="headerlink" title="Enable DNAT"></a>Enable DNAT</h4><p>External Client via [NIC_1: 192.168.1.220:22030 | NIC_2: 10.0.0.1] –&gt; 10.0.0.200:22</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo iptables -t nat -A PREROUTING -d 192.168.1.220 -p tcp --dport 22030 -j DNAT --to 10.0.0.200:22</span><br></pre></td></tr></table></figure>
<h4 id="Save-iptables-Rules-persistently"><a href="#Save-iptables-Rules-persistently" class="headerlink" title="Save iptables Rules persistently"></a>Save iptables Rules persistently</h4><p>On Ubuntu, the easiest way to save iptables rules, so they will survive a reboot, is to use the iptables-persistent package. Install it with apt-get like this:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get install iptables-persistent</span><br></pre></td></tr></table></figure>
<p>During the installation, you will asked if you want to save your current firewall rules. If you update your firewall rules and want to save the changes, run this command:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo netfilter-persistent save</span><br></pre></td></tr></table></figure>
<p>On versions of Ubuntu prior to 16.04, run this command instead:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo invoke-rc.d iptables-persistent save</span><br></pre></td></tr></table></figure>
<h4 id="SSH-without-using-password"><a href="#SSH-without-using-password" class="headerlink" title="SSH without using password"></a>SSH without using password</h4><h5 id="Step-1-Generate-a-public-private-key-pair-using-ssh-kengen"><a href="#Step-1-Generate-a-public-private-key-pair-using-ssh-kengen" class="headerlink" title="Step 1: Generate a public/private key pair using ssh-kengen"></a>Step 1: Generate a public/private key pair using ssh-kengen</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ ssh-keygen</span><br><span class="line">Generating public/private rsa key pair.</span><br><span class="line">... ...</span><br></pre></td></tr></table></figure>
<h5 id="Step-2-Copy-the-key-to-the-destination-server"><a href="#Step-2-Copy-the-key-to-the-destination-server" class="headerlink" title="Step 2: Copy the key to the destination server"></a>Step 2: Copy the key to the destination server</h5><p>ssh-copy-id 命令可以把本地主机的公钥复制到远程主机的authorized_keys文件上</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">$ ssh-copy-id server01</span><br><span class="line">/usr/bin/ssh-copy-id: INFO: Source of key(s) to be installed: &quot;/home/vagrant/.ssh/id_rsa.pub&quot;</span><br><span class="line">The authenticity of host &apos;server01 (10.9.8.11)&apos; can&apos;t be established.</span><br><span class="line">ECDSA key fingerprint is SHA256:Fi4FisVgFyEkos9NgKz0q+zzZwe3+xhCHWGrXL+jZck.</span><br><span class="line">ECDSA key fingerprint is MD5:b6:04:55:d7:db:3c:a8:a1:b6:f6:15:1f:be:7e:48:41.</span><br><span class="line">Are you sure you want to continue connecting (yes/no)? yes</span><br><span class="line">/usr/bin/ssh-copy-id: INFO: attempting to log in with the new key(s), to filter out any that are already installed</span><br><span class="line">/usr/bin/ssh-copy-id: INFO: 1 key(s) remain to be installed -- if you are prompted now it is to install the new keys</span><br><span class="line">vagrant@server01&apos;s password:</span><br><span class="line"></span><br><span class="line">Number of key(s) added: 1</span><br><span class="line"></span><br><span class="line">Now try logging into the machine, with:   &quot;ssh &apos;server01&apos;&quot;</span><br><span class="line">and check to make sure that only the key(s) you wanted were added.</span><br><span class="line"></span><br><span class="line">[vagrant@admin01 ~]$ ssh server01</span><br><span class="line">[vagrant@server01 ~]$ exit</span><br></pre></td></tr></table></figure>
<h5 id="Easy-for-system-admin-to-manage-various-servers"><a href="#Easy-for-system-admin-to-manage-various-servers" class="headerlink" title="Easy for system admin to manage various servers"></a>Easy for system admin to manage various servers</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ for SERVER in $(cat server)</span><br><span class="line">&gt; do</span><br><span class="line">&gt;   ssh $&#123;SERVER&#125; hostname</span><br><span class="line">&gt;   ssh $&#123;SERVER&#125; uptime</span><br><span class="line">&gt; done</span><br><span class="line">server01</span><br><span class="line"> 03:29:44 up 26 min,  0 users,  load average: 0.00, 0.01, 0.05</span><br><span class="line">server02</span><br><span class="line"> 03:29:44 up 25 min,  0 users,  load average: 0.00, 0.01, 0.04</span><br></pre></td></tr></table></figure>
<p>One time command running with SSH<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ ssh server01 &apos;hostname ; hostname&apos;</span><br><span class="line">server01</span><br><span class="line">server01</span><br></pre></td></tr></table></figure></p>
<p>Remote system health checking with SSH<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ ssh server01 &quot;ps -ef | head -3&quot;</span><br><span class="line">UID        PID  PPID  C STIME TTY          TIME CMD</span><br><span class="line">root         1     0  0 03:03 ?        00:00:00 /usr/lib/systemd/systemd --switched-root --system --deserialize 21</span><br><span class="line">root         2     0  0 03:03 ?        00:00:00 [kthreadd]</span><br></pre></td></tr></table></figure></p>
<h3 id="System-Running"><a href="#System-Running" class="headerlink" title="System Running"></a>System Running</h3><h4 id="Start-a-service-when-booting-system"><a href="#Start-a-service-when-booting-system" class="headerlink" title="Start a service when booting system"></a>Start a service when booting system</h4><p>For ubuntu 16.04 and above, creat a service file named <span style="color:darkblue"><strong>startup.service</strong></span></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ sudo nano /etc/systemd/system/startup.service</span><br><span class="line">[Unit]</span><br><span class="line">Description=Startup Applications</span><br><span class="line">[Service]</span><br><span class="line">Type=oneshot</span><br><span class="line">RemainAfterExit=false</span><br><span class="line">ExecStart=/etc/rc.local start</span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure>
<p>Create a <span style="color:darkblue"><strong>rc.local</strong></span> file</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ cd /etc</span><br><span class="line">$ sudo touch rc.local</span><br></pre></td></tr></table></figure>
<p>For example, auto-start IP Masquerade service for NAT</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/sh</span><br><span class="line">iptables -t nat -I POSTROUTING -o ens33 -j MASQUERADE</span><br><span class="line">exit 0</span><br></pre></td></tr></table></figure>
<p>To make it executable</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo chmod +x /etc/rc.local</span><br></pre></td></tr></table></figure>
<p>Then go back to <span style="color:darkblue"><strong>/etc/systemd/system</strong></span></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sudo systemctl enable startup</span><br><span class="line">$ sudo systemctl start startup</span><br><span class="line">$ sudo systemctl status startup</span><br></pre></td></tr></table></figure>
<h4 id="System-runnig-process-and-port-number"><a href="#System-runnig-process-and-port-number" class="headerlink" title="System runnig process and port number"></a>System runnig process and port number</h4><p>To find which port the system is listening</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ netstat -a</span><br></pre></td></tr></table></figure>
<p>To find a process number associated with port 12345 on TCP</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ fuser 12345/tcp</span><br><span class="line">12345/tcp:  490</span><br></pre></td></tr></table></figure>
<p>Next, to find what (service/program) that particular process number is runnning</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ ps -ef | grep 490</span><br><span class="line">root    490   483  0 Sep19 ? 00:02:17 /usr/local/bin/license_manager</span><br></pre></td></tr></table></figure>
<p>Kill a running port</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sudo netstat -lpn | grep 4000</span><br><span class="line">$ sudo fuser -k 4000/tcp</span><br><span class="line">$ sudo kill -9 PID</span><br></pre></td></tr></table></figure>
<p>[LINUX] Other commands to display programs associated with ports</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">## To find the process ID associated with the service listening on port 901</span><br><span class="line">$ lsof -i TCP:901</span><br><span class="line">COMMAND PID USER   FD   TYPE DEVICE SIZE NODE NAME</span><br><span class="line">inetd   387 root   9u   IPv4 369    TCP *:swat (LISTEN)</span><br></pre></td></tr></table></figure>
<p>[WINDOWS] </p>
<p>A Windows tool known as fport (available with a tool search on <a href="http://www.securityfocus.com" target="_blank" rel="noopener">www.securityfocus.com</a>) can<br>be used to associate processes with ports on which they run.</p>
<h3 id="File-System"><a href="#File-System" class="headerlink" title="File System"></a>File System</h3><h4 id="Using-‘df’-command"><a href="#Using-‘df’-command" class="headerlink" title="Using ‘df’ command"></a>Using ‘df’ command</h4><p>Show information about the linux file system on which each FILE resides,<br>or all file systems by default.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ df -h</span><br><span class="line">Filesystem      Size  Used Avail Use% Mounted on</span><br><span class="line">/dev/root        30G  7.4G   21G  27% /</span><br><span class="line">devtmpfs        460M     0  460M   0% /dev</span><br><span class="line">tmpfs           464M     0  464M   0% /dev/shm</span><br><span class="line">tmpfs           464M   19M  446M   4% /run</span><br><span class="line">tmpfs           5.0M  4.0K  5.0M   1% /run/lock</span><br><span class="line">tmpfs           464M     0  464M   0% /sys/fs/cgroup</span><br><span class="line">/dev/mmcblk0p1   41M   21M   21M  51% /boot</span><br><span class="line">tmpfs            93M     0   93M   0% /run/user/1000</span><br></pre></td></tr></table></figure>
<h4 id="Using-‘du’-command"><a href="#Using-‘du’-command" class="headerlink" title="Using ‘du’ command"></a>Using ‘du’ command</h4><p>Summarize disk usage of the set of FILEs, recursively for directories.</p>
<p>Size of a file:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ du -h xxx</span><br></pre></td></tr></table></figure>
<p>Size of a directory (recursively):</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ du -h /tmp</span><br></pre></td></tr></table></figure>
<h3 id="Cron-Jobs"><a href="#Cron-Jobs" class="headerlink" title="Cron Jobs"></a>Cron Jobs</h3><h4 id="Cron-Job-Types"><a href="#Cron-Job-Types" class="headerlink" title="Cron Job Types"></a>Cron Job Types</h4><ul>
<li>You should use <span style="color:darkblue"><strong>crontab -e</strong></span> to edit user crontabs (including root’s);</li>
<li>User crontabs don’t have a user field, but the system crontabs do.</li>
</ul>
<p><strong>User</strong> cron jobs (e.g. root) are located in <span style="color:darkblue"><strong>/var/spool/cron/crontabs</strong></span></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ cat /var/spool/cron/crontabs/xx(root)</span><br><span class="line">... ...</span><br><span class="line"># m h  dom mon dow   command</span><br><span class="line">*/5 * * * * broctl cron</span><br><span class="line">59 23 * * * rm -rf /nsm/bro/logs/20??-*-*</span><br><span class="line">59 23 * * * rm -rf /nsm/bro/extracted/</span><br><span class="line">... ...</span><br></pre></td></tr></table></figure>
<p>We can use crontab to modify the file<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo crontab -e</span><br></pre></td></tr></table></figure></p>
<p><strong>System-wide</strong> Cron Directory (there’s a ‘user’ field in the file) <span style="color:darkblue"><strong>/etc/crontab</strong></span></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ sudo cat /etc/crontab</span><br><span class="line">... ...</span><br><span class="line"># m h dom mon dow user  command</span><br><span class="line">*/5 * * * * root /nsm/scripts/cleanup</span><br><span class="line">30 * * * *  root /nsm/scripts/update</span><br><span class="line">... ...</span><br></pre></td></tr></table></figure>
<h3 id="Bash-Shell"><a href="#Bash-Shell" class="headerlink" title="Bash Shell"></a>Bash Shell</h3><h4 id="Shelll-variables-useful-commands"><a href="#Shelll-variables-useful-commands" class="headerlink" title="Shelll variables, useful commands"></a>Shelll variables, useful commands</h4><p>Bash Shell Built-in Variables<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$&#123;0&#125; -&gt; Display the command just executed</span><br><span class="line">$&#123;#&#125; -&gt; Total number of positional parameters</span><br><span class="line">$ echo &quot;Parameter 1: $&#123;1&#125;&quot;</span><br><span class="line">$ echo &quot;Parameter 2: $&#123;2&#125;&quot;</span><br><span class="line">$ echo &quot;Parameter 3: $&#123;3&#125;&quot;</span><br><span class="line">$&#123;?&#125; -&gt; The return/exit number of last execution</span><br><span class="line">$&#123;@&#125; -&gt; Using in FOR LOOP to represent all the arguments one by one | When used in quotes: &quot;$1&quot; &quot;$2&quot;...</span><br><span class="line">$&#123;*&#125; -&gt; Represent the arguments as a whole $&#123;1&#125; | When used in quotes: &quot;$1 $2...&quot;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ echo $&#123;UID&#125;</span><br><span class="line">501</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ echo $&#123;RANDOM&#125;</span><br><span class="line">15718</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ echo $&#123;HOST&#125;</span><br><span class="line">MBP2017.local</span><br></pre></td></tr></table></figure>
<p>Command <strong>which</strong> shows the full path of (shell) commands.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ which head</span><br><span class="line">/usr/bin/head</span><br></pre></td></tr></table></figure>
<p>Command <strong>locate</strong> (N.B. need to run <strong>$ sudo updatedb</strong> to reflect the current searching list)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">system admin command —&gt; /usr/sbin/*</span><br><span class="line">normal command —&gt; /usr/sbin/*</span><br></pre></td></tr></table></figure></p>
<p>Command <strong>find</strong> with <strong>/dev/null</strong> to ignore any “find: <strong>‘xxx’: Permission denied”</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ find /usr/sbin/ -name userdel</span><br><span class="line">/usr/sbin/userdel</span><br><span class="line"></span><br><span class="line">$ find / -name userdel 2&gt; /dev/null</span><br><span class="line">/usr/sbin/userdel</span><br><span class="line">/usr/share/bash-completion/completions/userdel</span><br></pre></td></tr></table></figure></p>
<p>Command <strong>basename</strong> returns the file without directory path<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ basename /vagrant/luser-demo06.sh</span><br><span class="line">$ luser-demo06.sh</span><br></pre></td></tr></table></figure></p>
<p>Command <strong>dirname</strong> returns the directory path without file name<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ dirname /vagrant/luser-demo06.sh</span><br><span class="line">$ /vagrant</span><br></pre></td></tr></table></figure></p>
<p>Command <strong>let</strong> can be used as double parentheses such as <strong>NUM=$(( NUM += 5 ))</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ let NUM=&apos;2 + 3&apos;</span><br><span class="line">$ echo $&#123;NUM&#125;</span><br><span class="line">5</span><br></pre></td></tr></table></figure>
<p>Command <strong>expr</strong> can be used as a calculator (with white space)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ expr 1 + 1</span><br><span class="line">2</span><br><span class="line">$ expr 5 * 2</span><br><span class="line">10</span><br></pre></td></tr></table></figure>
<h4 id="The-if-statement-for-loop-while-loop-and-getops"><a href="#The-if-statement-for-loop-while-loop-and-getops" class="headerlink" title="The if statement, for loop, while loop and getops"></a>The if statement, for loop, while loop and getops</h4><p>‘if’ statement<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">if [[ COMMANDS ]]</span><br><span class="line">then</span><br><span class="line">  COMMANDS</span><br><span class="line">else</span><br><span class="line">COMMANDS</span><br><span class="line">fi</span><br></pre></td></tr></table></figure></p>
<p>‘for’ loop<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">for VARIABLE in LIST</span><br><span class="line">do</span><br><span class="line">  COMMANDS</span><br><span class="line">done</span><br></pre></td></tr></table></figure></p>
<p>‘while’ loop<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">while [[ COMMANDS ]]</span><br><span class="line">do</span><br><span class="line">  COMMANDS</span><br><span class="line">done</span><br></pre></td></tr></table></figure></p>
<p>‘getopts’ with while<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">while getopts vl:s OPTION</span><br><span class="line">do</span><br><span class="line">  case $&#123;OPTION&#125; in</span><br><span class="line">     v) … ;;</span><br><span class="line">     l) … ;;</span><br><span class="line">     s) … ;;</span><br><span class="line">     ?)</span><br><span class="line">        usage</span><br><span class="line">        ;;</span><br><span class="line">  esac</span><br><span class="line">done</span><br></pre></td></tr></table></figure></p>
<h4 id="Program-exit-statues"><a href="#Program-exit-statues" class="headerlink" title="Program exit statues"></a>Program exit statues</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">0 = true / successful</span><br><span class="line">1 = false / unsuccessful</span><br></pre></td></tr></table></figure>
<p>Any non-zero exit status represents a failure.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">exit 1</span><br><span class="line">echo $&#123;?&#125; # You can also use $?</span><br></pre></td></tr></table></figure></p>
<h4 id="I-O-Redirection-Pipes"><a href="#I-O-Redirection-Pipes" class="headerlink" title="I/O Redirection - Pipes"></a>I/O Redirection - Pipes</h4><p>File Descriptor<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">FD 0 - STDIN</span><br><span class="line">FD 1 - STDOUT</span><br><span class="line">FD 2 - STDERR</span><br></pre></td></tr></table></figure></p>
<p>File (Command) I/O Redirection<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">COMMAND &gt; /path/to/file</span><br><span class="line">COMMAND &gt;&gt; /path/to/file</span><br><span class="line">COMMAND &lt; /path/to/file</span><br><span class="line">COMMAND 2&gt; /path/to/file</span><br><span class="line">COMMAND &amp;&gt; /path/to/file</span><br><span class="line"></span><br><span class="line">COMMAND |&amp; COMMAND</span><br><span class="line">COMMAND &gt;&amp;2</span><br><span class="line">COMMAND &gt; /dev/null</span><br></pre></td></tr></table></figure></p>
<p>Sending STDOUT as STDIN<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo $&#123;PWORD&#125; | passwd --stdin $&#123;NAME&#125;</span><br></pre></td></tr></table></figure></p>
<p>String manipulation &amp; data munging with pipes<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &apos;!@#$%^&apos; | fold -w1 | shuf | head -c1</span><br></pre></td></tr></table></figure></p>
<p>In a pipe, the standard input (&gt;) comes from the output of command<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ echo &quot;secret&quot; &gt; my_passwd_in_file</span><br></pre></td></tr></table></figure></p>
<p>With the help of less-than-simple (&lt;), the standard input comes from a file<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo passwd --stdin einstein &lt; my_passwd_in_file</span><br></pre></td></tr></table></figure></p>
<p>You cannot echo a <strong>FILE</strong> but you can echo a <strong>VARIABLE</strong> such as <strong>${FILE}</strong> acting as a file name<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">FILE=&quot;/tmp/data&quot;</span><br><span class="line">head -n3 /etc/passwd &gt; $&#123;FILE&#125;</span><br><span class="line">echo &quot;The file name (path) $&#123;FILE&#125; has the content of:&quot;</span><br><span class="line">cat $&#123;FILE&#125;</span><br></pre></td></tr></table></figure></p>
<p>Examples</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ read X &lt; /etc/centos-release</span><br><span class="line">$ echo $&#123;X&#125;</span><br><span class="line">CentOS Linux release 7.4.1708 (Core)</span><br><span class="line"></span><br><span class="line">$ read X 0&lt; /etc/centos-release</span><br><span class="line">$ echo $&#123;X&#125;</span><br><span class="line">CentOS Linux release 7.4.1708 (Core)</span><br></pre></td></tr></table></figure>
<p>Using <strong>2&gt;&amp;1</strong> to redirect the <strong>stderr</strong> to the front <strong>stdout</strong> (2&gt;&amp;1), which is <strong>stdboth</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[New Method] $ head -n1 /etc/passwd /etc/hosts /nofilelol &amp;&gt; stdboth</span><br><span class="line">[Old Method] $ head -n1 /etc/passwd /etc/hosts /nofilelol 1&gt; stdboth 2&gt;&amp;1 (&amp;1 stands for stdout put)</span><br></pre></td></tr></table></figure></p>
<p>Using cat to show <strong>stdout</strong> and <strong>stderr</strong> … <strong>Please note</strong> stderr <strong>does not</strong> float to the pipe … only stdout …<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ head -n1 /etc/passwd /etc/hosts /nofilelol 2&gt;&amp;1 | cat -n</span><br><span class="line">$ head -n1 /etc/passwd /etc/hosts /nofilelol |&amp; cat -n</span><br></pre></td></tr></table></figure></p>
<p>Send output to stderr<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;This is STDERR!&quot; 1&gt;&amp;2</span><br></pre></td></tr></table></figure></p>
<p>To throw whatever to that you don’t want to see using <strong>/dev/null</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ head -n1 /etc/passwd /etc/hosts /nofilelol 2&gt; /dev/null </span><br><span class="line">(so that we don&apos;t see any error messages)</span><br></pre></td></tr></table></figure></p>
<h4 id="File-Editing-grep-cut-awk-sort-wc-tww"><a href="#File-Editing-grep-cut-awk-sort-wc-tww" class="headerlink" title="File Editing (grep, cut, awk, sort, wc, tww)"></a>File Editing (grep, cut, awk, sort, wc, tww)</h4><h5 id="Using-“echo-e”-along-with-“cut”-command"><a href="#Using-“echo-e”-along-with-“cut”-command" class="headerlink" title="Using “echo -e” along with “cut” command"></a>Using “echo -e” along with “cut” command</h5><p>Option “-e” enable interpretation of backslash escapes.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># For example, the &quot;\t&quot; stands for horizontal tab</span><br><span class="line">$ echo -e &quot;one\ttwo\tthree&quot; | cut -f 1</span><br><span class="line">one</span><br><span class="line">$ echo -e &quot;one\ttwo\tthree&quot; | cut -f 2</span><br><span class="line">two</span><br><span class="line">$ echo -e &quot;one\ttwo\tthree&quot; | cut -f 3</span><br><span class="line">three</span><br></pre></td></tr></table></figure>
<h5 id="The-“grep”-command-with-“Reg”"><a href="#The-“grep”-command-with-“Reg”" class="headerlink" title="The “grep” command with “Reg”"></a>The “grep” command with “Reg”</h5><p>Match every line which starts with ‘first’<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ grep &apos;^first&apos; /etc/passwd</span><br></pre></td></tr></table></figure></p>
<p>Match every line which ends with ‘bash’<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ grep &apos;bash$&apos; /etc/passwd</span><br></pre></td></tr></table></figure></p>
<p>Match every line which starts with ‘first’ and ends with ‘end’<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ cat /etc/passwd | grep &apos;^test&apos; | grep &apos;bash$&apos;</span><br></pre></td></tr></table></figure></p>
<p>Use ‘-v’ option to inverse the match result (unmatch the reg below)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ grep -Ev &apos;^root|bash$&apos; /etc/passwd</span><br></pre></td></tr></table></figure></p>
<h5 id="The-“cut”-command"><a href="#The-“cut”-command" class="headerlink" title="The “cut” command"></a>The “cut” command</h5><p>Change the delimiter from ‘:’ to ‘,’<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ cut -d &apos;:&apos; -f 1,2 --output-delimiter=&apos;,&apos; /etc/passwd</span><br><span class="line">root,x</span><br><span class="line">bin,x</span><br><span class="line">... ...</span><br></pre></td></tr></table></figure></p>
<h5 id="The-“awk”-command"><a href="#The-“awk”-command" class="headerlink" title="The “awk” command"></a>The “awk” command</h5><p><strong>Scenario 1</strong> - When we need more than one character as a delimiter</p>
<p>[Example 1] Using <strong>‘/home’</strong> as a delimiter<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ cat /etc/passwd | grep &apos;^test0&apos; | grep &apos;bash$&apos;</span><br><span class="line">test01:x:1027:1028::/home/test01:/bin/bash</span><br><span class="line">test02:x:1028:1029::/home/test02:/bin/bash</span><br><span class="line">$ cat /etc/passwd | grep &apos;^test0&apos; | grep &apos;bash$&apos; | awk -F &apos;/home&apos; &apos;&#123;print $1&#125;&apos;</span><br><span class="line">test01:x:1027:1028::</span><br><span class="line">test02:x:1028:1029::</span><br><span class="line">$ cat /etc/passwd | grep &apos;^test0&apos; | grep &apos;bash$&apos; | awk -F &apos;/home&apos; &apos;&#123;print $2&#125;&apos;</span><br><span class="line">/test01:/bin/bash</span><br><span class="line">/test02:/bin/bash</span><br></pre></td></tr></table></figure></p>
<p>[Example 2] See the differece between <strong>‘cut’</strong> and <strong>‘awk’</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ cut -d &apos;:&apos; -f 1,3 /etc/passwd</span><br><span class="line">root:0</span><br><span class="line">$ awk -F &apos;:&apos; &apos;&#123;print $1, $3&#125;&apos; /etc/passwd</span><br><span class="line">root 0</span><br></pre></td></tr></table></figure></p>
<p>[Example 3] Modify the <strong>delimiter</strong> between <strong>$1</strong> and <strong>$3</strong> flexibly<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ awk -F &apos;:&apos; -v OFS=‘_#_’ &apos;&#123;print $1, $3&#125;&apos; /etc/passwd</span><br><span class="line">root_#_0</span><br><span class="line">$ awk -F &apos;:&apos; &apos;&#123;print $1 &quot;_#_&quot; $3&#125;&apos; /etc/passwd</span><br><span class="line">root_#_0</span><br><span class="line">$ awk -F &apos;:&apos; &apos;&#123;print &quot; NAME:&quot; $1 &quot; UID:&quot; $3&#125;&apos; /etc/passwd</span><br><span class="line">NAME:root UID:0</span><br><span class="line">$ awk -F &apos;:&apos; &apos;&#123;print &quot;UID:&quot; $3 &quot; NAME:&quot; $1&#125;&apos; /etc/passwd</span><br><span class="line">UID:0 NAME:root</span><br></pre></td></tr></table></figure></p>
<p>[Example 4] Print the last field using <strong>$NF</strong>, along with math within <strong>parentheses</strong> ()<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ awk -F &apos;:&apos; &apos;&#123;print $NF&#125;&apos; /etc/passwd</span><br><span class="line">/bin/bash</span><br><span class="line">$ awk -F &apos;:&apos; &apos;&#123;print &quot;Shell: &quot; $NF&#125;&apos; /etc/passwd</span><br><span class="line">Shell: /bin/bash</span><br><span class="line">$ awk -F &apos;:&apos; &apos;&#123;print $(NF-1)&#125;&apos; /etc/passwd</span><br><span class="line">/root</span><br></pre></td></tr></table></figure></p>
<p><strong>Scenario 2</strong> - Consider non-white space characters to be a field by default, so we can use ‘awk’ to easily seperate file via white space </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">$ echo &apos;L1      L2&apos; &gt; lines</span><br><span class="line">$ echo &apos;L3 L4&apos; &gt;&gt; lines</span><br><span class="line">$ echo &apos;L5   L6&apos; &gt;&gt; lines</span><br><span class="line">$ echo &apos;L7  L8&apos; &gt;&gt; lines</span><br><span class="line">$ cat lines</span><br><span class="line">L1      L2</span><br><span class="line">L3 L4</span><br><span class="line">L5   L6</span><br><span class="line">L7  L8</span><br><span class="line">$ awk &apos;&#123;print $1 $2&#125;&apos; lines</span><br><span class="line">L1L2</span><br><span class="line">L3L4</span><br><span class="line">L5L6</span><br><span class="line">L7L8</span><br><span class="line">$ awk &apos;&#123;print $1, $2&#125;&apos; lines</span><br><span class="line">L1 L2</span><br><span class="line">L3 L4</span><br><span class="line">L5 L6</span><br><span class="line">L7 L8</span><br></pre></td></tr></table></figure>
<h5 id="The-“sort”-command-with-–field-separator-SEP-and-–key-KEYDEF"><a href="#The-“sort”-command-with-–field-separator-SEP-and-–key-KEYDEF" class="headerlink" title="The “sort” command with –field-separator=SEP and –key=KEYDEF"></a>The “sort” command with –field-separator=SEP and –key=KEYDEF</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"># [option -t, --field-separator=SEP] use SEP instead of non-blank to blank transition</span><br><span class="line"># [option -k, --key=KEYDEF] sort via a key; KEYDEF gives location and type</span><br><span class="line"># [option -n, --numeric-sort] compare according to string numerical value</span><br><span class="line"># [option -r, --reverse] reverse the result of comparisons</span><br><span class="line"></span><br><span class="line"># For example, file &quot;/etc/passwd&quot; is sorted by the third numeric filed, which is &quot;0&quot;, &quot;1&quot;, &quot;2&quot;, etc.</span><br><span class="line">$ cat /etc/passwd | sort -t &apos;:&apos; -k 3 -n</span><br><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line">bin:x:1:1:bin:/bin:/sbin/nologin</span><br><span class="line">daemon:x:2:2:daemon:/sbin:/sbin/nologin</span><br><span class="line"></span><br><span class="line">$ zcat access.log.9.gz | cut -d &apos;&quot;&apos; -f 2 | cut -d &apos; &apos; -f 2 | sort | uniq -c | sort -r | head -3</span><br><span class="line">    171 /cgi-bin/soctools/http.css</span><br><span class="line">    131 /cgi-bin/soctools/http_get.html</span><br><span class="line">     32 /cgi-bin/soctools/http.py?domain=ss&amp;ip=122.122.12.111&amp;sid=1&amp;google=1</span><br></pre></td></tr></table></figure>
<h5 id="The-“sort”-with-“du”command"><a href="#The-“sort”-with-“du”command" class="headerlink" title="The “sort” with “du”command"></a>The “sort” with “du”command</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># [option -h] </span><br><span class="line"># --human-numeric-sort</span><br><span class="line"></span><br><span class="line">$ sudo du -h /var | sort -h | tail -5</span><br><span class="line">63M	/var/cache/yum/x86_64/7</span><br><span class="line">64M	/var/cache</span><br><span class="line">98M	/var/lib/rpm</span><br><span class="line">106M	/var/lib</span><br><span class="line">171M	/var</span><br></pre></td></tr></table></figure>
<h5 id="The-“sort”-with-‘uniq’-command"><a href="#The-“sort”-with-‘uniq’-command" class="headerlink" title="The “sort” with ‘uniq’ command"></a>The “sort” with ‘uniq’ command</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"># [option -u] </span><br><span class="line"># -- to be unique</span><br><span class="line"></span><br><span class="line">$ netstat -nutl | grep &apos;:&apos; | awk &apos;&#123;print $4&#125;&apos; | awk -F &apos;:&apos; &apos;&#123;print $NF&#125;&apos; | sort -n</span><br><span class="line">22</span><br><span class="line">22</span><br><span class="line">25</span><br><span class="line">25</span><br><span class="line">68</span><br><span class="line">323</span><br><span class="line">323</span><br><span class="line">28010</span><br><span class="line">38207</span><br><span class="line">$ netstat -nutl | grep &apos;:&apos; | awk &apos;&#123;print $4&#125;&apos; | awk -F &apos;:&apos; &apos;&#123;print $NF&#125;&apos; | sort -n | uniq -c</span><br><span class="line">2 22</span><br><span class="line">2 25</span><br><span class="line">1 68</span><br><span class="line">2 323</span><br><span class="line">1 28010</span><br><span class="line">1 38207</span><br><span class="line"></span><br><span class="line">$ sudo cat /var/log/messages | awk &apos;&#123;print $5&#125;&apos; | sort | uniq -c | sort -n</span><br><span class="line">      1 polkitd[609]:</span><br><span class="line">      1 polkitd[612]:</span><br><span class="line">      1 sm-notify[905]:</span><br><span class="line">      1 systemd-journald[93]:</span><br><span class="line">      1 systemd-journald[95]:</span><br><span class="line">      1 systemd-journald[96]:</span><br><span class="line">      3 dhclient[1149]:</span><br><span class="line">      3 dhclient[696]:</span><br><span class="line">... ...</span><br><span class="line">     58 NetworkManager[610]:</span><br><span class="line">     58 NetworkManager[615]:</span><br><span class="line">    105 systemd[1]:</span><br><span class="line">    791 systemd:</span><br><span class="line">   1125 kernel:</span><br></pre></td></tr></table></figure>
<h5 id="The-“wc”-command"><a href="#The-“wc”-command" class="headerlink" title="The “wc” command"></a>The “wc” command</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ wc /etc/passwd</span><br><span class="line">53  84  2634 /etc/passwd</span><br><span class="line">$ wc -l /etc/passwd</span><br><span class="line">53 /etc/passwd</span><br><span class="line">$ wc -w /etc/passwd</span><br><span class="line">84 /etc/passwd</span><br><span class="line">$ wc -c /etc/passwd</span><br><span class="line">2634 /etc/passwd</span><br><span class="line"></span><br><span class="line">$ grep test0 /etc/passwd</span><br><span class="line">test01:x:1027:1028::/home/test01:/bin/bash</span><br><span class="line">test02:x:1028:1029::/home/test02:/bin/bash</span><br><span class="line">$ grep test0 /etc/passwd | wc -l</span><br><span class="line">2</span><br></pre></td></tr></table></figure>
<h5 id="The-“tee”-command"><a href="#The-“tee”-command" class="headerlink" title="The “tee” command"></a>The “tee” command</h5><p>Sometimes we can use <strong>’tee’</strong> command to add a hostname in /etc/host <strong>when privilege is a concern</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ echo &apos;10.9.8.11 server01&apos; | sudo tee -a /etc/hosts</span><br><span class="line">10.9.8.11 server01</span><br><span class="line">$ cat /etc/hosts</span><br><span class="line">127.0.0.1	admin01	admin01</span><br><span class="line">127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4</span><br><span class="line">::1         localhost localhost.localdomain localhost6 localhost6.localdomain6</span><br><span class="line">10.9.8.11 server01</span><br><span class="line">`</span><br></pre></td></tr></table></figure>
<p>Because the comand <strong>echo</strong>is not allowed due to priviledge issue<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo echo test &gt;&gt; /etc/hsots</span><br><span class="line">-bash: /etc/hsots: Permission denied</span><br></pre></td></tr></table></figure></p>
<h3 id="VIM-Cheatsheet"><a href="#VIM-Cheatsheet" class="headerlink" title="VIM Cheatsheet"></a>VIM Cheatsheet</h3><h4 id="Cursor-movement"><a href="#Cursor-movement" class="headerlink" title="Cursor movement"></a>Cursor movement</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">:set nu	        # Display Line Numbers</span><br><span class="line">gg (or 1G)      # Move the cursor to the first line of the document</span><br><span class="line">G (Shift + g)   # Move the cursor to the last line of the document</span><br><span class="line">58G				# Move the cursor to Line 58</span><br><span class="line">40-&gt;			# Move the cursor right 40 characters</span><br><span class="line">^ (Shift + 6)   # jump to the first non-blank character of the line</span><br><span class="line">$ (Shift + 4)   # Quickly move the cursor the the last bit of one line</span><br><span class="line">Control + g     # Show the total lines and the current position using percentage</span><br><span class="line">Ctrl + b        # move back one full screen</span><br><span class="line">Ctrl + f        # move forward one full screen</span><br><span class="line">Ctrl + d        # move forward 1/2 a screen</span><br><span class="line">Ctrl + u        # move back 1/2 a screen</span><br></pre></td></tr></table></figure>
<h4 id="Editing"><a href="#Editing" class="headerlink" title="Editing"></a>Editing</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">u               # undo</span><br><span class="line">Ctrl + r        # redo</span><br><span class="line">. 				# repeat</span><br></pre></td></tr></table></figure>
<h4 id="Copy-and-paste"><a href="#Copy-and-paste" class="headerlink" title="Copy and paste"></a>Copy and paste</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">yy              # yank (copy) a line</span><br><span class="line">Nyy -&gt; p        # Copy multiple lines and paste all of them</span><br><span class="line">yw              # yank (copy) the characters of the word from the cursor position to the next start</span><br><span class="line">y$              # yank (copy) to end of line</span><br><span class="line">p               # put (paste) the clipboard after cursor</span><br><span class="line">P               # put (paste) before cursor</span><br><span class="line">dd              # delete (cut) a line</span><br><span class="line">2dd             # delete (cut) 2 lines</span><br><span class="line">dw              # delete (cut) the characters of the word from the cursor position to next start</span><br><span class="line">D               # delete (cut) to the end of the line</span><br><span class="line">d$              # delete (cut) to the end of the line</span><br><span class="line">d^              # delete (cut) to the first non-blank character of the line</span><br><span class="line">d0              # delete (cut) to the begining of the line</span><br><span class="line">x               # delete (cut) character</span><br><span class="line">15x				# delete (cut) 15 characters from the current cursor position</span><br></pre></td></tr></table></figure>
<h4 id="Search-and-replace"><a href="#Search-and-replace" class="headerlink" title="Search and replace"></a>Search and replace</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">:%s/old/new/g   # Replace all old with new throughout file</span><br><span class="line">:%s/old/new/gc  # Replace all old with new throughout file with confirmations</span><br><span class="line">:50,100s/old/new/gc    </span><br><span class="line">                # From Line 50 to Line 100, replace all old with new throughout file</span><br><span class="line">/pattern        # Search for pattern</span><br><span class="line">n               # Repeat search in same direction</span><br></pre></td></tr></table></figure>
<h4 id="Comment-multple-lines-In-Out"><a href="#Comment-multple-lines-In-Out" class="headerlink" title="Comment multple lines In/Out"></a>Comment multple lines In/Out</h4><p>注释多行文本<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">1. 使用vim打开要操作的文件</span><br><span class="line">2. Ctrl+V，进入VISUAL BLOCK模式</span><br><span class="line">3. 使用上下的方向键移动光标，选择你需要注释的行</span><br><span class="line">3. shift+i</span><br><span class="line">4. 输入注释符号 #</span><br><span class="line">5. esc，退出visual block模式，</span><br><span class="line">稍微等待一下（其他行的注释可能会有一些延迟），是不是已经将多行注释掉了啊？</span><br></pre></td></tr></table></figure></p>
<p>取消注释多行文本<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1. 使用vim打开要操作的文件</span><br><span class="line">2. Ctrl+V，进入VISUAL BLOCK模式</span><br><span class="line">3. 使用上下的方向键移动光标，选择你需要取消注释的行</span><br><span class="line">3. 输入 x，删除所有的 #，同时退出visual block模式</span><br></pre></td></tr></table></figure></p>
<h4 id="Save-as-a-new-File"><a href="#Save-as-a-new-File" class="headerlink" title="Save as a new File"></a>Save as a new File</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">:w &lt;new filename&gt;    # Save the current file as a new File</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/05/06/IP-Reputation-Check/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Patrick Dong">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Superpb9">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/05/06/IP-Reputation-Check/" itemprop="url">IP Reputation Check</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-05-06T14:50:19+12:00">
                2018-05-06
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Security-Incident-Response/" itemprop="url" rel="index">
                    <span itemprop="name">Security Incident Response</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="Program-Introduction"><a href="#Program-Introduction" class="headerlink" title="Program Introduction"></a>Program Introduction</h3><ul>
<li><p>Author: Patrick Dong</p>
</li>
<li><p>Modules Developed: abuseipdb.py, ipvoid.py, myIPWhois.py, sans.py, xforceIBM.py</p>
</li>
<li><p>System Requirement: Python 2.7 and BeautifulSoup, requests, pandas</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get install python-setuptools python-dev build-essential.</span><br><span class="line"></span><br><span class="line">$ sudo easy_install pip</span><br><span class="line"></span><br><span class="line">$ sudo pip install --upgrade virtualenv</span><br></pre></td></tr></table></figure>
<h4 id="Python-Code-Usage"><a href="#Python-Code-Usage" class="headerlink" title="Python Code Usage"></a>Python Code Usage</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">$ python webscraping.py &lt;IP|Domain&gt;</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;&gt;&gt; Welcome to WebScraping Tool &lt;&lt;&lt;&lt;&lt;</span><br><span class="line">Now checking 5.188.11.131 ...</span><br><span class="line"></span><br><span class="line">[.] IP Whois Result:</span><br><span class="line">% This is the RIPE Database query service.</span><br><span class="line">% The objects are in RPSL format.</span><br><span class="line">%</span><br><span class="line">% The RIPE Database is subject to Terms and Conditions.</span><br><span class="line">% See http://www.ripe.net/db/support/db-terms-conditions.pdf</span><br><span class="line"></span><br><span class="line">%ERROR:201: access denied for this server.</span><br><span class="line">%</span><br><span class="line">% Sorry, access from your host has been permanently</span><br><span class="line">% denied because of a repeated excessive querying.</span><br><span class="line">% For more information, see</span><br><span class="line">% http://www.ripe.net/data-tools/db/faq/faq-db/why-did-you-receive-the-error-201-access-denied</span><br><span class="line"></span><br><span class="line">% This query was served by the RIPE Database Query Service version 1.91.2 (ANGUS)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[.] IPVoid Result: </span><br><span class="line">                    ITEM                              DATA</span><br><span class="line">0          Analysis Date               2018-05-07 05:16:50</span><br><span class="line">1           Elapsed Time                         2 seconds</span><br><span class="line">2       Blacklist Status                 BLACKLISTED 10/96</span><br><span class="line">3             IP Address                      5.188.11.131</span><br><span class="line">4            Reverse DNS                           Unknown</span><br><span class="line">5                    ASN                           AS43350</span><br><span class="line">6              ASN Owner         NForce Entertainment B.V.</span><br><span class="line">7                    ISP  Petersburg Internet Network ltd.</span><br><span class="line">8              Continent                            Europe</span><br><span class="line">9           Country Code                      (HR) Croatia</span><br><span class="line">10  Latitude / Longitude                 44.8683 / 13.8481</span><br><span class="line">11                  City                              Pula</span><br><span class="line">12                Region                           Istria  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[.] SANS Result:</span><br><span class="line">Report Times 128963</span><br><span class="line">Total Targets 2401</span><br><span class="line">First Reported 2018-05-03</span><br><span class="line">Recent Report 2018-05-07 06:33:41</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[.] AbuseIPDB Result:</span><br><span class="line">Reported 173 times</span><br><span class="line">             Date   Reporter                   Category</span><br><span class="line">0  47 seconds ago  Anonymous   | Port Scan | Hacking | </span><br><span class="line">1  20 minutes ago      Scan    | Port Scan | Hacking | </span><br><span class="line">2  36 minutes ago      Scan    | Port Scan | Hacking | </span><br><span class="line">3      1 hour ago      Scan    | Port Scan | Hacking | </span><br><span class="line">4     2 hours ago    AWSBot              | Port Scan | </span><br><span class="line">5     2 hours ago      Scan    | Port Scan | Hacking | </span><br><span class="line">6     3 hours ago      Scan    | Port Scan | Hacking |  </span><br><span class="line"></span><br><span class="line">[.] IBM X-Force Result:</span><br><span class="line">Country: Russia</span><br><span class="line">Risk Score: 10</span><br><span class="line">Categorization: Dynamic IPs (71%)</span><br><span class="line">Categorization: Scanning IPs (100%)</span><br><span class="line"></span><br><span class="line">[.] IPVoid Result: BLACKLISTED 10/96</span><br><span class="line">[.] SANS Result: Report Times 128963 | Total Targets 2401 | First Reported 2018-05-03 | Recent Report 2018-05-07 06:33:41</span><br><span class="line">[.] AbuseIPDB Result: Reported 173 times</span><br><span class="line">[.] XForce Result:  Country: Russia | Risk Score: 10 | Categorization: Dynamic IPs (71%) | Categorization: Scanning IPs (100%)</span><br></pre></td></tr></table></figure>
<h3 id="Python-Code"><a href="#Python-Code" class="headerlink" title="Python Code"></a>Python Code</h3><h4 id="Main-webscraping-py"><a href="#Main-webscraping-py" class="headerlink" title="Main: webscraping.py"></a>Main: webscraping.py</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/python</span><br><span class="line">from __future__ import print_function</span><br><span class="line">import sys,re, smtplib</span><br><span class="line">import abuseipdb, ipvoid, sans, myIPwhois, xforceIBM</span><br><span class="line"></span><br><span class="line">def webscraping():</span><br><span class="line">    myIPvoidPrint1 = &apos;&apos;</span><br><span class="line">    mySansPrint2 = &apos;&apos;</span><br><span class="line">    myAbuseIPDBPrint3 = &apos;&apos;</span><br><span class="line">    myXForcePrint4 = &apos;&apos;</span><br><span class="line"></span><br><span class="line">    if len(sys.argv) != 2:</span><br><span class="line">        print(&apos;&gt;&gt;&gt;&gt;&gt; Welcome to my WebScraping Tool &lt;&lt;&lt;&lt;&lt;&apos;)</span><br><span class="line">        print(&apos;     Usage: python webscraping.py [x.x.x.x | domain]&apos;)</span><br><span class="line">    else:</span><br><span class="line">        print(&apos;&gt;&gt;&gt;&gt;&gt; Welcome to WebScraping Tool &lt;&lt;&lt;&lt;&lt;&apos;)</span><br><span class="line"></span><br><span class="line">        # regular expression for IP</span><br><span class="line">        re_ip = re.compile(&apos;^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.)&#123;3&#125;(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$&apos;)</span><br><span class="line"></span><br><span class="line">        print(&quot;Now checking &quot; + sys.argv[1] + &quot; ...&quot;)</span><br><span class="line">        print(&quot;&quot;)</span><br><span class="line"></span><br><span class="line">        # If the IP format is valid:</span><br><span class="line">        if re_ip.match(sys.argv[1]):</span><br><span class="line">            # Call myIPwhois.py</span><br><span class="line">            myIPwhois.IPWhoisChecker(&quot;https://www.abuseipdb.com/whois/&quot; + sys.argv[1])</span><br><span class="line"></span><br><span class="line">            # Call ipvoid.py</span><br><span class="line">            myIPvoidPrint1 = ipvoid.ipvoidChecker(sys.argv[1])</span><br><span class="line"></span><br><span class="line">            # Call sans.py</span><br><span class="line">            mySansPrint2 = sans.sansChecker(sys.argv[1])</span><br><span class="line"></span><br><span class="line">            # Call abuseipdb.py</span><br><span class="line">            myAbuseIPDBPrint3 = abuseipdb.abuseipdbChecker(&quot;https://www.abuseipdb.com/check/&quot; + sys.argv[1])</span><br><span class="line"></span><br><span class="line">            # Call xforceIBM.py</span><br><span class="line">            myXForcePrint4 = xforceIBM.myXForceChecker(&quot;https://api.xforce.ibmcloud.com/ipr/&quot; + sys.argv[1])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        # If the input is a domain or other strings, let the website validate then ...</span><br><span class="line">        else:</span><br><span class="line">            #Call myIPwhois.py</span><br><span class="line">            myIPwhois.IPWhoisChecker(&quot;https://www.abuseipdb.com/whois/&quot; + sys.argv[1])</span><br><span class="line"></span><br><span class="line">            # Call sans.py</span><br><span class="line">            # sans.sansChecker(&quot;https://isc.sans.edu/api/ip/&quot; + sys.argv[1])</span><br><span class="line">            sans.sansChecker(sys.argv[1])</span><br><span class="line"></span><br><span class="line">            # Call abuseipdb.py</span><br><span class="line">            abuseipdb.abuseipdbChecker(&quot;https://www.abuseipdb.com/check/&quot; + sys.argv[1])</span><br><span class="line"></span><br><span class="line">            # Call xforceIBM.py</span><br><span class="line">            # Check the domain</span><br><span class="line">            xforceIBM.myXForceChecker(&quot;https://api.xforce.ibmcloud.com/url/&quot; + sys.argv[1])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    print (&quot;&quot;)</span><br><span class="line">    message = &quot;[.] IPVoid Result: &quot; + myIPvoidPrint1 + &apos;\n&apos; +\</span><br><span class="line">              &quot;[.] SANS Result: &quot; + &apos; | &apos;.join(mySansPrint2) + &apos;\n&apos; +\</span><br><span class="line">              &quot;[.] AbuseIPDB Result: &quot; + myAbuseIPDBPrint3 + &apos;\n&apos; +\</span><br><span class="line">              &quot;[.] XForce Result:  &quot; + &apos; | &apos;.join(myXForcePrint4)</span><br><span class="line">    print (message)</span><br><span class="line"></span><br><span class="line">    sendemail(from_addr=&apos;xxx@gmail.com&apos;,</span><br><span class="line">              to_addr_list=[&apos;xxx@xx.co.nz&apos;],</span><br><span class="line">              cc_addr_list=[&apos;xxx@xx.co.nz&apos;],</span><br><span class="line">              subject=&apos;Some Testing Shxxt&apos;,</span><br><span class="line">              message= message,</span><br><span class="line">              login=&apos;xxx&apos;,</span><br><span class="line">              password=&apos;xxx!&apos;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def sendemail(from_addr, to_addr_list, cc_addr_list,</span><br><span class="line">              subject, message,</span><br><span class="line">              login, password,</span><br><span class="line">              smtpserver=&apos;smtp.gmail.com:587&apos;):</span><br><span class="line">    header = &apos;From: %s\n&apos; % from_addr</span><br><span class="line">    header += &apos;To: %s\n&apos; % &apos;,&apos;.join(to_addr_list)</span><br><span class="line">    header += &apos;Cc: %s\n&apos; % &apos;,&apos;.join(cc_addr_list)</span><br><span class="line">    header += &apos;Subject: %s\n\n&apos; % subject</span><br><span class="line">    message = header + message</span><br><span class="line"></span><br><span class="line">    server = smtplib.SMTP(smtpserver)</span><br><span class="line">    server.starttls()</span><br><span class="line">    server.login(login, password)</span><br><span class="line">    problems = server.sendmail(from_addr, to_addr_list, message)</span><br><span class="line">    server.quit()</span><br><span class="line">    return problems</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if __name__ == &apos;__main__&apos;:</span><br><span class="line">    webscraping()</span><br></pre></td></tr></table></figure>
<h4 id="Module-abuseipdb-py"><a href="#Module-abuseipdb-py" class="headerlink" title="Module: abuseipdb.py"></a>Module: abuseipdb.py</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br></pre></td><td class="code"><pre><span class="line">from bs4 import BeautifulSoup</span><br><span class="line">import requests</span><br><span class="line"></span><br><span class="line">import pandas as pd</span><br><span class="line">from pandas import Series, DataFrame</span><br><span class="line"></span><br><span class="line">def abuseipdbChecker(url):</span><br><span class="line"></span><br><span class="line">    # e.g. url = &quot;https://www.abuseipdb.com/check/220.191.211.7&quot;</span><br><span class="line">    #      url = &quot;https://www.abuseipdb.com/check/baidu.com&quot;</span><br><span class="line">    # HTTP Query</span><br><span class="line">    myResult = requests.get(url)</span><br><span class="line">    printResult = &apos;&apos;</span><br><span class="line">    print &apos;[.] AbuseIPDB Result:&apos;</span><br><span class="line"></span><br><span class="line">    # if the input value is invalid, such as &apos;baidu.comx&apos;, &apos;x.x.x.x.x&apos;, etc.</span><br><span class="line">    # Invalid Input: &apos;422 Unprocessable Entity&apos;</span><br><span class="line">    if myResult.status_code == 422:</span><br><span class="line">        print &apos;Error: 422 Unprocessable Entity (e.g. http://www.com)&apos;</span><br><span class="line">        print &apos;We expected a valid IP address or Domain name.&apos;</span><br><span class="line">        exit()</span><br><span class="line">    else:</span><br><span class="line">        # If domain resolved to an IP</span><br><span class="line">        if url != myResult.url:</span><br><span class="line">            print &apos;Your request has been resolved to &apos; + myResult.url</span><br><span class="line">        c = myResult.content</span><br><span class="line">        soup = BeautifulSoup(c, &quot;lxml&quot;)</span><br><span class="line"></span><br><span class="line">        # Part 1: Locate the reporting times that we want</span><br><span class="line">        # reportTimes = soup.find_all(class_=&quot;well&quot;)</span><br><span class="line">        mySoup = soup.find(&apos;div&apos;, &#123;&apos;class&apos;: &apos;col-md-6&apos;&#125;)</span><br><span class="line"></span><br><span class="line">        # Http Response code is still 200 but we got a message:</span><br><span class="line">        #      &apos;We can&apos;t resolve the domain www.comz! Please try your query again.&apos;</span><br><span class="line">        if mySoup is None:</span><br><span class="line">            print (&apos;We expected a valid IP address or Domain name.&apos;)</span><br><span class="line">        else:</span><br><span class="line">            # Get the first &apos;p&apos; tag in &lt;div class=&quot;well&quot;&gt;</span><br><span class="line">            # You can only put &apos;find_all&apos; after &apos;find&apos;</span><br><span class="line">            pTag = mySoup.find(&apos;p&apos;)</span><br><span class="line">            reportTimes = pTag.find(&apos;b&apos;)</span><br><span class="line"></span><br><span class="line">            # Print reporting times</span><br><span class="line">            try:</span><br><span class="line">                if reportTimes.string == &quot;Important Note:&quot;:</span><br><span class="line">                    print &apos;Note: You probably input a private IP. Please check again ...&apos;</span><br><span class="line">                    exit()</span><br><span class="line">                else:</span><br><span class="line">                    print &apos;Reported &apos; + reportTimes.string + &apos; times&apos;</span><br><span class="line">                    printResult = &apos;Reported &apos; + reportTimes.string + &apos; times&apos;</span><br><span class="line">            # if result equals &apos;None&apos;</span><br><span class="line">            except Exception:</span><br><span class="line">                reportTimes = 0</span><br><span class="line">                print &apos;Reported &apos; + str(reportTimes) + &apos; times&apos;</span><br><span class="line">                printResult = &apos;Reported &apos; + str(reportTimes) + &apos; times&apos;</span><br><span class="line">                print &apos;&apos;</span><br><span class="line"></span><br><span class="line">            # Part 2: Locate the table that we want</span><br><span class="line">            tables = soup.find_all(class_=&quot;table table-striped responsive-table&quot;)</span><br><span class="line"></span><br><span class="line">            if tables != []:</span><br><span class="line">                # Use BeautifulSoup to find the table entries with a For Loop</span><br><span class="line">                rawData = []</span><br><span class="line"></span><br><span class="line">                # Looking for every row in a table</span><br><span class="line">                # table[0] is just the format for BeautifulSoup</span><br><span class="line">                rows = tables[0].findAll(&apos;tr&apos;)</span><br><span class="line"></span><br><span class="line">                for tr in rows:</span><br><span class="line">                    cols = tr.findAll(&apos;td&apos;)</span><br><span class="line">                    for td in cols:</span><br><span class="line">                        # data-title = &quot;Reporter&quot;</span><br><span class="line">                        text = cols[0].text</span><br><span class="line">                        rawData.append(text)</span><br><span class="line">                        # data-title = &quot;Date&quot;</span><br><span class="line">                        text = cols[1].text</span><br><span class="line">                        rawData.append(text)</span><br><span class="line">                        &apos;&apos;&apos;</span><br><span class="line">                        # data-title = &quot;Comment&quot; (Ingnored)</span><br><span class="line">                        text = cols[2].text</span><br><span class="line">                        rawData.append(text)</span><br><span class="line">                        &apos;&apos;&apos;</span><br><span class="line">                        # data-title = &quot;Categories&quot;</span><br><span class="line">                        text = cols[3].text + &apos;\n&apos;</span><br><span class="line">                        rawData.append(text)</span><br><span class="line"></span><br><span class="line">                # Modify rawData</span><br><span class="line">                reporter = []</span><br><span class="line">                date = []</span><br><span class="line">                category = []</span><br><span class="line"></span><br><span class="line">                itemNum = len(rawData)</span><br><span class="line">                index = 0</span><br><span class="line"></span><br><span class="line">                # For &apos;reporter&apos;</span><br><span class="line">                index1 = 0</span><br><span class="line">                # For &apos;date&apos;</span><br><span class="line">                index2 = 1</span><br><span class="line">                # For &apos;category&apos;</span><br><span class="line">                index3 = 2</span><br><span class="line"></span><br><span class="line">                for index in range(0, itemNum - 1):</span><br><span class="line">                    # Make sure this loop will not exceed the limit</span><br><span class="line">                    if index1 &lt;= itemNum - 3:</span><br><span class="line">                        # Reporter</span><br><span class="line">                        reporter.append(rawData[index1].replace(&apos;\n&apos;, &apos;&apos;))</span><br><span class="line">                        index1 += 3</span><br><span class="line"></span><br><span class="line">                        # Date</span><br><span class="line">                        date.append(rawData[index2].replace(&apos;\n&apos;, &apos;&apos;))</span><br><span class="line">                        index2 += 3</span><br><span class="line"></span><br><span class="line">                        # Category</span><br><span class="line">                        category.append(rawData[index3].replace(&apos;\n\n&apos;, &apos; | &apos;).replace(&apos;\n&apos;, &apos; | &apos;))</span><br><span class="line">                        index3 += 3</span><br><span class="line"></span><br><span class="line">                        # Global Index</span><br><span class="line">                        index += 1</span><br><span class="line"></span><br><span class="line">                # Panda Series</span><br><span class="line">                reporter = Series(reporter)</span><br><span class="line">                date = Series(date)</span><br><span class="line">                category = Series(category)</span><br><span class="line"></span><br><span class="line">                # Concatenate into a DataFrame</span><br><span class="line">                legislative_df = pd.concat([date, reporter, category], axis=1)</span><br><span class="line"></span><br><span class="line">                # Set up the columns</span><br><span class="line">                legislative_df.columns = [&apos;Date&apos;, &apos;Reporter&apos;, &apos;Category&apos;]</span><br><span class="line"></span><br><span class="line">                # Delete the dups and reset index (and drop the old index)</span><br><span class="line">                legislative_df = legislative_df.drop_duplicates().reset_index(drop=True)</span><br><span class="line"></span><br><span class="line">                # Show the finished DataFrame</span><br><span class="line">                print legislative_df,</span><br><span class="line">                print &apos;&apos;</span><br><span class="line">    return printResult</span><br></pre></td></tr></table></figure>
<h4 id="Module-ipvoid-py"><a href="#Module-ipvoid-py" class="headerlink" title="Module: ipvoid.py"></a>Module: ipvoid.py</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">from bs4 import BeautifulSoup</span><br><span class="line">import requests</span><br><span class="line"></span><br><span class="line">import pandas as pd</span><br><span class="line">from pandas import Series, DataFrame</span><br><span class="line"></span><br><span class="line">def ipvoidChecker(ip):</span><br><span class="line"></span><br><span class="line">    url = &quot;http://www.ipvoid.com/ip-blacklist-check/&quot;</span><br><span class="line">    headers = &#123;&quot;Content-Type&quot;: &quot;application/x-www-form-urlencoded&quot;,</span><br><span class="line">               &quot;Referer&quot;:&quot;http://www.ipvoid.com/ip-blacklist-check/&quot;,&#125;</span><br><span class="line">    payload = &#123;&apos;ip&apos;:ip&#125;</span><br><span class="line">    # Note: Using &apos;data&apos; instead of &apos;params&apos;</span><br><span class="line">    r = requests.post(url, headers=headers, data=payload)</span><br><span class="line">    returnData = r.content</span><br><span class="line">    soup = BeautifulSoup(returnData, &quot;lxml&quot;)</span><br><span class="line"></span><br><span class="line">    #mySoup = soup.find(&apos;div&apos;, &#123;&apos;class&apos;: &apos;responsive&apos;&#125;)</span><br><span class="line">    tables = soup.find_all(class_=&quot;table table-striped table-bordered&quot;)</span><br><span class="line"></span><br><span class="line">    column1 = []</span><br><span class="line">    column2 = []</span><br><span class="line">    printResult = &apos;&apos;</span><br><span class="line"></span><br><span class="line">    if tables !=[]:</span><br><span class="line">        rows = tables[0].findAll(&apos;tr&apos;)</span><br><span class="line">        i = 0</span><br><span class="line">        for tr in rows:</span><br><span class="line">            i+=1</span><br><span class="line">            cols = tr.findAll(&apos;td&apos;)</span><br><span class="line">            column1.append(cols[0].text)</span><br><span class="line">            column2.append(cols[1].text.</span><br><span class="line">                           replace(&quot; Find Sites | IP Whois&quot;,&quot;&quot;).</span><br><span class="line">                           replace(&quot; Google Map&quot;,&quot;&quot;))</span><br><span class="line">            #Get the Blacklist Status</span><br><span class="line">            if i == 3:</span><br><span class="line">                printResult = cols[1].text</span><br><span class="line">    # Panda Series</span><br><span class="line">    column1 = Series(column1)</span><br><span class="line">    column2 = Series(column2)</span><br><span class="line"></span><br><span class="line">    # Concatenate into a DataFrame</span><br><span class="line">    legislative_df = pd.concat([column1, column2], axis=1)</span><br><span class="line"></span><br><span class="line">    # Set up the columns</span><br><span class="line">    legislative_df.columns = [&apos;ITEM&apos;, &apos;DATA&apos;]</span><br><span class="line"></span><br><span class="line">    # Show the finished DataFrame</span><br><span class="line">    print &apos;[.] IPVoid Result: &apos;</span><br><span class="line">    print legislative_df,&apos;\n\n&apos;</span><br><span class="line">    return printResult</span><br></pre></td></tr></table></figure>
<h4 id="Module-myIPwhois-py"><a href="#Module-myIPwhois-py" class="headerlink" title="Module: myIPwhois.py"></a>Module: myIPwhois.py</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">from bs4 import BeautifulSoup</span><br><span class="line">import requests</span><br><span class="line"></span><br><span class="line">def IPWhoisChecker(url):</span><br><span class="line"></span><br><span class="line">    # e.g. url = &quot;https://www.abuseipdb.com/whois/114.200.4.207&quot;</span><br><span class="line">    myResult = requests.get(url)</span><br><span class="line">    print &apos;[.] IP Whois Result:&apos;</span><br><span class="line"></span><br><span class="line">    # if the input value is invalid, such as &apos;baidu.comx&apos;, &apos;x.x.x.x.x&apos;, etc.</span><br><span class="line">    # Invalid Input: &apos;422 Unprocessable Entity&apos;</span><br><span class="line">    if myResult.status_code == 422:</span><br><span class="line">        print &apos;Error: 422 Unprocessable Entity (e.g. http://www.com)&apos;</span><br><span class="line">        print &apos;We expected a valid IP address or Domain name.&apos;</span><br><span class="line">        print &apos;Program will exit ...&apos;</span><br><span class="line">        exit()</span><br><span class="line">    elif myResult.status_code == 404:</span><br><span class="line">        print &apos;Response Error: 404 We expected a valid IP address or Domain name.&apos;</span><br><span class="line">        print &apos;Program will exit ...&apos;</span><br><span class="line">        exit()</span><br><span class="line">    else:</span><br><span class="line">        # If domain resolved to an IP</span><br><span class="line">        if url != myResult.url:</span><br><span class="line">            print &apos;Your request has been resolved to &apos; + myResult.url</span><br><span class="line">        c = myResult.content</span><br><span class="line">        soup = BeautifulSoup(c, &quot;lxml&quot;)</span><br><span class="line"></span><br><span class="line">        # Parse https://www.abuseipdb.com/whois/x.x.x.x</span><br><span class="line">        mySoup = soup.find(&apos;section&apos;, &#123;&apos;id&apos;: &apos;report-wrapper&apos;&#125;)</span><br><span class="line">        preTag = mySoup.find(&apos;pre&apos;)</span><br><span class="line">        ipWhoisInfo = preTag.text</span><br><span class="line"></span><br><span class="line">        if not ipWhoisInfo:</span><br><span class="line">            print &quot;None&quot;</span><br><span class="line">        else:</span><br><span class="line">            print ipWhoisInfo</span><br></pre></td></tr></table></figure>
<h4 id="Module-sans-py"><a href="#Module-sans-py" class="headerlink" title="Module: sans.py"></a>Module: sans.py</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line">import re</span><br><span class="line"></span><br><span class="line">from bs4 import BeautifulSoup</span><br><span class="line">import requests, dns.resolver</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def sansChecker(IPOrDomain):</span><br><span class="line"></span><br><span class="line">    # HTTP Query</span><br><span class="line">    url = &quot;https://isc.sans.edu/api/ip/&quot; + IPOrDomain</span><br><span class="line"></span><br><span class="line">    # If the input value is a domain</span><br><span class="line">    re_ip = re.compile(&apos;^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.)&#123;3&#125;(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$&apos;)</span><br><span class="line">    if not re_ip.match(IPOrDomain):</span><br><span class="line">        #Try to resolve the domain first</span><br><span class="line">        aRecord = []</span><br><span class="line">        my_resolver = dns.resolver.Resolver()</span><br><span class="line">        my_resolver.nameservers = [&apos;8.8.8.8&apos;]</span><br><span class="line">        for rdata in my_resolver.query(IPOrDomain, &quot;A&quot;):</span><br><span class="line">            aRecord.append(rdata.address)</span><br><span class="line">        # Only use the 1st A record</span><br><span class="line">        url = &quot;https://isc.sans.edu/api/ip/&quot; + aRecord[0]</span><br><span class="line"></span><br><span class="line">    # Our actual checking begins from here</span><br><span class="line">    printResult = []</span><br><span class="line">    myResult = requests.get(url)</span><br><span class="line">    c = myResult.content</span><br><span class="line">    soup = BeautifulSoup(c, &quot;lxml&quot;)</span><br><span class="line">    mySoup = soup.find(&apos;error&apos;)</span><br><span class="line">    print &apos;[.] SANS Result:&apos;</span><br><span class="line"></span><br><span class="line">    # If the input IP has a correct format</span><br><span class="line">    if mySoup is None:</span><br><span class="line">        c = myResult.content</span><br><span class="line">        soup = BeautifulSoup(c, &quot;lxml&quot;)</span><br><span class="line">        try:</span><br><span class="line">            reportedTimes = soup.find(&apos;count&apos;)</span><br><span class="line">            if reportedTimes.text != &apos;&apos;:</span><br><span class="line">                print &apos;Report Times &apos; + reportedTimes.text</span><br><span class="line">                printResult.append(&apos;Report Times &apos; + reportedTimes.text)</span><br><span class="line">            else:</span><br><span class="line">                print &apos;Report Times 0&apos;</span><br><span class="line">                printResult.append(&quot;Report Times 0&quot;)</span><br><span class="line">        except Exception:</span><br><span class="line">            print &apos;Report Times 0&apos;</span><br><span class="line">            printResult.append(&quot;Report Times 0&quot;)</span><br><span class="line"></span><br><span class="line">        try:</span><br><span class="line">            targets = soup.find(&apos;attacks&apos;)</span><br><span class="line">            if targets.text != &apos;&apos;:</span><br><span class="line">                print &apos;Total Targets &apos; + targets.text</span><br><span class="line">                printResult.append(&apos;Total Targets &apos; + targets.text)</span><br><span class="line">            else:</span><br><span class="line">                print &apos;Total Targets 0&apos;</span><br><span class="line">                printResult.append(&apos;Total Targets 0&apos;)</span><br><span class="line">        except Exception:</span><br><span class="line">            print &apos;Total Targets 0&apos;</span><br><span class="line">            printResult.append(&apos;Total Targets 0&apos;)</span><br><span class="line"></span><br><span class="line">        try:</span><br><span class="line">            firstReported = soup.find(&apos;mindate&apos;)</span><br><span class="line">            if firstReported.text != &apos;&apos;:</span><br><span class="line">                print &apos;First Reported &apos; + firstReported.text</span><br><span class="line">                printResult.append(&apos;First Reported &apos; + firstReported.text)</span><br><span class="line">            else:</span><br><span class="line">                print &apos;First Reported 0&apos;</span><br><span class="line">                printResult.append(&apos;First Reported 0&apos;)</span><br><span class="line">        except Exception:</span><br><span class="line">            print &apos;First Reported 0&apos;</span><br><span class="line">            printResult.append(&apos;First Reported 0&apos;)</span><br><span class="line"></span><br><span class="line">        try:</span><br><span class="line">            latestReported = soup.find(&apos;updated&apos;)</span><br><span class="line">            if latestReported.text != &apos;&apos;:</span><br><span class="line">                print &apos;Recent Report &apos; + latestReported.text</span><br><span class="line">                printResult.append(&apos;Recent Report &apos; + latestReported.text)</span><br><span class="line">            else:</span><br><span class="line">                print &apos;Recent Report 0&apos;</span><br><span class="line">                printResult.append(&apos;Recent Report 0&apos;)</span><br><span class="line">        except Exception:</span><br><span class="line">            print &apos;Recent Report 0&apos;</span><br><span class="line">            printResult.append(&apos;Recent Report 0&apos;)</span><br><span class="line"></span><br><span class="line">        print &quot;\n&quot;</span><br><span class="line"></span><br><span class="line">    # Elif the input IP is wrong</span><br><span class="line">    elif mySoup.text == &apos;bad IP address&apos;:</span><br><span class="line">        print &apos;We expected a valid IP address.&apos;</span><br><span class="line">        exit()</span><br><span class="line"></span><br><span class="line">    return printResult</span><br></pre></td></tr></table></figure>
<h4 id="Module-xforceIBM-py"><a href="#Module-xforceIBM-py" class="headerlink" title="Module: xforceIBM.py"></a>Module: xforceIBM.py</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">from requests.auth import HTTPBasicAuth</span><br><span class="line"></span><br><span class="line">import json</span><br><span class="line"></span><br><span class="line">def myXForceChecker(url):</span><br><span class="line"></span><br><span class="line">    # User: 473284ee-2c45-4719-a201-5e6c81c0253a</span><br><span class="line">    # Password: 8acd0774-7238-4ad7-bc09-a2003ca6e80f</span><br><span class="line"></span><br><span class="line">    # Auth first</span><br><span class="line">    print &apos;&apos;</span><br><span class="line">    print &apos;[.] IBM X-Force Result:&apos;</span><br><span class="line"></span><br><span class="line">    printResult = []</span><br><span class="line">    # e.g. url = &quot;https://exchange.xforce.ibmcloud.com/ip//114.200.4.207&quot;</span><br><span class="line">    # IP Report</span><br><span class="line">    myResult1 = requests.get(url, auth=HTTPBasicAuth(&apos;473284ee-2c45-4719-a201-5e6c81c0253a&apos;,</span><br><span class="line">                                                     &apos;8acd0774-7238-4ad7-bc09-a2003ca6e80f&apos;))</span><br><span class="line">    c1 = myResult1.content</span><br><span class="line">    myJson1 = json.loads(c1)</span><br><span class="line"></span><br><span class="line">    # &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;  IP/Domain Report Check &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span><br><span class="line">    # ...........</span><br><span class="line">    &apos;&apos;&apos;</span><br><span class="line">    # indent = 2</span><br><span class="line">    # json.dumps() change data to python dictionary</span><br><span class="line">    # sortedData = json.dumps(myJson1, sort_keys=True, indent=2)</span><br><span class="line">    # print sortedData</span><br><span class="line">    &apos;&apos;&apos;</span><br><span class="line"></span><br><span class="line">    #----------These three keys are for IP checker----------</span><br><span class="line">    # [Print] Geo information</span><br><span class="line">    if &quot;geo&quot; in myJson1:</span><br><span class="line">        for key, value in myJson1[&quot;geo&quot;].items():</span><br><span class="line">            geo = &quot;Country&quot; + &quot;: &quot; + str(value)</span><br><span class="line">            print geo</span><br><span class="line">            printResult.append(geo)</span><br><span class="line">            # Only print country</span><br><span class="line">            # (Ingore country code)</span><br><span class="line">            break</span><br><span class="line">    # [Print] Overrall Risk Score</span><br><span class="line">    if &quot;score&quot; in myJson1:</span><br><span class="line">        if myJson1[&quot;score&quot;] == 1:</span><br><span class="line">            print &quot;Risk Score: &quot; + str(myJson1[&quot;score&quot;]) + &quot; (low)&quot;</span><br><span class="line">            printResult.append(&quot;Risk Score: &quot; + str(myJson1[&quot;score&quot;]) + &quot; (low)&quot;)</span><br><span class="line">        else:</span><br><span class="line">            print &quot;Risk Score: &quot; + str(myJson1[&quot;score&quot;])</span><br><span class="line">            printResult.append(&quot;Risk Score: &quot; + str(myJson1[&quot;score&quot;]))</span><br><span class="line">    # [Print] Categorization:</span><br><span class="line">    if &quot;cats&quot; in myJson1:</span><br><span class="line">        if myJson1[&quot;cats&quot;]:</span><br><span class="line">            for key, value in myJson1[&quot;cats&quot;].items():</span><br><span class="line">                cat = str(key) + &quot; (&quot; + str(value) + &quot;%)&quot;</span><br><span class="line">                print &quot;Categorization: &quot; + cat</span><br><span class="line">                printResult.append(&quot;Categorization: &quot; + cat)</span><br><span class="line">        else:</span><br><span class="line">            print &quot;Categorization: Unsuspicious&quot;</span><br><span class="line">            printResult.append(&quot;Categorization: Unsuspicious&quot;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    # ----------These keys are for Domain checker----------</span><br><span class="line">    if &quot;result&quot; in myJson1:</span><br><span class="line">        myJsonResult = myJson1[&quot;result&quot;]</span><br><span class="line">        if myJsonResult[&quot;score&quot;] == 1:</span><br><span class="line">            print &quot;Risk Score: &quot; + str(myJsonResult[&quot;score&quot;]) + &quot; (low)&quot;</span><br><span class="line">            printResult.append(&quot;Risk Score: &quot; + str(myJsonResult[&quot;score&quot;]) + &quot; (low)&quot;)</span><br><span class="line">        else:</span><br><span class="line">            print &quot;Risk Score: &quot; + str(myJsonResult[&quot;score&quot;])</span><br><span class="line">            printResult.append(&quot;Risk Score: &quot; + str(myJsonResult[&quot;score&quot;]))</span><br><span class="line"></span><br><span class="line">        if myJsonResult[&quot;categoryDescriptions&quot;]:</span><br><span class="line">            for key, value in myJsonResult[&quot;categoryDescriptions&quot;].items():</span><br><span class="line">                cat = &quot;&lt;&quot; + str(key).replace(&quot; / &quot;, &quot;|&quot;) + &quot;&gt;: &quot; + str(value)</span><br><span class="line">                print cat</span><br><span class="line">                printResult.append(cat)</span><br><span class="line"></span><br><span class="line">    return printResult</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/05/06/Splunk/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Patrick Dong">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Superpb9">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/05/06/Splunk/" itemprop="url">Splunk</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-05-06T09:39:58+12:00">
                2018-05-06
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Security-Incident-Response/" itemprop="url" rel="index">
                    <span itemprop="name">Security Incident Response</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="Splunk-Search-Language"><a href="#Splunk-Search-Language" class="headerlink" title="Splunk Search Language"></a>Splunk Search Language</h4><p>Search Terms<br>Commands | Blue (creating charts, computing statistics and formatting)<br>Fuctions | Purple (explaining how we want to chart, compute and evaluate the results)<br>Arguments | Green (variables that we want to apply to the function)<br>Clauses (explaining how you want results grouped or defined)</p>
<p><img src="/uploadimage/Splunk_1.png" alt="Image"></p>
<h5 id="Using-TERM-function-to-ensure-searching-efficiency"><a href="#Using-TERM-function-to-ensure-searching-efficiency" class="headerlink" title="Using TERM() function to ensure searching efficiency"></a>Using <span style="color:purple"><strong>TERM()</strong></span> function to ensure searching efficiency</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">index=splunkTraining sourcetype=access_combined TERM(192.168.1.222)</span><br></pre></td></tr></table></figure>
<h5 id="Using-table-command"><a href="#Using-table-command" class="headerlink" title="Using table command"></a>Using <span style="color:blue"><strong>table</strong></span> command</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">index=splunkTraining sourcetype=access_combined | table host _raw</span><br><span class="line">index=splunkTraining sourcetype=access_combined | table _time, host, source*, _raw</span><br></pre></td></tr></table></figure>
<h5 id="Using-timechart-command"><a href="#Using-timechart-command" class="headerlink" title="Using timechart command"></a>Using <span style="color:blue"><strong>timechart</strong></span> command</h5><p>[span=1d —&gt; 1day span; span=5m —&gt; 5min span]</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">index=splunkTraining sourcetype=access_combined TXXXXXX | timechart span=1d count by status</span><br><span class="line">index=splunkTraining sourcetype=access_combined status &gt;= 400 |  timechart span=1d count by status</span><br></pre></td></tr></table></figure>
<p>The <span style="color:blue"><strong>timechart</strong></span> command allows for the use of subcommands or “evaluation expressions” such as count, avg(), max(), min(), stdev(), and others.</p>
<p>[limit=5 means limiting to 5 clientips]</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">index=splunkTraining sourcetype=access_combined | timechart limit=5 sum(bytes) as total_bytes max(bytes) as max_bytes by clientip</span><br><span class="line">index=splunkTraining sourcetype=access_combined | timechart sum(bytes) as max_bytes by clientip WHERE max in top10</span><br></pre></td></tr></table></figure>
<h5 id="Using-eval-command"><a href="#Using-eval-command" class="headerlink" title="Using eval command"></a>Using <span style="color:blue"><strong>eval</strong></span> command</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">index=splunkTraining sourcetype=access_combined | eval status_category=if(status&lt;400, &quot;ok&quot;, &quot;bad&quot;)</span><br></pre></td></tr></table></figure>
<p>[mbytes = bytes / 1024 / 1024 - Divided by 1024 twice]</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">index=splunkTraining sourcetype=access_combined | eval mbytes = bytes / 1024 / 1024</span><br><span class="line">index=splunkTraining sourcetype=access_combined | eval mbytes = bytes / 1024 / 1024 | top 5 mbytes</span><br></pre></td></tr></table></figure>
<p>Maybe we’d like to provide a description of the activity taking place in the web request.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">index=splunkTraining sourcetype=access_combined itemId=*</span><br><span class="line">|  eval event_description=clientip . &quot; made a &quot; . action . &quot; on time &quot; . itemId</span><br><span class="line">|  table event_description</span><br></pre></td></tr></table></figure>
<p>Play around with HTTP User-Agent using eval agent_category = case ()</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">index=splunkTraining sourcetype=access_combined itemId=* | </span><br><span class="line">eval agent_category = case</span><br><span class="line">(useragent LIKE &quot;%Android%&quot;, &quot;Android&quot;, </span><br><span class="line">useragent LIKE &quot;%iPhone%&quot;, &quot;iOS&quot;, </span><br><span class="line">useragent LIKE &quot;%iPad%&quot;, &quot;iOS&quot;, true(), &quot;Other&quot;) | </span><br><span class="line">table _raw, agent_category</span><br></pre></td></tr></table></figure>
<h5 id="Using-top-and-rare-command"><a href="#Using-top-and-rare-command" class="headerlink" title="Using top and rare command"></a>Using <span style="color:blue"><strong>top</strong></span> and <span style="color:blue"><strong>rare</strong></span> command</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">index=splunkTraining sourcetype=access_combined | top 1 action</span><br><span class="line">index=splunkTraining sourcetype=access_combined | top itemId by action showperc=false</span><br><span class="line">index=splunkTraining sourcetype=access_combined | top itemId by status showperc=false</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">index=splunkTraining sourcetype=access_combined | rare useragent showperc=false</span><br></pre></td></tr></table></figure>
<p>(Seeing the unique list of xxx - groupd statics) If you were interested in seeing the unique list of products that each customer checked out you can use the values() function:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">index=splunkTraining sourcetype=access_combined | eval mbytes=bytes / 1024 / 1024 | stats values(itemId) as products by clientip</span><br></pre></td></tr></table></figure>
<p>We could use the timechart command, or we could employ the <span style="color:blue"><strong>bin</strong></span> and <span style="color:blue"><strong>stats</strong></span> commands together. The bin command allows us to specify that we want to group the time values by 1 day or 1 minute or 1 week, etc. It gives us the opportunity to use the span argument even though stats doesn’t support it itself.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">index=splunkTraining sourcetype=access_combined | bin _time span=1d | stats distinct_count(clientip) as distinct_clients by _time</span><br></pre></td></tr></table></figure>
<h5 id="Using-eventstats-command"><a href="#Using-eventstats-command" class="headerlink" title="Using eventstats command"></a>Using <span style="color:blue"><strong>eventstats</strong></span> command</h5><p>We used timechart before, but want to perform more calculations from the counts that are calculated without losing the form of the results during the new operation. The eventstats command is a close cousin of stats, but with a very special difference: eventstats adds its calculations inline to each event, meaning that the previous result set remains fully intact, but is enriched with new data produced from eventstats.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">index=splunkTraining sourcetype=access_combined | timechart span=1d count | eventstats avg(count) as avg</span><br><span class="line">index=splunkTraining sourcetype=access_combined action=purchase | timechart span=1d count | eventstats avg(count) as avg</span><br><span class="line">index=splunkTraining sourcetype=access_combined action=purchase | timechart span=1d count | eventstats avg(count) as avg, max(count) as max, min(count) as min</span><br></pre></td></tr></table></figure>
<h5 id="Using-sort-head-and-tail-command"><a href="#Using-sort-head-and-tail-command" class="headerlink" title="Using sort, head and tail command"></a>Using <span style="color:blue"><strong>sort</strong></span>, <span style="color:blue"><strong>head</strong></span> and <span style="color:blue"><strong>tail</strong></span> command</h5><p>We can use sort against field names to instruct that we’d like the results to be sorted either ascending or descending (where descending is indicated by a preceding “-“ dash). The example below will return results ordered by the clientip field values.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">index=splunkTraining sourcetype=access_combined | sort clientip</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">index=splunkTraining sourcetype=access_combined |  stats count by clientip, method | sort clientip, -method, -count</span><br><span class="line">index=splunkTraining sourcetype=access_combined |  stats count by clientip, method | sort clientip, -method, -count |  head 10</span><br><span class="line">index=splunkTraining sourcetype=access_combined |  stats count by clientip, method | sort 10 clientip, -method, -count</span><br><span class="line">index=splunkTraining sourcetype=access_combined |  stats count by clientip, method | sort clientip, -method, -count |  tail 10</span><br></pre></td></tr></table></figure>
<h5 id="Using-iplocation-geostats-and-geom-command"><a href="#Using-iplocation-geostats-and-geom-command" class="headerlink" title="Using iplocation, geostats and geom command"></a>Using <span style="color:blue"><strong>iplocation</strong></span>, <span style="color:blue"><strong>geostats</strong></span> and <span style="color:blue"><strong>geom</strong></span> command</h5><p>Let’s start out by using iplocation on its own.<br>Enter the search below and look out for the lat, lon, City, Country, and Region fields in your output</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">index=splunkTraining sourcetype=access_combined | iplocation clientip</span><br><span class="line">index=splunkTraining sourcetype=access_combined | iplocation clientip | geostats count by itemId </span><br><span class="line">index=splunkTraining sourcetype=access_combined | iplocation clientip | stats count by Region | geom geo_us_stats featureIdField=&quot;Region&quot;</span><br></pre></td></tr></table></figure>
<h4 id="Splunk-Searching-Exampels"><a href="#Splunk-Searching-Exampels" class="headerlink" title="Splunk Searching Exampels"></a>Splunk Searching Exampels</h4><p>“On October 1 2016, how many web hits were there for iPhone devices?”</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">index=splunkTraining sourcetype=access_combined useragent = &quot;*iPhone*&quot; | table req_time, clientip, useragent</span><br><span class="line">index=splunkTraining sourcetype=access_combined useragent = &quot;*iPhone*&quot; | table req_time, clientip, _raw | sort req_time</span><br></pre></td></tr></table></figure>
<p>Optimize the result by using stats values(), so that to show how many URIs that each ‘clientip’ visited via ‘iPhone’ </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">index=splunkTraining sourcetype=access_combined useragent = &quot;*iPhone*&quot; | stats values(uri) count by clientip</span><br></pre></td></tr></table></figure>
<p>If we just need the total count for each of the unique ‘useragents’ (there will then be 2 colums – useragent and each unique count)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">index=splunkTraining sourcetype=access_combined useragent != &quot;*iPhone*&quot; AND useragent=*mobile* | table req_time, clientip, useragent | stats count by useragent</span><br><span class="line">index=splunkTraining sourcetype=access_combined useragent != &quot;*iPhone*&quot; AND useragent=*mobile* | table req_time, clientip, useragent | stats count by useragent | sort by - count</span><br></pre></td></tr></table></figure>
<p>I’d like to see the useragents broken out into categories: Android, iOS, and Other.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">index=splunkTraining sourcetype=access_combined useragent=* </span><br><span class="line">| eval pippo = case(useragent LIKE &quot;%Android%&quot;, &quot;Android&quot;, </span><br><span class="line">                    useragent LIKE &quot;%iPhone%&quot;, &quot;iOS&quot;, </span><br><span class="line">                    useragent LIKE &quot;%iPad%&quot;, &quot;iOS&quot;, </span><br><span class="line">                    true(), &quot;Other&quot;) </span><br><span class="line">| top pippo</span><br></pre></td></tr></table></figure>
<p><img src="/uploadimage/Splunk_2.png" alt="image"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">index=splunkTraining sourcetype=access_combined useragent=* | eval pippo = case(useragent LIKE &quot;%Android%&quot;, &quot;Android&quot;, useragent LIKE &quot;%iPhone%&quot;, &quot;iOS&quot;, useragent LIKE &quot;%iPad%&quot;, &quot;iOS&quot;, true(), &quot;Other&quot;) | top pippo</span><br></pre></td></tr></table></figure>
<p>Can we get those results for just the purchase actions, and instead of just the total, is it possible to see how many per hour?</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">index=splunkTraining sourcetype=access_combined useragent=* action=purchase </span><br><span class="line">| eval pippo = case(useragent LIKE &quot;%Android%&quot;, &quot;Android&quot;, </span><br><span class="line">                    useragent LIKE &quot;%iPhone%&quot;, &quot;iOS&quot;, </span><br><span class="line">                    useragent LIKE &quot;%iPad%&quot;, &quot;iOS&quot;, </span><br><span class="line">                    true(), &quot;Other&quot;) </span><br><span class="line">| timechart span=1h count by pippo</span><br></pre></td></tr></table></figure>
<p><img src="/uploadimage/Splunk_3.png" alt="image"></p>
<p>Can we see this data in a chart?</p>
<p><img src="/uploadimage/Splunk_4.png" alt="image"></p>
<p>We’ve been trying to understand product popularity in different parts of the world for the entire month of October 2016. Can we do that too?<br>(we need iplocation | geostats )</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">index=splunkTraining sourcetype=access_combined product_id=* | iplocation clientip | geostats count by product_id</span><br></pre></td></tr></table></figure>
<p><img src="/uploadimage/Splunk_5.png" alt="image"></p>
<h4 id="Splunk-Investigation-Cheatsheet"><a href="#Splunk-Investigation-Cheatsheet" class="headerlink" title="Splunk Investigation Cheatsheet"></a>Splunk Investigation Cheatsheet</h4><p>Syntax 1 - Using <span style="color:darkblue"><strong>table</strong></span> </p>
<p>“search query (key word)” sourcetype=”value here” | <span style="color:darkblue"><strong>table</strong></span> field1, field2, field3, field4</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Example:</span><br><span class="line">U125121 sourcetype=&quot;websense&quot; | table _time, user, url, dst_ip, dst_port, action, category_name</span><br><span class="line">user=&quot;U125121&quot; sourcetype=&quot;websense&quot; | table _time, user, url, dst_ip, dst_port, action, category_name</span><br></pre></td></tr></table></figure>
<p>Syntax 2 - Using <span style="color:darkblue"><strong>dedup</strong></span> </p>
<p>“search query (key word)” sourcetype=”value here” | <span style="color:darkblue"><strong>table</strong></span> field1, field2, field3, field4 | <span style="color:darkblue"><strong>dedup</strong></span> field2</p>
<p>Removing duplicate events. We use “dedup” to remove events which contain an identical combination of values for selected fields.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Example:</span><br><span class="line">user=&quot;U125121&quot; sourcetype=&quot;websense&quot; | table _time, user, url, dst_ip, dst_port, action, category_name | dedup url</span><br></pre></td></tr></table></figure>
<p>Syntax 3 - Using <span style="color:darkblue"><strong>sort</strong></span> </p>
<p>“search query (key word)” sourcetype=”value here” | <span style="color:darkblue"><strong>table</strong></span> field1, field2, field3, field4 | <span style="color:darkblue"><strong>dedup</strong></span> field2 | <span style="color:darkblue"><strong>sort</strong></span> field3</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Example:</span><br><span class="line">user=&quot;U125121&quot; sourcetype=&quot;websense&quot; | table _time, user, url, dst_ip, dst_port, action, category_name | dedup url | sort time</span><br></pre></td></tr></table></figure>
<p>Syntax 4 - Using <span style="color:darkblue"><strong>stats</strong></span> <span style="color:purple"><strong>values</strong></span>(field)</p>
<p>“search query (key word)” sourcetype=”value here” | <span style="color:darkblue"><strong>stats</strong></span> <span style="color:purple"><strong>values</strong></span>(field1) <span style="color:purple"><strong>values</strong></span>(field2) <span style="color:purple"><strong>count</strong></span> <span style="color:orange"><strong>by</strong></span> user</p>
<p>This syntax provides statistics grouped optionally by field. For example, we can let splunk show the total count of user activites by grouping “values of url” and “values of dst_ip” in two different colomns.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Example:</span><br><span class="line">user=&quot;U125121&quot; sourcetype=&quot;websense&quot; | stats values(url) values(dst_ip) count by user</span><br></pre></td></tr></table></figure>
<p>Syntax 5 - Using <span style="color:darkblue"><strong>rename</strong></span></p>
<p>“search query (key word)” sourcetype=”value here” | <span style="color:darkblue"><strong>stats</strong></span> <span style="color:purple"><strong>values</strong></span>(field1) <span style="color:orange"><strong>as</strong></span> field1_rename <span style="color:purple"><strong>count</strong></span> <span style="color:orange"><strong>by</strong></span> user</p>
<p>“search query (key word)” sourcetype=”value here” | <span style="color:darkblue"><strong>table</strong></span> field1, field2, field3, field4 | <span style="color:darkblue"><strong>rename</strong></span> field2 <span style="color:orange"><strong>as</strong></span> field2_rename</p>
<p>This syntax allows us rename any field that we prefer.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Example:</span><br><span class="line">user=&quot;U125121&quot; sourcetype=&quot;websense&quot; | stats values(url) as website count by user</span><br><span class="line">user=&quot;U125121&quot; sourcetype=&quot;websense&quot; | table _time, url, action, category_name | rename url as website</span><br></pre></td></tr></table></figure>
<h4 id="Configure-Splunk-Receiver"><a href="#Configure-Splunk-Receiver" class="headerlink" title="Configure Splunk Receiver"></a>Configure Splunk Receiver</h4><p>Splunk start and stop</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo /opt/splunk/bin/splunk [start|stop]</span><br></pre></td></tr></table></figure>
<p>Once started we will get below information</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">$ sudo /opt/splunk/bin/splunk start</span><br><span class="line">Splunk&gt; Like an F-18, bro.</span><br><span class="line"></span><br><span class="line">Checking prerequisites...</span><br><span class="line">	Checking http port [8000]: open</span><br><span class="line">	Checking mgmt port [8089]: open</span><br><span class="line">	Checking appserver port [127.0.0.1:8065]: open</span><br><span class="line">	Checking kvstore port [8191]: open</span><br><span class="line">	Checking configuration...  Done.</span><br><span class="line">	Checking critical directories...	Done</span><br><span class="line">	Checking indexes...</span><br><span class="line">		Validated: _audit _internal _introspection _telemetry _thefishbucket history main summary</span><br><span class="line">	Done</span><br><span class="line">	Checking filesystem compatibility...  Done</span><br><span class="line">	Checking conf files for problems...</span><br><span class="line">	Done</span><br><span class="line">	Checking default conf files for edits...</span><br><span class="line">	Validating installed files against hashes from &apos;/opt/splunk/splunk-7.1.0-2e75b3406c5b-linux-2.6-x86_64-manifest&apos;</span><br><span class="line">	All installed files intact.</span><br><span class="line">	Done</span><br><span class="line">All preliminary checks passed.</span><br><span class="line"></span><br><span class="line">Starting splunk server daemon (splunkd)...  </span><br><span class="line">Done</span><br><span class="line"></span><br><span class="line">Waiting for web server at http://127.0.0.1:8000 to be available........ Done</span><br><span class="line"></span><br><span class="line">If you get stuck, we&apos;re here to help.  </span><br><span class="line">Look for answers here: http://docs.splunk.com</span><br><span class="line"></span><br><span class="line">The Splunk web interface is at http://pippo-vm:8000</span><br></pre></td></tr></table></figure>
<p>Clean splunk event data</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo /opt/splunk/bin/splunk clean eventdata</span><br></pre></td></tr></table></figure>
<h4 id="Configure-Splunk-Forwarder"><a href="#Configure-Splunk-Forwarder" class="headerlink" title="Configure Splunk Forwarder"></a>Configure Splunk Forwarder</h4><p>Specify which system log folder to be monitored (e.g. bro log)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo splunkforwarder/bin/splunk add monitor /var/spool/bro/bro/</span><br></pre></td></tr></table></figure>
<p>Set splunk deploy poll (management)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo splunkforwarder/bin/splunk set deploy-poll splunk-receiver-ip:8089</span><br></pre></td></tr></table></figure>
<p>Specify which port splunk receiver is listening on</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo splunkforwarder/bin/splunk add forward-server splunk-receiver-ip:9997</span><br></pre></td></tr></table></figure>
<p>Splunk forwarder auto-restart</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo splunkforwarder/bin/splunk enable boot-start</span><br></pre></td></tr></table></figure>
<p>Start splunk forwarder</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo splunkforwarder/bin/splunk start</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/05/06/SPAM-Phishing-Analysis/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Patrick Dong">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Superpb9">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/05/06/SPAM-Phishing-Analysis/" itemprop="url">SPAM/Phishing Analysis</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-05-06T09:39:09+12:00">
                2018-05-06
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Security-Incident-Response/" itemprop="url" rel="index">
                    <span itemprop="name">Security Incident Response</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="Foreword"><a href="#Foreword" class="headerlink" title="Foreword"></a>Foreword</h3><p>Special thanks to my ex-colleague Tanya Swift G. This article meanly talks about how to use <strong>dig</strong> command to help analyse a SPAM/Phishing email. Some examples have been given for better understanding.  </p>
<h3 id="Introduction-of-dig-command"><a href="#Introduction-of-dig-command" class="headerlink" title="Introduction of dig command"></a>Introduction of dig command</h3><p>You may use the <strong>dig</strong> command below on a command shell, in order to identify <strong>MX/TXT</strong> records that may help your SPAM/Phising investigation.</p>
<h4 id="Example-1-Google-TXT-record"><a href="#Example-1-Google-TXT-record" class="headerlink" title="Example 1: Google TXT record"></a>Example 1: Google TXT record</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ dig google.co.nz txt @8.8.8.8 +noall +answer</span><br><span class="line"></span><br><span class="line">; &lt;&lt;&gt;&gt; DiG 9.10.6 &lt;&lt;&gt;&gt; google.co.nz txt @8.8.8.8 +noall +answer</span><br><span class="line">;; global options: +cmd</span><br><span class="line">google.co.nz.		299	IN	TXT	&quot;v=spf1 -all&quot;</span><br></pre></td></tr></table></figure>
<h4 id="Example-2-Google-MX-record"><a href="#Example-2-Google-MX-record" class="headerlink" title="Example 2: Google MX record"></a>Example 2: Google MX record</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ dig google.co.nz mx @8.8.8.8 +noall +answer</span><br><span class="line"></span><br><span class="line">; &lt;&lt;&gt;&gt; DiG 9.10.6 &lt;&lt;&gt;&gt; google.co.nz mx @8.8.8.8 +noall +answer</span><br><span class="line">;; global options: +cmd</span><br><span class="line">google.co.nz.		599	IN	MX	10 aspmx.l.google.com.</span><br><span class="line">google.co.nz.		599	IN	MX	40 alt3.aspmx.l.google.com.</span><br><span class="line">google.co.nz.		599	IN	MX	20 alt1.aspmx.l.google.com.</span><br><span class="line">google.co.nz.		599	IN	MX	30 alt2.aspmx.l.google.com.</span><br><span class="line">google.co.nz.		599	IN	MX	50 alt4.aspmx.l.google.com.</span><br></pre></td></tr></table></figure>
<p>Please note that this command can also be used to check <strong>any</strong> other DNS records available for that specific domain.</p>
<h4 id="Example-3-Google-any-DNS-record"><a href="#Example-3-Google-any-DNS-record" class="headerlink" title="Example 3: Google any DNS record"></a>Example 3: Google any DNS record</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">$ dig google.co.nz any @8.8.8.8 +noall +answer</span><br><span class="line"></span><br><span class="line">; &lt;&lt;&gt;&gt; DiG 9.10.6 &lt;&lt;&gt;&gt; google.co.nz any @8.8.8.8 +noall +answer</span><br><span class="line">;; global options: +cmd</span><br><span class="line">google.co.nz.		299	IN	A	216.58.199.35</span><br><span class="line">google.co.nz.		299	IN	AAAA	2404:6800:4006:803::2003</span><br><span class="line">google.co.nz.		599	IN	MX	30 alt2.aspmx.l.google.com.</span><br><span class="line">google.co.nz.		299	IN	TXT	&quot;v=spf1 -all&quot;</span><br><span class="line">google.co.nz.		599	IN	MX	10 aspmx.l.google.com.</span><br><span class="line">google.co.nz.		21599	IN	NS	ns3.google.com.</span><br><span class="line">google.co.nz.		21599	IN	NS	ns4.google.com.</span><br><span class="line">google.co.nz.		599	IN	MX	40 alt3.aspmx.l.google.com.</span><br><span class="line">google.co.nz.		21599	IN	NS	ns1.google.com.</span><br><span class="line">google.co.nz.		21599	IN	NS	ns2.google.com.</span><br><span class="line">google.co.nz.		599	IN	MX	20 alt1.aspmx.l.google.com.</span><br><span class="line">google.co.nz.		599	IN	MX	50 alt4.aspmx.l.google.com.</span><br><span class="line">google.co.nz.		59	IN	SOA	ns1.google.com. dns-admin.google.com. 195609348 900 900 1800 60</span><br></pre></td></tr></table></figure>
<h3 id="Checking-SPF-record"><a href="#Checking-SPF-record" class="headerlink" title="Checking SPF record"></a>Checking SPF record</h3><p>Checking email SPF records may help identify that whether a received email has been spoofed or not. This is usually hinted if the email comes from a <strong>Sender’s Reverse DNS Record (Hostname) or IP Address</strong> which is not permitted by the domain to send an email on its behalf.</p>
<p>Meanwhile, not all domains have <strong>TXT record</strong> in place, which also makes it easy for attackers to use in bad faith. For instance, the one below was observed in one of our phishing emails.</p>
<h4 id="Example-4-Identify-the-email-sender"><a href="#Example-4-Identify-the-email-sender" class="headerlink" title="Example 4: Identify the email sender"></a>Example 4: Identify the email sender</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ dig mailplease.com txt @8.8.8.8 +noall +answer</span><br><span class="line"> </span><br><span class="line">; &lt;&lt;&gt;&gt; DiG 9.10.3-P4-Ubuntu &lt;&lt;&gt;&gt; mailplease.com txt @8.8.8.8 +noall +answer</span><br><span class="line">;; global options: +cmd</span><br></pre></td></tr></table></figure>
<p>Domain <strong>mailplease.com</strong> does not specify any TXT record which is easily to be leveraged for spoofing purpose. Also, in the Email Header below, we can see <strong>spf=none</strong>.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Authentication-Results: spf=none (sender IP is 173.203.187.120)</span><br><span class="line">smtp.mailfrom=mailplease.com; gen-x.co.nz; dkim=none (message not signed)</span><br><span class="line">header.d=none;gen-i.co.nz; dmarc=none action=none header.from=mailplease.com;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Received-SPF: None </span><br><span class="line">(protection.outlook.com: mailplease.com does not designate</span><br><span class="line">permitted sender hosts)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Received: from smtp120.iad3a.emailsrvr.com (173.203.187.120) by</span><br><span class="line">ME1AUS01FT014.mail.protection.outlook.com (10.152.232.114) with Microsoft</span><br><span class="line">SMTP Server (version=TLS1_2, cipher=TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384_P256) id 15.20.567.16 via</span><br><span class="line">Frontend Transport; Tue, 20 Mar 2018 20:43:45 +0000</span><br><span class="line">X-Sender-Id: akhoury@toggold.com</span><br><span class="line">X-Mailer: Microsoft Outlook 16.0</span><br></pre></td></tr></table></figure>
<p>After checking <strong>X-Sender-Id</strong> in this email header field, we know that the real initiator of the email is the <strong>toggold.com</strong> which uses <strong>emailsrvr.com</strong> in it’s <strong>MX records</strong> and that has the sender IP listed in their records. This can be confirmed by using dig command below.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ dig toggold.com  MX @8.8.8.8 +noall +answer</span><br><span class="line"> </span><br><span class="line">; &lt;&lt;&gt;&gt; DiG 9.10.3-P4-Ubuntu &lt;&lt;&gt;&gt; toggold.com MX @8.8.8.8 +noall +answer</span><br><span class="line">;; global options: +cmd</span><br><span class="line">toggold.com.            1799    IN      MX      10 mx2.emailsrvr.com.</span><br><span class="line">toggold.com.            1799    IN      MX      10 mx1.emailsrvr.com.</span><br></pre></td></tr></table></figure>
<p>Blow dig result is to confirm that IP 173.203.187.120 (smtp120.iad3a.emailsrvr.com) is from the TXT record of <strong>emailsrvr.com</strong>.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ dig emailsrvr.com txt @8.8.8.8 +noall +answer</span><br><span class="line"> </span><br><span class="line">; &lt;&lt;&gt;&gt; DiG 9.10.3-P4-Ubuntu &lt;&lt;&gt;&gt; emailsrvr.com txt @8.8.8.8 +noall +answer</span><br><span class="line">;; global options: +cmd</span><br><span class="line">emailsrvr.com.          16      IN      TXT     &quot;v=spf1 ip4:108.166.43.0/24</span><br><span class="line">ip4:146.20.86.8 ip4:146.20.161.0/25 ip4:161.47.34.7 ip4:173.203.2.16/29</span><br><span class="line">ip4:173.203.6.128/27 ip4:173.203.187.0/25 ip4:184.106.54.0/25 ip4:204.232.172.40 ~all&quot;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  


          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar.png"
                alt="Patrick Dong" />
            
              <p class="site-author-name" itemprop="name">Patrick Dong</p>
              <p class="site-description motion-element" itemprop="description">Cyber Security Analyst | OSCP</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">10</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">3</span>
                  <span class="site-state-item-name">categories</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">9</span>
                  <span class="site-state-item-name">tags</span>
                </a>
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="http://www.freebuf.com" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/superpb9" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:d.pippo9@gmail.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2018.05.05 &mdash; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Patrick Dong</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
